"use strict";(self.webpackChunkarcgis_web=self.webpackChunkarcgis_web||[]).push([[7910],{80573:(e,t,i)=>{i.d(t,{Z:()=>p});var r=i(27366),n=i(7138),s=i(63780),o=i(11582),a=i(79056),l=i(46784),c=i(49861),d=(i(25243),i(93169),i(69912));let h=0,u=class extends((0,l.eC)((0,o.J)((0,a.IG)(n.Z)))){constructor(e){super(e),this.id="".concat(Date.now().toString(16),"-analysis-").concat(h++),this.title=null}get parent(){return this._get("parent")}set parent(e){const t=this.parent;if(null!=t)switch(t.type){case"line-of-sight":case"dimension":t.releaseAnalysis(this);break;case"2d":case"3d":t.analyses.includes(this)&&t.analyses.remove(this)}this._set("parent",e)}get isEditable(){return this.requiredPropertiesForEditing.every(s.pC)}};(0,r._)([(0,c.Cb)({type:String,constructOnly:!0,clonable:!1})],u.prototype,"id",void 0),(0,r._)([(0,c.Cb)({type:String})],u.prototype,"title",void 0),(0,r._)([(0,c.Cb)({constructOnly:!0})],u.prototype,"type",void 0),(0,r._)([(0,c.Cb)({clonable:!1,value:null})],u.prototype,"parent",null),(0,r._)([(0,c.Cb)({readOnly:!0})],u.prototype,"isEditable",null),(0,r._)([(0,c.Cb)({readOnly:!0})],u.prototype,"requiredPropertiesForEditing",void 0),u=(0,r._)([(0,d.j)("esri.analysis.Analysis")],u);const p=u},45028:(e,t,i)=>{i.d(t,{C:()=>M,b:()=>L});var r,n,s,o,a,l,c,d,h,u,p=i(30168),f=i(22357),g=i(37081),_=i(33280),v=i(94951),m=i(14801),y=i(48655),b=i(16574),w=i(137),S=i(15226),x=i(28643),C=i(26461),T=i(116),R=i(82552),O=i(95276),P=i(98634),E=i(64201),A=i(25920),D=i(4760);function L(e){const t=new E.kG,{vertex:i,fragment:L,attributes:M,varyings:I}=t;(0,R.Sv)(i,e),t.include(v.w,e),t.include(y.c,e),t.include(x.k,e),t.include(m.R,e),M.add(D.T.POSITION,"vec3"),e.vvColor&&M.add(D.T.COLORFEATUREATTRIBUTE,"float"),I.add("vColor","vec4"),I.add("vpos","vec3");const F=e.multipassEnabled&&(e.output===g.H.Color||e.output===g.H.Alpha);F&&I.add("depth","float"),i.uniforms.add(new O.N("eColor",(e=>e.color)));const j=e.output===g.H.Depth;j&&(t.include(b.F,e),(0,f.Zu)(t),(0,f.Lm)(t)),i.code.add((0,P.H)(r||(r=(0,p.Z)(["\n    void main(void) {\n      vpos = position;\n      forwardNormalizedVertexColor();\n      forwardObjectAndLayerIdColor();\n\n      ","\n      ","\n      gl_Position = ","\n    }\n  "])),e.hasVertexColors?"vColor *= eColor;":e.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;",F?"depth = (view * vec4(vpos, 1.0)).z;":"",j?(0,P.H)(n||(n=(0,p.Z)(["transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);"]))):(0,P.H)(s||(s=(0,p.Z)(["transformPosition(proj, view, vpos);"]))))),t.include(_.f5,e),F&&t.include(S.l,e),L.include(T.Y);const V=e.output===g.H.Highlight;return V&&t.include(w.bA,e),L.code.add((0,P.H)(o||(o=(0,p.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n    vec4 fColor = vColor;\n\n    ","\n\n    if (fColor.a < ",") {\n      discard;\n    }\n\n    ","\n\n    ","\n    ",";\n    ",";\n    ","\n  }\n  "])),F?"terrainDepthTest(depth);":"",e.output===g.H.ObjectAndLayerIdColor?(0,P.H)(a||(a=(0,p.Z)(["fColor.a = 1.0;"]))):"",P.H.float(C.b),e.output===g.H.Alpha?(0,P.H)(l||(l=(0,p.Z)(["fragColor = vec4(fColor.a);"]))):"",e.output===g.H.Color?(0,P.H)(c||(c=(0,p.Z)(["fragColor = highlightSlice(fColor, vpos); ",""])),e.transparencyPassType===A.A.Color?"fragColor = premultiplyAlpha(fragColor);":""):"",V?(0,P.H)(d||(d=(0,p.Z)(["outputHighlight();"]))):"",e.output===g.H.Depth?(0,P.H)(h||(h=(0,p.Z)(["outputDepth(linearDepth);"]))):"",e.output===g.H.ObjectAndLayerIdColor?(0,P.H)(u||(u=(0,p.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}const M=Object.freeze(Object.defineProperty({__proto__:null,build:L},Symbol.toStringTag,{value:"Module"}))},18442:(e,t,i)=>{i.d(t,{H:()=>te,b:()=>Q,c:()=>$});var r,n,s,o,a,l,c,d,h,u,p,f,g,_,v,m,y,b,w,S,x,C,T=i(30168),R=i(88396),O=i(6394),P=i(67077),E=i(37081),A=i(33280),D=i(14801),L=i(28156),M=i(81879),I=i(50913),F=i(55616),j=i(137),V=i(28643),H=i(26461),N=i(116),z=i(78980),U=i(62993),G=i(82552),Z=i(82999),W=i(95276),B=i(58406),k=i(98634),q=i(64201),Y=i(19253),J=i(25920),X=i(4760);function Q(e){const t=new q.kG,i=e.signedDistanceFieldEnabled;if(t.include(M.R,e),t.include(A.f5,e),e.occlusionPass)return t.include(I.R,e),t;const{vertex:O,fragment:Q}=t;t.include(U.cK),Q.include(z.n),Q.include(N.Y),t.include(V.k,e),t.include(D.R,e),t.include(F.P),t.varyings.add("vcolor","vec4"),t.varyings.add("vtc","vec2"),t.varyings.add("vsize","vec2"),t.varyings.add("voccluded","float"),O.uniforms.add(new W.N("viewport",((e,t)=>t.camera.fullViewport)),new Z.A("screenOffset",((e,t)=>(0,R.s)(ee,2*e.screenOffset[0]*t.camera.pixelRatio,2*e.screenOffset[1]*t.camera.pixelRatio))),new Z.A("anchorPosition",(e=>$(e))),new W.N("materialColor",(e=>e.color))),(0,G.ZI)(O),i&&(O.uniforms.add(new W.N("outlineColor",(e=>e.outlineColor))),Q.uniforms.add(new W.N("outlineColor",(e=>K(e)?e.outlineColor:P.Z)),new B.p("outlineSize",(e=>K(e)?e.outlineSize:0)))),e.pixelSnappingEnabled&&O.include(L.H),e.hasScreenSizePerspective&&((0,U.ww)(O),(0,U.m8)(O)),e.debugDrawLabelBorder&&t.varyings.add("debugBorderCoords","vec4"),t.attributes.add(X.T.UV0,"vec2"),t.attributes.add(X.T.COLOR,"vec4"),t.attributes.add(X.T.SIZE,"vec2"),t.attributes.add(X.T.FEATUREATTRIBUTE,"vec4"),O.code.add((0,k.H)(r||(r=(0,T.Z)(["\n    void main(void) {\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      forwardObjectAndLayerIdColor();\n\n      if (rejectBySlice(projectAux.posModel)) {\n        // Project outside of clip plane\n        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n        return;\n      }\n      vec2 inputSize;\n      ","\n\n      ","\n\n      vec2 combinedSize = inputSize * pixelRatio;\n      vec4 quadOffset = vec4(0.0);\n      bool visible = testHUDVisibility(posProj);\n      voccluded = visible ? 0.0 : 1.0;\n    "])),e.hasScreenSizePerspective?(0,k.H)(n||(n=(0,T.Z)(["\n            inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\n            vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n         "]))):(0,k.H)(s||(s=(0,T.Z)(["\n            inputSize = size;\n            vec2 screenOffsetScaled = screenOffset;"]))),e.vvSize?"inputSize *= vvScale(featureAttribute).xx;":""));const te=(0,k.H)(o||(o=(0,T.Z)(["vec2 uv01 = floor(uv0);\nvec2 uv = uv0 - uv01;\nquadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;"]))),ie=e.pixelSnappingEnabled?i?(0,k.H)(a||(a=(0,T.Z)(["posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;"]))):(0,k.H)(l||(l=(0,T.Z)(["posProj += quadOffset;\nif (inputSize.x == size.x) {\nposProj = alignToPixelOrigin(posProj, viewport.zw);\n}"]))):(0,k.H)(c||(c=(0,T.Z)(["posProj += quadOffset;"])));O.code.add((0,k.H)(d||(d=(0,T.Z)(["\n    ","\n    ","\n    ","\n\n    ","\n\n    bool alphaDiscard = vcolor.a < ",";\n    ",'\n    if (alphaDiscard) {\n      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent\n      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n      return;\n    } else {\n      ',"\n      gl_Position = posProj;\n    }\n\n    vtc = uv;\n\n    ","\n    vsize = inputSize;\n    ","\n  }\n  "])),e.occlusionTestEnabled?"if (visible) {":"",te,e.vvColor?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;",e.output===E.H.ObjectAndLayerIdColor?(0,k.H)(h||(h=(0,T.Z)(["vcolor.a = 1.0;"]))):"",k.H.float(H.b),i?"alphaDiscard = alphaDiscard && outlineColor.a < ".concat(k.H.float(H.b),";"):"",ie,e.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":"",e.occlusionTestEnabled?(0,k.H)(u||(u=(0,T.Z)(["} else { vtc = vec2(0.0);\n      ",""])),e.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"):"")),Q.uniforms.add(new Y.A("tex",(e=>e.texture)));const re=e.debugDrawLabelBorder?(0,k.H)(p||(p=(0,T.Z)(["(isBorder > 0.0 ? 0.0 : ",")"])),k.H.float(H.F)):k.H.float(H.F),ne=(0,k.H)(f||(f=(0,T.Z)(["\n    ","\n\n    ","\n\n    ","\n\n    // Draw debug border with transparency, so that original texels along border are still partially visible\n    ","\n  "])),e.debugDrawLabelBorder?(0,k.H)(g||(g=(0,T.Z)(["\n      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));"]))):"",e.sampleSignedDistanceFieldTexelCenter?(0,k.H)(_||(_=(0,T.Z)(["\n      // Attempt to sample texel centers to avoid that thin cross outlines\n      // disappear with large symbol sizes.\n      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\n      float txSize = float(textureSize(tex, 0).x);\n      float texelSize = 1.0 / txSize;\n\n      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\n      vec2 scaleFactor = (vsize - txSize) * texelSize;\n      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\n      "]))):(0,k.H)(v||(v=(0,T.Z)(["\n      vec2 samplePos = vtc;\n      "]))),i?(0,k.H)(m||(m=(0,T.Z)(["\n      vec4 fillPixelColor = vcolor;\n\n      // Get distance and map it into [-0.5, 0.5]\n      float d = rgba2float(texture(tex, samplePos)) - 0.5;\n\n      // Distance in output units (i.e. pixels)\n      float dist = d * vsize.x;\n\n      // Create smooth transition from the icon into its outline\n      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);\n      fillPixelColor.a *= fillAlphaFactor;\n\n      if (outlineSize > 0.25) {\n        vec4 outlinePixelColor = outlineColor;\n        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);\n\n        // Create smooth transition around outline\n        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\n        outlinePixelColor.a *= outlineAlphaFactor;\n\n        if (\n          outlineAlphaFactor + fillAlphaFactor < "," ||\n          fillPixelColor.a + outlinePixelColor.a < ","\n        ) {\n          discard;\n        }\n\n        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\n        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\n        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +\n          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\n\n        fragColor = vec4(compositeColor, compositeAlpha);\n      } else {\n        if (fillAlphaFactor < ",") {\n          discard;\n        }\n\n        fragColor = premultiplyAlpha(fillPixelColor);\n      }\n\n      // visualize SDF:\n      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\n      "])),re,k.H.float(H.b),re):(0,k.H)(y||(y=(0,T.Z)(["\n          vec4 texColor = texture(tex, vtc, -0.5);\n          if (texColor.a < ",") {\n            discard;\n          }\n          fragColor = texColor * premultiplyAlpha(vcolor);\n          "])),re),e.debugDrawLabelBorder?(0,k.H)(b||(b=(0,T.Z)(["fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);"]))):"");switch(e.output){case E.H.Color:Q.code.add((0,k.H)(w||(w=(0,T.Z)(["\n        void main() {\n          ","\n          ","\n        }"])),ne,e.transparencyPassType===J.A.FrontFace?"fragColor.rgb /= fragColor.a;":""));break;case E.H.Alpha:Q.code.add((0,k.H)(S||(S=(0,T.Z)(["\n        void main() {\n          ","\n          fragColor = vec4(fragColor.a);\n        }"])),ne));break;case E.H.ObjectAndLayerIdColor:Q.code.add((0,k.H)(x||(x=(0,T.Z)(["\n        void main() {\n          ","\n          outputObjectAndLayerIdColor();\n        }"])),ne));break;case E.H.Highlight:Q.constants.add("occludedHighlightFlag","vec4",j.Wj).add("unoccludedHighlightFlag","vec4",j.ck),Q.code.add((0,k.H)(C||(C=(0,T.Z)(["\n        void main() {\n          ","\n          if (voccluded == 1.0) {\n            fragColor = occludedHighlightFlag;\n          } else {\n            fragColor = unoccludedHighlightFlag;\n          }\n        }"])),ne))}return t}function K(e){return e.outlineColor[3]>0&&e.outlineSize>0}function $(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee;return e.textureIsSignedDistanceField?function(e,t,i){null!=t?(0,R.s)(i,e[0]*(t[2]-t[0])+t[0],e[1]*(t[3]-t[1])+t[1]):(0,R.s)(i,0,0)}(e.anchorPosition,e.distanceFieldBoundingBox,t):(0,R.j)(t,e.anchorPosition),t}const ee=(0,O.a)(),te=Object.freeze(Object.defineProperty({__proto__:null,build:Q,calculateAnchorPosForRendering:$},Symbol.toStringTag,{value:"Module"}))},18300:(e,t,i)=>{i.d(t,{L:()=>b,b:()=>v});var r,n,s=i(30168),o=i(14226),a=i(81949),l=i(88396),c=i(6394),d=i(8084),h=i(82999),u=i(58406),p=i(98634),f=i(8654),g=i(64201),_=i(4760);function v(e){const t=new g.kG;t.include(d.j,e);const{vertex:i,fragment:a}=t;return i.uniforms.add(new f.g("modelView",((e,t)=>(0,o.w)(y,t.camera.viewMatrix,e.origin))),new f.g("proj",((e,t)=>t.camera.projectionMatrix)),new u.p("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new h.A("pixelToNDC",((e,t)=>(0,l.s)(m,2/t.camera.fullViewport[2],2/t.camera.fullViewport[3])))),t.attributes.add(_.T.START,"vec3"),t.attributes.add(_.T.END,"vec3"),t.attributes.add(_.T.UP,"vec3"),t.attributes.add(_.T.EXTRUDE,"vec2"),t.varyings.add("uv","vec2"),t.varyings.add("vViewStart","vec3"),t.varyings.add("vViewEnd","vec3"),t.varyings.add("vViewPlane","vec4"),i.code.add((0,p.H)(r||(r=(0,s.Z)(["void main() {\nvec3 pos = mix(start, end, extrude.x);\nvec4 viewPos = modelView * vec4(pos, 1);\nvec4 projPos = proj * viewPos;\nvec2 ndcPos = projPos.xy / projPos.w;\nvec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;\nvec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);\nvec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);\nvec2 lxy = abs(sign(projExtrudeDir) - ndcPos);\nndcPos += length(lxy) * projExtrudeDir;\nvec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));\nvec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;\nvViewStart = (modelView * vec4(start, 1)).xyz;\nvViewEnd = (modelView * vec4(end, 1)).xyz;\nvViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));\nfloat xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;\nndcPos.x += xPaddingPixels * pixelToNDC.x;\nuv = ndcPos * 0.5 + 0.5;\ngl_Position = vec4(ndcPos, 0, 1);\n}"])))),a.uniforms.add(new u.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),a.code.add((0,p.H)(n||(n=(0,s.Z)(["float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {\nvec3 origin = mix(start, end, 0.5);\nvec3 basis = end - origin;\nvec3 posAtOrigin = pos - origin;\nfloat x = dot(normalize(basis), posAtOrigin);\nfloat y = dot(plane.xyz, posAtOrigin);\nfloat dx = max(abs(x) - length(basis), 0.0);\nfloat dy = y;\nfloat dist = length(vec2(dx, dy));\nfloat width = fwidth(y);\nfloat maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;\nfloat pixelDist = dist / min(width, maxPixelDistance);\nreturn abs(pixelDist);\n}\nvoid main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nvec3 dEndStart = vViewEnd - vViewStart;\nif (dot(dEndStart, dEndStart) < 1e-5) {\ndiscard;\n}\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nfloat distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);\nvec4 color = laserlineProfile(distance);\nfloat alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));\nfragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);\n}"])))),t}const m=(0,c.a)(),y=(0,a.a)(),b=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}))},83671:(e,t,i)=>{i.d(t,{L:()=>Y,b:()=>V,d:()=>j});var r,n,s,o,a,l,c,d,h,u,p,f,g,_,v=i(30168),m=i(16889),y=i(88396),b=i(6394),w=i(11186),S=i(71353),x=i(90045),C=i(67077),T=i(85981),R=i(55652),O=i(23470),P=i(8084),E=i(24967),A=i(82999),D=i(49450),L=i(95276),M=i(58406),I=i(98634),F=i(64201);const j=(0,m.Vl)(6);function V(e){const t=new F.kG;t.include(E.k),t.include(P.j,e);const i=t.fragment;if(e.lineVerticalPlaneEnabled||e.heightManifoldEnabled)if(i.uniforms.add(new M.p("maxPixelDistance",((t,i)=>e.heightManifoldEnabled?2*i.camera.computeScreenPixelSizeAt(t.heightManifoldTarget):2*i.camera.computeScreenPixelSizeAt(t.lineVerticalPlaneSegment.origin)))),i.code.add((0,I.H)(r||(r=(0,v.Z)(["float planeDistancePixels(vec4 plane, vec3 pos) {\nfloat dist = dot(plane.xyz, pos) + plane.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"])))),e.spherical){const e=(e,t,i)=>(0,w.e)(e,t.heightManifoldTarget,i.camera.viewMatrix),t=(e,t)=>(0,w.e)(e,[0,0,0],t.camera.viewMatrix);i.uniforms.add(new L.N("heightManifoldOrigin",((i,r)=>(e(U,i,r),t(W,r),(0,w.f)(W,W,U),(0,w.n)(G,W),G[3]=(0,w.l)(W),G))),new D.J("globalOrigin",((e,i)=>t(U,i))),new M.p("cosSphericalAngleThreshold",((e,t)=>1-Math.max(2,(0,w.o)(t.camera.eye,e.heightManifoldTarget)*t.camera.perRenderPixelRatio)/(0,w.l)(e.heightManifoldTarget)))),i.code.add((0,I.H)(n||(n=(0,v.Z)(["float globeDistancePixels(float posInGlobalOriginLength) {\nfloat dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}\nfloat heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {\nvec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);\nfloat cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);\nvec3 posInGlobalOrigin = globalOrigin - pos;\nfloat posInGlobalOriginLength = length(posInGlobalOrigin);\nfloat sphericalDistance = globeDistancePixels(posInGlobalOriginLength);\nfloat planarDistance = planeDistancePixels(heightPlane, pos);\nreturn cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;\n}"]))))}else i.code.add((0,I.H)(s||(s=(0,v.Z)(["float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {\nreturn planeDistancePixels(heightPlane, pos);\n}"]))));if(e.pointDistanceEnabled&&(i.uniforms.add(new M.p("maxPixelDistance",((e,t)=>2*t.camera.computeScreenPixelSizeAt(e.pointDistanceTarget)))),i.code.add((0,I.H)(o||(o=(0,v.Z)(["float sphereDistancePixels(vec4 sphere, vec3 pos) {\nfloat dist = distance(sphere.xyz, pos) - sphere.w;\nfloat width = fwidth(dist);\ndist /= min(width, maxPixelDistance);\nreturn abs(dist);\n}"]))))),e.intersectsLineEnabled&&(i.uniforms.add(new M.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio))),i.code.add((0,I.H)(a||(a=(0,v.Z)(["float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {\nfloat dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);\nreturn abs(dist) - radius;\n}"]))))),(e.lineVerticalPlaneEnabled||e.intersectsLineEnabled)&&i.code.add((0,I.H)(l||(l=(0,v.Z)(["bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {\nvec3 dir = end - start;\nfloat t2 = dot(dir, pos - start);\nfloat l2 = dot(dir, dir);\nreturn t2 >= 0.0 && t2 <= l2;\n}"])))),i.code.add((0,I.H)(c||(c=(0,v.Z)(["void main() {\nvec3 pos;\nvec3 normal;\nfloat depthDiscontinuityAlpha;\nif (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {\ndiscard;\n}\nvec4 color = vec4(0, 0, 0, 0);"])))),e.heightManifoldEnabled){i.uniforms.add(new A.A("angleCutoff",(e=>H(e))),new L.N("heightPlane",((e,t)=>N(e.heightManifoldTarget,e.renderCoordsHelper.worldUpAtPosition(e.heightManifoldTarget,U),t.camera.viewMatrix))));const t=e.spherical?(0,I.H)(d||(d=(0,v.Z)(["normalize(globalOrigin - pos)"]))):(0,I.H)(h||(h=(0,v.Z)(["heightPlane.xyz"])));i.code.add((0,I.H)(u||(u=(0,v.Z)(["\n    {\n      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ",")));\n      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));\n      color = max(color, heightManifoldColor * heightManifoldAlpha);\n    }\n    "])),t))}return e.pointDistanceEnabled&&(i.uniforms.add(new A.A("angleCutoff",(e=>H(e))),new L.N("pointDistanceSphere",((e,t)=>function(e,t){return(0,w.e)(q,e.pointDistanceOrigin,t.camera.viewMatrix),q[3]=(0,w.o)(e.pointDistanceOrigin,e.pointDistanceTarget),q}(e,t)))),i.code.add((0,I.H)(p||(p=(0,v.Z)(["{\nfloat pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);\nvec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);\nfloat pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));\ncolor = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);\n}"]))))),e.lineVerticalPlaneEnabled&&(i.uniforms.add(new A.A("angleCutoff",(e=>H(e))),new L.N("lineVerticalPlane",((e,t)=>function(e,t){const i=(0,T.KU)(e.lineVerticalPlaneSegment,.5,U),r=e.renderCoordsHelper.worldUpAtPosition(i,Z),n=(0,w.n)(W,e.lineVerticalPlaneSegment.vector),s=(0,w.b)(G,r,n);return(0,w.n)(s,s),N(e.lineVerticalPlaneSegment.origin,s,t.camera.viewMatrix)}(e,t))),new D.J("lineVerticalStart",((e,t)=>function(e,t){const i=(0,w.c)(U,e.lineVerticalPlaneSegment.origin);return e.renderCoordsHelper.setAltitude(i,0),(0,w.e)(i,i,t.camera.viewMatrix)}(e,t))),new D.J("lineVerticalEnd",((e,t)=>function(e,t){const i=(0,w.g)(U,e.lineVerticalPlaneSegment.origin,e.lineVerticalPlaneSegment.vector);return e.renderCoordsHelper.setAltitude(i,0),(0,w.e)(i,i,t.camera.viewMatrix)}(e,t)))),i.code.add((0,I.H)(f||(f=(0,v.Z)(["{\nif (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {\nfloat lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);\nvec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);\nfloat lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));\ncolor = max(color, lineVerticalColor * lineVerticalAlpha);\n}\n}"]))))),e.intersectsLineEnabled&&(i.uniforms.add(new A.A("angleCutoff",(e=>H(e))),new D.J("intersectsLineStart",((e,t)=>(0,w.e)(U,e.lineStartWorld,t.camera.viewMatrix))),new D.J("intersectsLineEnd",((e,t)=>(0,w.e)(U,e.lineEndWorld,t.camera.viewMatrix))),new D.J("intersectsLineDirection",((e,t)=>((0,w.c)(G,e.intersectsLineSegment.vector),G[3]=0,(0,w.n)(U,(0,x.t)(G,G,t.camera.viewMatrix))))),new M.p("intersectsLineRadius",(e=>e.intersectsLineRadius))),i.code.add((0,I.H)(g||(g=(0,v.Z)(["{\nif (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {\nfloat intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);\nvec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);\nfloat intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));\ncolor = max(color, intersectsLineColor * intersectsLineAlpha);\n}\n}"]))))),i.code.add((0,I.H)(_||(_=(0,v.Z)(["fragColor = laserlineOutput(color * depthDiscontinuityAlpha);\n}"])))),t}function H(e){return(0,y.s)(z,Math.cos(e.angleCutoff),Math.cos(Math.max(0,e.angleCutoff-(0,m.Vl)(2))))}function N(e,t,i){return(0,w.e)(B,e,i),(0,w.c)(G,t),G[3]=0,(0,x.t)(G,G,i),(0,R.Yq)(B,G,k)}const z=(0,b.a)(),U=(0,S.c)(),G=(0,C.c)(),Z=(0,S.c)(),W=(0,S.c)(),B=(0,S.c)(),k=(0,R.Ue)(),q=(0,O.c)(),Y=Object.freeze(Object.defineProperty({__proto__:null,build:V,defaultAngleCutoff:j},Symbol.toStringTag,{value:"Module"}))},38365:(e,t,i)=>{i.d(t,{O:()=>u,a:()=>f,b:()=>p});var r,n=i(30168),s=i(54134),o=i(24967),a=i(58406),l=i(99339),c=i(98634),d=i(64201),h=i(19253);class u extends c.K{constructor(){super(...arguments),this.overlayIndex=s.fu.INNER,this.opacity=1}}function p(){const e=new d.kG;return e.include(o.k),e.fragment.uniforms.add(new h.A("tex",(e=>e.texture))),e.fragment.uniforms.add(new l._("overlayIdx",(e=>e.overlayIndex))),e.fragment.uniforms.add(new a.p("opacity",(e=>e.opacity))),e.fragment.code.add((0,c.H)(r||(r=(0,n.Z)(["void main() {\nvec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);\nfragColor = texture(tex, overlayUV) * opacity;\n}"])))),e}const f=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:u,build:p},Symbol.toStringTag,{value:"Module"}))},98186:(e,t,i)=>{i.d(t,{R:()=>be,b:()=>ye,r:()=>me});var r,n,s,o,a,l,c,d,h,u,p,f,g,_,v,m,y,b,w,S,x,C,T,R,O,P,E,A,D,L,M,I,F,j,V,H,N,z,U,G,Z,W,B,k,q,Y=i(30168),J=i(22357),X=i(37081),Q=i(33280),K=i(14801),$=i(48353),ee=i(16574),te=i(2631),ie=i(74823),re=i(15226),ne=i(85586),se=i(26461),oe=i(116),ae=i(82552),le=i(82999),ce=i(95276),de=i(58406),he=i(98634),ue=i(8654),pe=i(64201),fe=i(25920),ge=i(4760),_e=i(33720),ve=i(737);const me=1;function ye(e){const t=new pe.kG,{vertex:i,fragment:ye}=t,be=e.multipassEnabled&&(e.output===X.H.Color||e.output===X.H.Alpha);t.include(ne.e),t.include($.U,e),t.include(te.q,e);const we=e.applyMarkerOffset&&!e.draped;we&&(i.uniforms.add(new de.p("markerScale",(e=>e.markerScale))),t.include(ie.Q,{space:_e.I9.World,draped:!1})),e.output===X.H.Depth&&t.include(ee.F,e),t.include(K.R,e),(0,ae.Sv)(i,e),i.uniforms.add(new ue.g("inverseProjectionMatrix",((e,t)=>t.camera.inverseProjectionMatrix)),new le.A("nearFar",((e,t)=>t.camera.nearFar)),new de.p("miterLimit",(e=>"miter"!==e.join?0:e.miterLimit)),new ce.N("viewport",((e,t)=>t.camera.fullViewport))),i.constants.add("LARGE_HALF_FLOAT","float",65500),t.attributes.add(ge.T.POSITION,"vec3"),t.attributes.add(ge.T.SUBDIVISIONFACTOR,"float"),t.attributes.add(ge.T.UV0,"vec2"),t.attributes.add(ge.T.AUXPOS1,"vec3"),t.attributes.add(ge.T.AUXPOS2,"vec3"),t.varyings.add("vColor","vec4"),t.varyings.add("vpos","vec3"),(0,J.Lm)(t),be&&t.varyings.add("depth","float");const Se=e.stippleEnabled;Se&&t.varyings.add("vLineSizeInv","float");const xe=e.capType===ve.R.ROUND,Ce=Se||xe;Ce&&t.varyings.add("vLineWidth","float");const Te=e.innerColorEnabled||xe;Te&&t.varyings.add("vLineDistance","float");const Re=e.stippleEnabled&&xe,Oe=e.falloffEnabled||Re;Oe&&t.varyings.add("vLineDistanceNorm","float"),xe&&(t.varyings.add("vSegmentSDF","float"),t.varyings.add("vReverseSegmentSDF","float")),i.code.add((0,he.H)(r||(r=(0,Y.Z)(["#define PERPENDICULAR(v) vec2(v.y, -v.x);\nfloat interp(float ncp, vec4 a, vec4 b) {\nreturn (-ncp - a.z) / (b.z - a.z);\n}\nvec2 rotate(vec2 v, float a) {\nfloat s = sin(a);\nfloat c = cos(a);\nmat2 m = mat2(c, -s, s, c);\nreturn m * v;\n}"])))),i.code.add((0,he.H)(n||(n=(0,Y.Z)(["vec4 projectAndScale(vec4 pos) {\nvec4 posNdc = proj * pos;\nposNdc.xy *= viewport.zw / posNdc.w;\nreturn posNdc;\n}"])))),(0,J.bA)(t),i.code.add((0,he.H)(s||(s=(0,Y.Z)(["\n    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {\n      float vnp = nearFar[0] * 0.99;\n\n      if(pos.z > -nearFar[0]) {\n        //current pos behind ncp --\x3e we need to clip\n        if (!isStartVertex) {\n          if(prev.z < -nearFar[0]) {\n            //previous in front of ncp\n            pos = mix(prev, pos, interp(vnp, prev, pos));\n            next = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        } else {\n          if(next.z < -nearFar[0]) {\n            //next in front of ncp\n            pos = mix(pos, next, interp(vnp, pos, next));\n            prev = pos;\n          } else {\n            pos = vec4(0.0, 0.0, 0.0, 1.0);\n          }\n        }\n      } else {\n        //current position visible\n        if (prev.z > -nearFar[0]) {\n          //previous behind ncp\n          prev = mix(pos, prev, interp(vnp, pos, prev));\n        }\n        if (next.z > -nearFar[0]) {\n          //next behind ncp\n          next = mix(next, pos, interp(vnp, next, pos));\n        }\n      }\n\n      ","\n      linearDepth = calculateLinearDepth(nearFar,pos.z);\n\n      pos = projectAndScale(pos);\n      next = projectAndScale(next);\n      prev = projectAndScale(prev);\n    }\n  "])),be?"depth = pos.z;":"")),(0,ae.ZI)(i),i.code.add((0,he.H)(o||(o=(0,Y.Z)(["\n  void main(void) {\n    // unpack values from uv0.y\n    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;\n\n    float coverage = 1.0;\n\n    // Check for special value of uv0.y which is used by the Renderer when graphics\n    // are removed before the VBO is recompacted. If this is the case, then we just\n    // project outside of clip space.\n    if (uv0.y == 0.0) {\n      // Project out of clip space\n      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n    else {\n      bool isJoin = abs(uv0.y) < 3.0;\n\n      float lineSize = getSize();\n      float lineWidth = lineSize * pixelRatio;\n\n      ","\n      ","\n\n      // convert sub-pixel coverage to alpha\n      if (lineWidth < 1.0) {\n        coverage = lineWidth;\n        lineWidth = 1.0;\n      }else{\n        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if\n        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly\n        // so we only really care to round anything larger than 1.\n        lineWidth = floor(lineWidth + 0.5);\n      }\n\n      vec4 pos  = view * vec4(position.xyz, 1.0);\n      vec4 prev = view * vec4(auxpos1.xyz, 1.0);\n      vec4 next = view * vec4(auxpos2.xyz, 1.0);\n  "])),Ce?(0,he.H)(a||(a=(0,Y.Z)(["vLineWidth = lineWidth;"]))):"",Se?(0,he.H)(l||(l=(0,Y.Z)(["vLineSizeInv = 1.0 / lineSize;"]))):"")),we&&i.code.add((0,he.H)(c||(c=(0,Y.Z)(["vec4 other = isStartVertex ? next : prev;\nbool markersHidden = areWorldMarkersHidden(pos, other);\nif(!isJoin && !markersHidden) {\npos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;\n}"])))),i.code.add((0,he.H)(d||(d=(0,Y.Z)(["clipAndTransform(pos, prev, next, isStartVertex);\nvec2 left = (pos.xy - prev.xy);\nvec2 right = (next.xy - pos.xy);\nfloat leftLen = length(left);\nfloat rightLen = length(right);"])))),(e.stippleEnabled||xe)&&i.code.add((0,he.H)(h||(h=(0,Y.Z)(["\n      float isEndVertex = float(!isStartVertex);\n      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);\n      vec2 segment = mix(right, left, isEndVertex);\n      ","\n    "])),xe?(0,he.H)(u||(u=(0,Y.Z)(["vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);"]))):"")),i.code.add((0,he.H)(p||(p=(0,Y.Z)(["left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);\nright = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);\nvec2 capDisplacementDir = vec2(0, 0);\nvec2 joinDisplacementDir = vec2(0, 0);\nfloat displacementLen = lineWidth;\nif (isJoin) {\nbool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;\njoinDisplacementDir = normalize(left + right);\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\nif (leftLen > 0.001 && rightLen > 0.001) {\nfloat nDotSeg = dot(joinDisplacementDir, left);\ndisplacementLen /= length(nDotSeg * left - joinDisplacementDir);\nif (!isOutside) {\ndisplacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\n}\n}\nif (isOutside && (displacementLen > miterLimit * lineWidth)) {"])))),e.roundJoins?i.code.add((0,he.H)(f||(f=(0,Y.Z)(["\n        vec2 startDir = leftLen < 0.001 ? right : left;\n        startDir = PERPENDICULAR(startDir);\n\n        vec2 endDir = rightLen < 0.001 ? left : right;\n        endDir = PERPENDICULAR(endDir);\n\n        float factor = ",";\n\n        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));\n        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);\n      "])),e.stippleEnabled?(0,he.H)(g||(g=(0,Y.Z)(["min(1.0, subdivisionFactor * ",")"])),he.H.float((me+2)/(me+1))):(0,he.H)(_||(_=(0,Y.Z)(["subdivisionFactor"]))))):i.code.add((0,he.H)(v||(v=(0,Y.Z)(["if (leftLen < 0.001) {\njoinDisplacementDir = right;\n}\nelse if (rightLen < 0.001) {\njoinDisplacementDir = left;\n}\nelse {\njoinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;\n}\njoinDisplacementDir = PERPENDICULAR(joinDisplacementDir);"]))));const Pe=e.capType!==ve.R.BUTT;return i.code.add((0,he.H)(m||(m=(0,Y.Z)(["\n        displacementLen = lineWidth;\n      }\n    } else {\n      // CAP handling ---------------------------------------------------\n      joinDisplacementDir = isStartVertex ? right : left;\n      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);\n\n      ","\n    }\n  "])),Pe?(0,he.H)(y||(y=(0,Y.Z)(["capDisplacementDir = isStartVertex ? -right : left;"]))):"")),i.code.add((0,he.H)(b||(b=(0,Y.Z)(["\n    // Displacement (in pixels) caused by join/or cap\n    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;\n\n    ","\n\n    ","\n    ","\n\n    pos.xy += dpos;\n  "])),Oe||Te?(0,he.H)(w||(w=(0,Y.Z)(["float lineDistNorm = sign(uv0.y) * pos.w;"]))):"",Te?(0,he.H)(S||(S=(0,Y.Z)(["vLineDistance = lineWidth * lineDistNorm;"]))):"",Oe?(0,he.H)(x||(x=(0,Y.Z)(["vLineDistanceNorm = lineDistNorm;"]))):"")),xe&&i.code.add((0,he.H)(C||(C=(0,Y.Z)(["vec2 segmentDir = normalize(segment);\nvSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;\nvReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);"])))),e.stippleEnabled&&(e.draped?i.uniforms.add(new de.p("worldToScreenRatio",((e,t)=>1/t.screenToPCSRatio))):i.code.add((0,he.H)(T||(T=(0,Y.Z)(["vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);\nfloat worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);"])))),i.code.add((0,he.H)(R||(R=(0,Y.Z)(["float segmentLengthScreenDouble = length(segment);\nfloat segmentLengthScreen = segmentLengthScreenDouble * 0.5;\nfloat discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);\nfloat segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));\nvStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;"])))),e.draped?i.code.add((0,he.H)(O||(O=(0,Y.Z)(["float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;\nfloat startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);"])))):i.code.add((0,he.H)(P||(P=(0,Y.Z)(["float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;\nfloat segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;"])))),i.uniforms.add(new de.p("stipplePatternPixelSize",(e=>(0,te.C)(e)))),i.code.add((0,he.H)(E||(E=(0,Y.Z)(["float patternLength = lineSize * stipplePatternPixelSize;\nvStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);\nvStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);\nif (segmentLengthScreenDouble >= 0.001) {\nvec2 stippleDisplacement = pos.xy - segmentOrigin;\nfloat stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);\nvStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);\n}\nvStippleDistanceLimits *= pos.w;\nvStippleDistance *= pos.w;\nvStippleDistanceLimits = isJoin ?\nvStippleDistanceLimits :\nisStartVertex ?\nvec2(-1e34, vStippleDistanceLimits.y) :\nvec2(vStippleDistanceLimits.x, 1e34);"]))))),i.code.add((0,he.H)(A||(A=(0,Y.Z)(["\n      // Convert back into NDC\n      pos.xy = (pos.xy / viewport.zw) * pos.w;\n\n      vColor = getColor();\n      vColor.a *= coverage;\n\n      ","\n\n      // transform final position to camera space for slicing\n      vpos = (inverseProjectionMatrix * pos).xyz;\n      gl_Position = pos;\n      forwardObjectAndLayerIdColor();\n    }\n  }\n  "])),e.wireframe&&!e.draped?"pos.z -= 0.001 * pos.w;":"")),be&&t.include(re.l,e),t.include(Q.f5,e),ye.include(oe.Y),ye.code.add((0,he.H)(D||(D=(0,Y.Z)(["\n  void main() {\n    discardBySlice(vpos);\n    ","\n  "])),be?"terrainDepthTest(depth);":"")),e.wireframe?ye.code.add((0,he.H)(L||(L=(0,Y.Z)(["vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);"])))):(xe&&ye.code.add((0,he.H)(M||(M=(0,Y.Z)(["\n      float sdf = min(vSegmentSDF, vReverseSegmentSDF);\n      vec2 fragmentPosition = vec2(\n        min(sdf, 0.0),\n        vLineDistance\n      ) * gl_FragCoord.w;\n\n      float fragmentRadius = length(fragmentPosition);\n      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);\n\n      if (capCoverage < ",") {\n        discard;\n      }\n    "])),he.H.float(se.b))),Re?ye.code.add((0,he.H)(I||(I=(0,Y.Z)(["\n      vec2 stipplePosition = vec2(\n        min(getStippleSDF() * 2.0 - 1.0, 0.0),\n        vLineDistanceNorm * gl_FragCoord.w\n      );\n      float stippleRadius = length(stipplePosition * vLineWidth);\n      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale\n      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);\n      float stippleAlpha = step(",", stippleCoverage);\n      "])),he.H.float(se.b))):ye.code.add((0,he.H)(F||(F=(0,Y.Z)(["float stippleAlpha = getStippleAlpha();"])))),e.output!==X.H.ObjectAndLayerIdColor&&ye.code.add((0,he.H)(j||(j=(0,Y.Z)(["discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);"])))),ye.uniforms.add(new ce.N("intrinsicColor",(e=>e.color))),ye.code.add((0,he.H)(V||(V=(0,Y.Z)(["vec4 color = intrinsicColor * vColor;"])))),e.innerColorEnabled&&(ye.uniforms.add(new ce.N("innerColor",(e=>{var t;return null!==(t=e.innerColor)&&void 0!==t?t:e.color})),new de.p("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio))),ye.code.add((0,he.H)(H||(H=(0,Y.Z)(["float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;\nfloat innerAA = clamp(0.5 - distToInner, 0.0, 1.0);\nfloat innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);\ncolor = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);"]))))),ye.code.add((0,he.H)(N||(N=(0,Y.Z)(["vec4 finalColor = blendStipple(color, stippleAlpha);"])))),e.falloffEnabled&&(ye.uniforms.add(new de.p("falloff",(e=>e.falloff))),ye.code.add((0,he.H)(z||(z=(0,Y.Z)(["finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);"])))))),ye.code.add((0,he.H)(U||(U=(0,Y.Z)(["\n    ","\n\n    if (finalColor.a < ",") {\n      discard;\n    }\n\n    ","\n    ","\n    ","\n    ","\n    ","\n    ","\n  }\n  "])),e.output===X.H.ObjectAndLayerIdColor?(0,he.H)(G||(G=(0,Y.Z)(["finalColor.a = 1.0;"]))):"",he.H.float(se.b),e.output===X.H.Alpha?(0,he.H)(Z||(Z=(0,Y.Z)(["fragColor = vec4(finalColor.a);"]))):"",e.output===X.H.Color?(0,he.H)(W||(W=(0,Y.Z)(["fragColor = highlightSlice(finalColor, vpos);"]))):"",e.output===X.H.Color&&e.transparencyPassType===fe.A.Color?"fragColor = premultiplyAlpha(fragColor);":"",e.output===X.H.Highlight?(0,he.H)(B||(B=(0,Y.Z)(["fragColor = vec4(1.0);"]))):"",e.output===X.H.Depth?(0,he.H)(k||(k=(0,Y.Z)(["outputDepth(linearDepth);"]))):"",e.output===X.H.ObjectAndLayerIdColor?(0,he.H)(q||(q=(0,Y.Z)(["outputObjectAndLayerIdColor();"]))):"")),t}const be=Object.freeze(Object.defineProperty({__proto__:null,build:ye,ribbonlineNumRoundJoinSubdivisions:me},Symbol.toStringTag,{value:"Module"}))},72511:(e,t,i)=>{i.d(t,{S:()=>L,b:()=>E});var r,n,s,o,a,l,c,d,h,u,p=i(30168),f=i(67077),g=i(43505),_=i(37081),v=i(33280),m=i(94951),y=i(15226),b=i(26461),w=i(116),S=i(82552),x=i(49450),C=i(95276),T=i(98634),R=i(64201),O=i(25920),P=i(4760);function E(e){const t=new R.kG,i=e.multipassEnabled&&(e.output===_.H.Color||e.output===_.H.Alpha);t.include(m.w,e),t.include(g.A,e),t.include(v.f5,e);const{vertex:f,fragment:E}=t;return E.include(w.Y),(0,S.Sv)(f,e),E.uniforms.add(new C.N("uColor",(e=>e.color))),t.attributes.add(P.T.POSITION,"vec3"),t.varyings.add("vWorldPosition","vec3"),i&&t.varyings.add("depth","float"),e.screenSizeEnabled&&t.attributes.add(P.T.OFFSET,"vec3"),e.shadingEnabled&&((0,S._8)(f),t.attributes.add(P.T.NORMAL,"vec3"),t.varyings.add("vViewNormal","vec3")),f.code.add((0,T.H)(r||(r=(0,p.Z)(["\n    void main(void) {\n      vWorldPosition = ",";\n  "])),e.screenSizeEnabled?"screenSizeScaling(offset, position)":"position")),e.shadingEnabled&&f.code.add((0,T.H)(n||(n=(0,p.Z)(["vec3 worldNormal = normal;\nvViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;"])))),f.code.add((0,T.H)(s||(s=(0,p.Z)(["\n    ","\n    gl_Position = transformPosition(proj, view, vWorldPosition);\n  }\n  "])),i?"depth = (view * vec4(vWorldPosition, 1.0)).z;":"")),i&&t.include(y.l,e),E.code.add((0,T.H)(o||(o=(0,p.Z)(["\n    void main() {\n      discardBySlice(vWorldPosition);\n      ","\n    "])),i?"terrainDepthTest(depth);":"")),e.shadingEnabled?(E.uniforms.add(new x.J("shadingDirection",(e=>e.shadingDirection))),E.uniforms.add(new C.N("shadedColor",(e=>A(e.shadingTint,e.color)))),E.code.add((0,T.H)(a||(a=(0,p.Z)(["vec3 viewNormalNorm = normalize(vViewNormal);\nfloat shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);\nvec4 finalColor = mix(uColor, shadedColor, shadingFactor);"]))))):E.code.add((0,T.H)(l||(l=(0,p.Z)(["vec4 finalColor = uColor;"])))),E.code.add((0,T.H)(c||(c=(0,p.Z)(["\n      ","\n      if (finalColor.a < ",") {\n        discard;\n      }\n      ","\n\n      ","\n    }\n    "])),e.output===_.H.ObjectAndLayerIdColor?(0,T.H)(d||(d=(0,p.Z)(["finalColor.a = 1.0;"]))):"",T.H.float(b.b),e.output===_.H.Alpha?(0,T.H)(h||(h=(0,p.Z)(["fragColor = vec4(finalColor.a);"]))):"",e.output===_.H.Color?(0,T.H)(u||(u=(0,p.Z)(["fragColor = highlightSlice(finalColor, vWorldPosition); ",""])),e.transparencyPassType===O.A.Color?"fragColor = premultiplyAlpha(fragColor);":""):"")),t}function A(e,t){const i=1-e[3],r=e[3]+t[3]*i;return 0===r?(D[3]=r,D):(D[0]=(e[0]*e[3]+t[0]*t[3]*i)/r,D[1]=(e[1]*e[3]+t[1]*t[3]*i)/r,D[2]=(e[2]*e[3]+t[2]*t[3]*i)/r,D[3]=t[3],D)}const D=(0,f.c)(),L=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}))},61863:(e,t,i)=>{i.d(t,{T:()=>h,a:()=>p,b:()=>u});var r,n=i(30168),s=i(67077),o=i(24967),a=i(95276),l=i(98634),c=i(64201),d=i(19253);class h extends l.K{constructor(){super(...arguments),this.color=(0,s.f)(1,1,1,1)}}function u(){const e=new c.kG;return e.include(o.k),e.fragment.uniforms.add(new d.A("tex",(e=>e.texture)),new a.N("uColor",(e=>e.color))),e.fragment.code.add((0,l.H)(r||(r=(0,n.Z)(["void main() {\nvec4 texColor = texture(tex, uv);\nfragColor = texColor * uColor;\n}"])))),e}const p=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:h,build:u},Symbol.toStringTag,{value:"Module"}))},49810:(e,t,i)=>{i.d(t,{W:()=>z,b:()=>N});var r,n,s,o,a,l,c,d,h,u,p,f,g=i(30168),_=i(22357),v=i(37081),m=i(33280),y=i(94951),b=i(14801),w=i(137),S=i(60750),x=i(92395),C=i(15226),T=i(8555),R=i(41481),O=i(58335),P=i(29078),E=i(79246),A=i(26461),D=i(116),L=i(82552),M=i(95276),I=i(58406),F=i(98634),j=i(64201),V=i(25920),H=i(4760);function N(e){const t=new j.kG,{vertex:i,fragment:N}=t;(0,L.Sv)(i,e),t.include(y.w,e),t.attributes.add(H.T.POSITION,"vec3"),t.attributes.add(H.T.UV0,"vec2");const z=new M.N("waterColor",(e=>e.color));if(e.output===v.H.Color&&e.isDraped)return t.varyings.add("vpos","vec3"),i.uniforms.add(z),i.code.add((0,F.H)(r||(r=(0,g.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vpos = position;\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),F.H.float(A.b))),N.uniforms.add(z),N.code.add((0,F.H)(n||(n=(0,g.Z)(["void main() {\nfragColor = waterColor;\n}"])))),t;switch(e.output!==v.H.Color&&e.output!==v.H.Alpha||(t.include(T.n,e),t.include(_.qj,e),t.varyings.add("vuv","vec2"),t.varyings.add("vpos","vec3"),t.varyings.add("vnormal","vec3"),t.varyings.add("vtbnMatrix","mat3"),e.multipassEnabled&&t.varyings.add("depth","float"),i.uniforms.add(z),i.code.add((0,F.H)(s||(s=(0,g.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vuv = uv0;\n        vpos = position;\n\n        vnormal = getLocalUp(vpos, localOrigin);\n        vtbnMatrix = getTBNMatrix(vnormal);\n\n        ","\n\n        gl_Position = transformPosition(proj, view, vpos);\n        ","\n      }\n    "])),F.H.float(A.b),e.multipassEnabled?"depth = (view * vec4(vpos, 1.0)).z;":"",e.output===v.H.Color?"forwardLinearDepth();":""))),t.include(C.l,e),e.output){case v.H.Alpha:t.include(m.f5,e),N.uniforms.add(z),N.code.add((0,F.H)(o||(o=(0,g.Z)(["\n        void main() {\n          discardBySlice(vpos);\n          ","\n\n          fragColor = vec4(waterColor.a);\n        }\n      "])),e.multipassEnabled?"terrainDepthTest(depth);":""));break;case v.H.Color:t.include(x.kR),t.include(S._,{pbrMode:R.f7.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(E.M),t.include(m.f5,e),t.include(O.XE,e),t.include(P.B,e),N.uniforms.add(z,new I.p("timeElapsed",(e=>e.timeElapsed)),i.uniforms.get("view"),i.uniforms.get("localOrigin")),(0,L.hY)(N,e),N.include(D.Y),(0,x.Pe)(N),(0,x.F1)(N),N.code.add((0,F.H)(a||(a=(0,g.Z)(["\n      void main() {\n        discardBySlice(vpos);\n        ","\n        vec3 localUp = vnormal;\n        // the created normal is in tangent space\n        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\n\n        // we rotate the normal according to the tangent-bitangent-normal-Matrix\n        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);\n        vec3 v = -normalize(vpos - cameraPosition);\n        float shadow = ",";\n        vec4 vPosView = view * vec4(vpos, 1.0);\n        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);\n\n        // gamma correction\n        fragColor = delinearizeGamma(final);\n        fragColor = highlightSlice(fragColor, vpos);\n        ","\n      }\n    "])),e.multipassEnabled?"terrainDepthTest(depth);":"",e.receiveShadows?(0,F.H)(l||(l=(0,g.Z)(["1.0 - readShadowMap(vpos, linearDepth)"]))):"1.0",e.transparencyPassType===V.A.Color?"fragColor = premultiplyAlpha(fragColor);":""));break;case v.H.Normal:t.include(T.n,e),t.include(E.M,e),t.include(m.f5,e),t.varyings.add("vpos","vec3"),t.varyings.add("vuv","vec2"),i.uniforms.add(z),i.code.add((0,F.H)(c||(c=(0,g.Z)(["\n        void main(void) {\n          if (waterColor.a < ",") {\n            // Discard this vertex\n            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n            return;\n          }\n\n          vuv = uv0;\n          vpos = position;\n\n          gl_Position = transformPosition(proj, view, vpos);\n        }\n    "])),F.H.float(A.b))),N.uniforms.add(new I.p("timeElapsed",(e=>e.timeElapsed))),N.code.add((0,F.H)(d||(d=(0,g.Z)(["void main() {\ndiscardBySlice(vpos);\nvec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);\ntangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);\nfragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);\n}"]))));break;case v.H.Highlight:t.include(w.bA,e),t.varyings.add("vpos","vec3"),i.uniforms.add(z),i.code.add((0,F.H)(h||(h=(0,g.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n      }\n    "])),F.H.float(A.b))),t.include(m.f5,e),N.code.add((0,F.H)(u||(u=(0,g.Z)(["void main() {\ndiscardBySlice(vpos);\noutputHighlight();\n}"]))));break;case v.H.ObjectAndLayerIdColor:t.include(b.R,e),t.varyings.add("vpos","vec3"),i.uniforms.add(z),i.code.add((0,F.H)(p||(p=(0,g.Z)(["\n      void main(void) {\n        if (waterColor.a < ",") {\n          // Discard this vertex\n          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n          return;\n        }\n\n        vpos = position;\n        gl_Position = transformPosition(proj, view, vpos);\n        forwardObjectAndLayerIdColor();\n      }\n    "])),F.H.float(A.b))),t.include(m.f5,e),N.code.add((0,F.H)(f||(f=(0,g.Z)(["void main() {\ndiscardBySlice(vpos);\noutputObjectAndLayerIdColor();\n}"]))))}return t}const z=Object.freeze(Object.defineProperty({__proto__:null,build:N},Symbol.toStringTag,{value:"Module"}))},82218:(e,t,i)=>{i.d(t,{a:()=>m,g:()=>x,h:()=>A});i(93169);var r=i(32718),n=i(16889),s=i(21530),o=i(14226),a=i(81949),l=i(11186),c=i(71353),d=i(14320),h=i(85981),u=i(55652),p=i(40885),f=i(40927),g=i(51378);const _=r.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");const v=class{constructor(){this.plane=(0,u.Ue)(),this.origin=(0,c.c)(),this.basis1=(0,c.c)(),this.basis2=(0,c.c)()}};function m(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:V;return{plane:(0,u.Ue)(e.plane),origin:(0,c.g)(e.origin),basis1:(0,c.g)(e.basis1),basis2:(0,c.g)(e.basis2)}}function y(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m();return b(e.origin,e.basis1,e.basis2,t)}function b(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:m();return(0,l.c)(r.origin,e),(0,l.c)(r.basis1,t),(0,l.c)(r.basis2,i),w(r),function(e,t){Math.abs((0,l.j)(e.basis1,e.basis2)/((0,l.l)(e.basis1)*(0,l.l)(e.basis2)))>1e-6&&_.warn(t,"Provided basis vectors are not perpendicular"),Math.abs((0,l.j)(e.basis1,L(e)))>1e-6&&_.warn(t,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,l.j)(L(e),e.origin)-e.plane[3])>1e-6&&_.warn(t,"Plane offset is not consistent with plane origin")}(r,"fromValues()"),r}function w(e){(0,u.my)(e.basis2,e.basis1,e.origin,e.plane)}function S(e,t,i){e!==i&&y(e,i);const r=(0,l.i)(g.WM.get(),L(e),t);return(0,l.g)(i.origin,i.origin,r),i.plane[3]-=t,i}function x(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m();const i=(e[2]-e[0])/2,r=(e[3]-e[1])/2;return(0,l.s)(t.origin,e[0]+i,e[1]+r,0),(0,l.s)(t.basis1,i,0,0),(0,l.s)(t.basis2,0,r,0),(0,u.al)(0,0,1,0,t.plane),t}function C(e,t,i){return!!(0,u.BR)(e.plane,t,i)&&M(e,i)}function T(e,t,i){const r=H.get();j(e,t,r,H.get());let s=Number.POSITIVE_INFINITY;for(const o of G){const a=F(e,o,N.get()),c=g.WM.get();if((0,u.rx)(r,a,c)){const e=(0,l.C)(g.WM.get(),t.origin,c),r=Math.abs((0,n.ZF)((0,l.j)(t.direction,e)));r<s&&(s=r,(0,l.c)(i,c))}}return s===Number.POSITIVE_INFINITY?R(e,t,i):i}function R(e,t,i){if(C(e,t,i))return i;const r=H.get(),n=H.get();j(e,t,r,n);let s=Number.POSITIVE_INFINITY;for(const o of G){const a=F(e,o,N.get()),c=g.WM.get();if((0,u.dZ)(r,a,c)){const e=(0,p.Jk)(t,c);if(!(0,u.Ac)(n,c))continue;e<s&&(s=e,(0,l.c)(i,c))}}return E(e,t.origin)<s&&O(e,t.origin,i),i}function O(e,t,i){const r=(0,u.nF)(e.plane,t,g.WM.get()),n=(0,h.ct)(I(e,e.basis1),r,-1,1,g.WM.get()),s=(0,h.ct)(I(e,e.basis2),r,-1,1,g.WM.get());return(0,l.f)(i,(0,l.g)(g.WM.get(),n,s),e.origin),i}function P(e,t,i){const{origin:r,basis1:n,basis2:s}=e,o=(0,l.f)(g.WM.get(),t,r),a=(0,f.SR)(n,o),c=(0,f.SR)(s,o),d=(0,f.SR)(L(e),o);return(0,l.s)(i,a,c,d)}function E(e,t){const i=P(e,t,g.WM.get()),{basis1:r,basis2:n}=e,s=(0,l.l)(r),o=(0,l.l)(n),a=Math.max(Math.abs(i[0])-s,0),c=Math.max(Math.abs(i[1])-o,0),d=i[2];return a*a+c*c+d*d}function A(e,t){return Math.sqrt(E(e,t))}function D(e,t){const i=-e.plane[3];return(0,f.SR)(L(e),t)-i}function L(e){return(0,u.mJ)(e.plane)}function M(e,t){const i=(0,l.f)(g.WM.get(),t,e.origin),r=(0,l.m)(e.basis1),n=(0,l.m)(e.basis2),s=(0,l.j)(e.basis1,i),o=(0,l.j)(e.basis2,i);return-s-r<0&&s-r<0&&-o-n<0&&o-n<0}function I(e,t){const i=N.get();return(0,l.c)(i.origin,e.origin),(0,l.c)(i.vector,t),i}function F(e,t,i){const{basis1:r,basis2:n,origin:s}=e,o=(0,l.i)(g.WM.get(),r,t.origin[0]),a=(0,l.i)(g.WM.get(),n,t.origin[1]);(0,l.g)(i.origin,o,a),(0,l.g)(i.origin,i.origin,s);const c=(0,l.i)(g.WM.get(),r,t.direction[0]),d=(0,l.i)(g.WM.get(),n,t.direction[1]);return(0,l.i)(i.vector,(0,l.g)(c,c,d),2),i}function j(e,t,i,r){const n=L(e);(0,u.my)(n,t.direction,t.origin,i),(0,u.my)((0,u.mJ)(i),n,t.origin,r)}const V={plane:(0,u.Ue)(),origin:(0,c.f)(0,0,0),basis1:(0,c.f)(1,0,0),basis2:(0,c.f)(0,1,0)},H=new s.x(u.Ue),N=new s.x(h.Ue),z=(0,c.c)(),U=new s.x((()=>m())),G=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Z=(0,a.a)(),W=(0,a.a)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:v,altitudeAt:D,axisAt:function(e,t,i,r){return function(e,t,i){switch(t){case d.R.X:(0,l.c)(i,e.basis1),(0,l.n)(i,i);break;case d.R.Y:(0,l.c)(i,e.basis2),(0,l.n)(i,i);break;case d.R.Z:(0,l.c)(i,L(e))}return i}(e,i,r)},closestPoint:R,closestPointOnSilhouette:T,copy:y,copyWithoutVerify:function(e,t){(0,l.c)(t.origin,e.origin),(0,l.c)(t.basis1,e.basis1),(0,l.c)(t.basis2,e.basis2),(0,u.JG)(t.plane,e.plane)},create:m,distance:A,distance2:E,distanceToSilhouette:function(e,t){let i=Number.NEGATIVE_INFINITY;for(const r of G){const n=F(e,r,N.get()),s=(0,h.Jk)(n,t);s>i&&(i=s)}return Math.sqrt(i)},elevate:S,equals:function(e,t){return(0,l.h)(e.basis1,t.basis1)&&(0,l.h)(e.basis2,t.basis2)&&(0,l.h)(e.origin,t.origin)},extrusionContainsPoint:function(e,t){return(0,u.Ac)(e.plane,t)&&M(e,t)},fromAABoundingRect:x,fromValues:b,intersectRay:C,intersectRayClosestSilhouette:function(e,t,i){if(C(e,t,i))return i;const r=T(e,t,g.WM.get());return(0,l.g)(i,t.origin,(0,l.i)(g.WM.get(),t.direction,(0,l.o)(t.origin,r)/(0,l.l)(t.direction))),i},normal:L,projectPoint:O,projectPointLocal:P,rotate:function(e,t,i,r){return e!==r&&y(e,r),(0,o.c)(W,t,i),(0,l.e)(r.basis1,e.basis1,W),(0,l.e)(r.basis2,e.basis2,W),w(r),r},setAltitudeAt:function(e,t,i,r){const n=D(e,t),s=(0,l.i)(z,L(e),i-n);return(0,l.g)(r,t,s),r},setExtent:function(e,t,i){return x(t,i),S(i,D(e,e.origin),i),i},transform:function(e,t,i){return e!==i&&y(e,i),(0,o.i)(Z,t),(0,o.t)(Z,Z),(0,l.e)(i.basis1,e.basis1,Z),(0,l.e)(i.basis2,e.basis2,Z),(0,l.e)((0,u.mJ)(i.plane),(0,u.mJ)(e.plane),Z),(0,l.e)(i.origin,e.origin,t),(0,u.T5)(i.plane,i.plane,i.origin),i},up:V,updateUnboundedPlane:w,wrap:function(e,t,i){const r=U.get();return r.origin=e,r.basis1=t,r.basis2=i,r.plane=(0,u.re)(0,0,0,0),w(r),r}},Symbol.toStringTag,{value:"Module"}))},8229:(e,t,i)=>{function r(){return new Float32Array(3)}function n(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function s(){return r()}function o(){return n(1,1,1)}function a(){return n(1,0,0)}function l(){return n(0,1,0)}function c(){return n(0,0,1)}i.d(t,{c:()=>r,f:()=>n});const d=s(),h=o(),u=a(),p=l(),f=c();Object.freeze(Object.defineProperty({__proto__:null,ONES:h,UNIT_X:u,UNIT_Y:p,UNIT_Z:f,ZEROS:d,clone:function(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},create:r,createView:function(e,t){return new Float32Array(e,t,3)},fromValues:n,ones:o,unitX:a,unitY:l,unitZ:c,zeros:s},Symbol.toStringTag,{value:"Module"}))},151:(e,t,i)=>{function r(){return new Float32Array(4)}function n(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function o(){return r()}function a(){return s(1,1,1,1)}function l(){return s(1,0,0,0)}function c(){return s(0,1,0,0)}function d(){return s(0,0,1,0)}function h(){return s(0,0,0,1)}i.d(t,{c:()=>n,f:()=>s});const u=o(),p=a(),f=l(),g=c(),_=d(),v=h();Object.freeze(Object.defineProperty({__proto__:null,ONES:p,UNIT_W:v,UNIT_X:f,UNIT_Y:g,UNIT_Z:_,ZEROS:u,clone:n,create:r,createView:function(e,t){return new Float32Array(e,t,4)},fromValues:s,ones:a,unitW:h,unitX:l,unitY:c,unitZ:d,zeros:o},Symbol.toStringTag,{value:"Module"}))},46228:(e,t,i)=>{i.d(t,{I:()=>n,v:()=>s});var r=i(16889);function n(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=(0,r.uZ)(e,0,l);for(let r=0;r<4;r++)t[i+r]=Math.floor(256*c(n*o[r]))}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0;for(let r=0;r<4;r++)i+=e[t+r]*a[r];return i}const o=[1,256,65536,16777216],a=[1/256,1/65536,1/16777216,1/4294967296],l=s(new Uint8ClampedArray([255,255,255,255]));function c(e){return e-Math.floor(e)}},97942:(e,t,i)=>{function r(e){let t,i,r=[],n=!1;return function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];return n&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}(o,r)||(i=e.apply(this,o),t=this,r=o,n=!0),i}}i.d(t,{H:()=>r})},37998:(e,t,i)=>{i.d(t,{B:()=>c});var r=i(16889),n=i(14226),s=i(71353),o=i(73680),a=i(96334),l=i(92975);function c(e,t,i,r){if(null==e||null==r)return!1;const s=(0,a.eT)(e,a.Jz),c=(0,a.eT)(r,a.sp);if(s===c&&!d(c)&&(s!==a.Ej.UNKNOWN||(0,l.fS)(e,r)))return(0,n.d)(i,t),!0;if(d(c)){const e=a.rf[s][a.Ej.LON_LAT],r=a.rf[a.Ej.LON_LAT][c];return null!=e&&null!=r&&(e(t,0,u,0),r(u,0,p,0),(0,o.y)(h*u[0],h*u[1],i),i[12]=p[0],i[13]=p[1],i[14]=p[2],!0)}if((c===a.Ej.WEB_MERCATOR||c===a.Ej.PLATE_CARREE)&&(s===a.Ej.WGS84||s===a.Ej.CGCS2000&&c===a.Ej.PLATE_CARREE||s===a.Ej.SPHERICAL_ECEF||s===a.Ej.WEB_MERCATOR)){const e=a.rf[s][a.Ej.LON_LAT],r=a.rf[a.Ej.LON_LAT][c];return null!=e&&null!=r&&(e(t,0,u,0),r(u,0,p,0),s===a.Ej.SPHERICAL_ECEF?(0,o.s)(h*u[0],h*u[1],i):(0,n.g)(i),i[12]=p[0],i[13]=p[1],i[14]=p[2],!0)}return!1}function d(e){return e===a.Ej.SPHERICAL_ECEF||e===a.Ej.SPHERICAL_MARS_PCPF||e===a.Ej.SPHERICAL_MOON_PCPF}const h=(0,r.Vl)(1),u=(0,s.c)(),p=(0,s.c)()},73680:(e,t,i)=>{i.d(t,{s:()=>s,y:()=>n});var r=i(14226);function n(e,t,i){const r=Math.sin(e),n=Math.cos(e),s=Math.sin(t),o=Math.cos(t),a=i;return a[0]=-r,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*r,a[9]=o*r,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function s(e,t,i){return n(e,t,i),(0,r.t)(i,i),i}},5986:(e,t,i)=>{i.d(t,{S:()=>s});var r=i(71353),n=i(50628);function s(e,t,i,r){return!(null==t||null==r||e.length<2)&&(2===e.length&&(o[0]=e[0],o[1]=e[1],o[2]=0,e=o),(0,n.projectBuffer)(e,t,0,i,r,0,1))}const o=(0,r.c)()},86372:(e,t,i)=>{i.d(t,{JK:()=>a,QZ:()=>s,Rq:()=>o,bg:()=>n,mB:()=>l});var r=i(18722);function n(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e<=r.c8?t?new Array(e).fill(0):new Array(e):new Float64Array(e)}function s(e){return((0,r.kJ)(e)?e.length:e.byteLength/8)<=r.c8?Array.from(e):new Float64Array(e)}function o(e,t,i){return Array.isArray(e)?e.slice(t,t+i):e.subarray(t,t+i)}function a(e,t){for(let i=0;i<t.length;++i)e[i]=t[i];return e}function l(e){return Array.isArray(e)?new Float64Array(e):e}},45238:(e,t,i)=>{i.d(t,{EU:()=>f,Ue:()=>l,WH:()=>g,ZZ:()=>p,qC:()=>h,qw:()=>u,uT:()=>c,up:()=>_,zk:()=>d});var r=i(16889),n=i(48976),s=i(98131),o=i(11186),a=i(71353);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_;return[e[0],e[1],e[2],e[3]]}function c(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,o.c)(i,e),i[3]=t,i}function d(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,o.b)(i,e,t),(0,o.n)(i,i),i[3]=-(0,o.d)(e,t),i}function h(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:l();return(0,n.s)(v,e,g(e)),(0,n.s)(m,t,g(t)),(0,n.m)(v,m,v),function(e,t){return e[3]=t,e}(i,(0,r.BV)((0,n.g)(i,v)))}function u(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:l();return c(a.U,e,y),c(a.b,t,b),c(a.d,i,w),h(y,b,y),h(y,w,r),r}function p(e){return e}function f(e){return e[3]}function g(e){return(0,r.Vl)(e[3])}const _=[0,0,1,0],v=(0,s.a)(),m=(0,s.a)(),y=(l(),l()),b=l(),w=l()},81020:(e,t,i)=>{function r(e){return"point"===e.type}i.d(t,{f:()=>r})},77379:(e,t,i)=>{i.d(t,{y1:()=>o});i(11186);var r=i(71353),n=(i(2170),i(80885)),s=i(78952);i(68859),i(96334);(0,r.c)();(0,r.c)();i(15559),i(80064);function o(e){return"mouse"!==e.pointerType||0===e.button}const a=(0,r.c)(),l=(0,r.c)(),c=(0,r.c)();new n.Z({rings:[[a,l,c]],spatialReference:s.Z.WGS84}),(0,r.c)()},46208:(e,t,i)=>{var r,n;function s(e){return null!=e&&!e.running}i.d(t,{WU:()=>s,jL:()=>r,uz:()=>n}),function(e){e[e.RENDERING=0]="RENDERING",e[e.FADING=1]="FADING",e[e.FINISHED=2]="FINISHED"}(r||(r={})),function(e){e[e.RG=0]="RG",e[e.BA=1]="BA"}(n||(n={}))},5573:(e,t,i)=>{i.d(t,{Kf:()=>f,lL:()=>r});var r,n=i(16889),s=i(14226),o=i(81949),a=i(11186),l=i(71353),c=i(45238),d=i(22186),h=i(46208),u=i(82278),p=i(75248);class f{constructor(){this.readChannels=h.uz.RG,this.renderingStage=h.jL.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=(0,l.c)(),this.parallax=new g,this.parallaxNew=new g,this.pointOnGround=(0,l.c)(),this.fadeMode=r.HIDE,this.fadeFactor=0,this.opacity=0}updateParallax(e){const t=this.parallax,i=(0,a.l)(e.eye);if(t.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(i*i-d.sv.radius*d.sv.radius,0))/i,(0,c.zk)(_,t.anchorPointClouds,v),(0,s.k)(t.transform,o.I,v[3],(0,c.ZZ)(v)),this.fadeMode===r.CROSS_FADE){const e=this.parallaxNew;(0,c.zk)(_,e.anchorPointClouds,v),(0,s.k)(e.transform,o.I,v[3],(0,c.ZZ)(v))}}updateFading(e,t,i,r){this.isFading&&this._advanceFading(i,r),this._evaluateFading(e,t,i)}_evaluateFading(e,t,i){const n=e.relativeElevation,s=this._calculateDistanceToAnchorPoint(e);if((n>1.7*u.nq||n<-u.nq||s>S)&&this.opacity>0)this._setFade(r.HIDE,i);else if(!this.isFading)if((n>u.nq||n<-.35*u.nq||s>w)&&this.opacity>0)this._setFade(r.FADE_OUT,i);else if(n<=u.nq&&n>=-.35*u.nq&&t===p.n.IDLE&&(0,h.WU)(this.data)){if(0===this.opacity)return void this._setFade(r.FADE_IN,i);(s>b||this.renderingStage===h.jL.FADING)&&this._setFade(r.CROSS_FADE,i)}}_advanceFading(e,t){this._switchReadChannels(),this._updateAnchorPoint(),this._advanceFadingFactorAndOpacity(e,t)}_advanceFadingFactorAndOpacity(e,t){if(this.fadeFactor<1)return this.fadeFactor=t?(0,n.uZ)((e-this.startTime)/(y*t),0,1):1,this.fadeMode===r.FADE_OUT&&(this.opacity=1-this.fadeFactor),this.fadeMode===r.FADE_IN&&(this.opacity=this.fadeFactor),void(this.fadeMode===r.CROSS_FADE&&(this.opacity=1));this.fadeFactor=0,this.fadeMode===r.FADE_OUT&&(this.opacity=0),this.fadeMode===r.FADE_IN&&(this.opacity=1),this.fadeMode===r.CROSS_FADE&&(this.opacity=1),this.fadeMode=r.NONE}_switchReadChannels(){const e=this.fadeMode===r.CROSS_FADE&&1===this.fadeFactor,t=this.fadeMode===r.FADE_IN&&0===this.fadeFactor;this.renderingStage===h.jL.FADING&&(e||t)&&(this.readChannels=1-this.readChannels,this.renderingStage=h.jL.FINISHED)}_calculateDistanceToAnchorPoint(e){return(0,a.n)(this.pointOnGround,e.eye),(0,a.i)(this.pointOnGround,this.pointOnGround,d.sv.radius),(0,a.l)((0,a.f)(m,this.parallax.anchorPointClouds,this.pointOnGround))}_updateAnchorPoint(){this.fadeMode===r.CROSS_FADE&&(0===this.fadeFactor&&(0,a.c)(this.parallaxNew.anchorPointClouds,this.pointOnGround),1===this.fadeFactor&&(0,a.c)(this.parallax.anchorPointClouds,this.parallaxNew.anchorPointClouds)),this.fadeMode===r.FADE_IN&&0===this.fadeFactor&&(0,a.c)(this.parallax.anchorPointClouds,this.pointOnGround)}_setFade(e,t){switch(e){case r.HIDE:this.opacity=0;break;case r.FADE_OUT:this.opacity=1;break;case r.FADE_IN:this.opacity=0;break;case r.CROSS_FADE:this.opacity=1}this.fadeMode=e,this.fadeFactor=0,this.startTime=t}get isFading(){return this.fadeMode===r.FADE_OUT||this.fadeMode===r.FADE_IN||this.fadeMode===r.CROSS_FADE}}!function(e){e[e.NONE=0]="NONE",e[e.HIDE=1]="HIDE",e[e.FADE_OUT=2]="FADE_OUT",e[e.FADE_IN=3]="FADE_IN",e[e.CROSS_FADE=4]="CROSS_FADE"}(r||(r={}));class g{constructor(){this.anchorPointClouds=(0,l.c)(),this.radiusCurvatureCorrectionFactor=0,this.transform=(0,o.a)()}}const _=(0,l.f)(0,0,1),v=(0,c.Ue)(),m=(0,l.c)(),y=1.25,b=34e3,w=64e3,S=2e5},82278:(e,t,i)=>{i.d(t,{$T:()=>C,nq:()=>x});var r,n=i(27366),s=i(46784),o=i(49861),a=(i(25243),i(63780),i(93169),i(27135)),l=i(69912);let c=r=class extends s.wq{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new r({cloudCover:this.cloudCover})}};(0,n._)([(0,a.J)({cloudy:"cloudy"})],c.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0),c=r=(0,n._)([(0,l.j)("esri.views.3d.environment.CloudyWeather")],c);const d=c;var h;let u=h=class extends s.wq{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new h({fogStrength:this.fogStrength})}};(0,n._)([(0,a.J)({foggy:"foggy"})],u.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],u.prototype,"fogStrength",void 0),u=h=(0,n._)([(0,l.j)("esri.views.3d.environment.FoggyWeather")],u);const p=u;var f;let g=f=class extends s.wq{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})}};(0,n._)([(0,a.J)({rainy:"rainy"})],g.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],g.prototype,"cloudCover",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],g.prototype,"precipitation",void 0),g=f=(0,n._)([(0,l.j)("esri.views.3d.environment.RainyWeather")],g);const _=g;var v;let m=v=class extends s.wq{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new v({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};(0,n._)([(0,a.J)({snowy:"snowy"})],m.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"cloudCover",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],m.prototype,"precipitation",void 0),(0,n._)([(0,o.Cb)({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],m.prototype,"snowCover",void 0),m=v=(0,n._)([(0,l.j)("esri.views.3d.environment.SnowyWeather")],m);const y=m;var b;let w=b=class extends s.wq{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new b({cloudCover:this.cloudCover})}};(0,n._)([(0,a.J)({sunny:"sunny"})],w.prototype,"type",void 0),(0,n._)([(0,o.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],w.prototype,"cloudCover",void 0),w=b=(0,n._)([(0,l.j)("esri.views.3d.environment.SunnyWeather")],w);const S={key:"type",base:w,typeMap:{sunny:w,cloudy:d,rainy:_,snowy:y,foggy:p}};Object.keys(S.typeMap);const x=1e4,C=1e5},35284:(e,t,i)=>{i.d(t,{Z:()=>I});i(59486);var r=i(41644),n=i(91505),s=i(42537),o=i(16889),a=i(92026),l=i(17842),c=i(22753),d=i(11873),h=i(14226),u=i(81949),p=i(88396),f=i(11186),g=i(71353),_=i(83448),v=i(45925),m=i(73680),y=i(96334),b=i(65156),w=i(85981),S=i(55652),x=i(40885),C=i(51378),T=i(37818),R=i(77648),O=i(81703),P=i(86755),E=i(66327),A=i(78485),D=i(97882),L=i(99034),M=i(585);class I{constructor(e){var t;this.metadata=void 0,this._camera=new P.V,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,u.a)(),this._worldFrame=null,this._renderLocation=(0,g.c)(),this._renderLocationDirty=!0,this._location=new M.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new M.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.consumesClicks=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=L.jg.None,this._focused=!1,this.events=new n.Z.EventEmitter,this._screenLocation={screenPointArray:(0,l.s1)(),renderScreenPointArray:(0,l.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=e.view.spatialReference,Object.assign(this,e);const i=null===(t=this.view.state)||void 0===t?void 0:t.camera;i&&this._camera.copyFrom(i)}destroy(){this._applyObjectTransform=X,this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){var e;return null===(e=this.view)||void 0===e?void 0:e._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(e){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=e.slice(),this._updateEngineObject()}set available(e){e!==this._available&&(this._available=e,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),(0,s.kB)((()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()}))}set radius(e){e!==this._radius&&(this._radius=e,this._updateEngineObject())}get radius(){return this._radius}set worldSized(e){e!==this._worldSized&&(this._worldSized=e,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(e){F(e)&&(this._screenLocationDirty=!0),(0,h.h)(this._modelTransform,e),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,u.a)()),function(e,t,i){switch(e.viewingMode){case"local":return(0,h.g)(i),!0;case"global":{const r=(0,_.Iu)(e.renderCoordsHelper.spatialReference);(0,y.PR)(t,0,Z,0,r.radius),(0,m.y)((0,o.Vl)(Z[0]),(0,o.Vl)(Z[1]),i)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(e){this.view.renderCoordsHelper.fromRenderCoords(e,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(e){(0,T.WG)(e,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(e){(0,T.WG)(e,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const e=null!=this._elevation.override?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=e+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,T.D)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(e){e!==this._grabbing&&(this._grabbing=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(e){e!==this._hovering&&(this._hovering=e,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(e){e!==this._selected&&(this._selected=e,this._updateEngineObject(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,this._updateEngineObject())}updateStateEnabled(e,t){t?this.state|=e:this.state&=~e}_setFocused(e){e!==this._focused&&(this._focused=e,this.events.emit("focus-changed",{action:!0===e?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let e;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,F(this._modelTransform)){const t=this._calculateModelTransformOffset(Y);e=(0,f.g)(t,t,this.renderLocation)}else e=this.renderLocation;this._camera.projectToRenderScreen(e,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(e){this._applyObjectTransform=e,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(e,t){if(!this.available)return null;const i=(0,l.md)(e,j),n=this._getCollisionRadius(t),s=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,p.k)(this.screenLocation.screenPointArray,i)<n*n)return this.screenLocation.renderScreenPointArray[2]+s;break;case"line":{const e=this.collisionType.paths,t=this._getWorldToScreenObjectScale(),r=this._calculateObjectTransform(t,U),o=n*this.screenLocation.pixelSize,a=(0,O.u4)(this._camera,i,H);if(null==a)return null;for(const i of e){if(0===i.length)continue;const e=(0,f.e)(Z,i[0],r);for(let t=1;t<i.length;t++){const n=(0,f.e)(W,i[t],r),c=(0,w.Gr)((0,w.zk)(e,n,V),a);if(null!=c&&c<o*o){const t=(0,f.g)(C.WM.get(),e,n);(0,f.i)(t,t,.5);const i=(0,l.So)(C.WM.get());return this._camera.projectToRenderScreen(t,i),i[2]+s}(0,f.c)(e,n)}}break}case"disc":{var o;const e=this.collisionType.direction,t=null!==(o=this.collisionType.offset)&&void 0!==o?o:g.Z,r=this._getWorldToScreenObjectScale(),a=this._calculateObjectTransform(r,U),l=n*this.screenLocation.pixelSize,d=(0,O.u4)(this._camera,i,H);if(null==d)return null;const h=(0,c.f)(N,a),u=(0,f.t)(k,e,h),p=(0,f.e)(q,t,a);(0,S.Yq)(p,u,G);const _=B;if((0,S.BR)(G,d,_)&&(0,f.a)(_,p)<l*l)return this.screenLocation.renderScreenPointArray[2]+s;break}case"ribbon":{const{paths:e,direction:t}=this.collisionType,r=this._getWorldToScreenObjectScale(),o=this._calculateObjectTransform(r,U),a=n*this._camera.computeScreenPixelSizeAt(this.renderLocation),d=(0,O.u4)(this._camera,i,H);if(null==d)return null;const h=(0,c.f)(N,o),u=(0,f.t)(k,t,h),p=this._calculateModelTransformPosition(q);(0,S.Yq)(p,u,G);const g=B;if(!(0,S.BR)(G,d,g))break;for(const i of e){if(0===i.length)continue;const e=(0,f.e)(Z,i[0],o);for(let t=1;t<i.length;t++){const r=(0,f.e)(W,i[t],o),n=(0,w.Jk)((0,w.zk)(e,r,V),g);if(null!=n&&n<a*a){const t=(0,f.g)(C.WM.get(),e,r);(0,f.i)(t,t,.5);const i=(0,l.So)(C.WM.get());return this._camera.projectToRenderScreen(t,i),i[2]+s}(0,f.c)(e,r)}}break}default:(0,r.Bg)(this.collisionType)}return null}attach(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}};const t=this._stage;if(!t)return;const i=e.manipulator3D;null==i.engineLayerId?(this._engineLayer=new D.F(t,{pickable:!1,updatePolicy:A.j.SYNC}),i.engineLayerId=this._engineLayer.id):(null===t||void 0===t?void 0:t.getObject)&&(this._engineLayer=t.getObject(i.engineLayerId)),i.engineLayerReferences=(i.engineLayerReferences||0)+1,this._materialIdReferences=i.materialIdReferences,null==this._materialIdReferences&&(this._materialIdReferences=new Map,i.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,v.canProjectWithoutEngine)(this._location.spatialReference,this.view.spatialReference)||(this.location=new M.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{manipulator3D:{}}).manipulator3D;e.engineLayerReferences--;const t=0===e.engineLayerReferences;this._removeResourcesFromStage(),t&&(e.engineLayerId=null,(0,a.SC)(this._engineLayer)),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(e){(0,v.projectPoint)(this.location,J,e.spatialReference)&&(0,b.Qn)(e.extent,J)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){var e,t,i,r;if(null==this.elevationInfo)return;let n=null,s=0;const o=null!==(e=this.elevationInfo.offset)&&void 0!==e?e:0;switch(this.elevationInfo.mode){case"on-the-ground":n=null!==(t=(0,R.KO)(this.view.elevationProvider,this.location,"ground"))&&void 0!==t?t:0;break;case"relative-to-ground":s=(null!==(i=(0,R.KO)(this.view.elevationProvider,this.location,"ground"))&&void 0!==i?i:0)+o;break;case"relative-to-scene":s=(null!==(r=(0,R.KO)(this.view.elevationProvider,this.location,"scene"))&&void 0!==r?r:0)+o;break;case"absolute-height":s=o}return s!==this._elevation.offset||n!==this._elevation.override?(this._elevation.offset=s,void(this._elevation.override=n)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const e=this._getWorldToScreenObjectScale(),t=U;if(!0===this.autoScaleRenderObjects){const i=this._getFocusedSize(this._radius,this.focused)*e;this._calculateObjectTransform(i,t)}else this._calculateObjectTransform(e,t);const{objectsByState:i}=this._ensureEngineResources(),r=(this.focused?L.Q9.Focused:L.Q9.Unfocused)|(this.selected?L.Q9.Selected:L.Q9.Unselected),n=this._noDisplayCount>0;for(const{stateMask:s,objects:o}of i){if(n){for(const e of o)e.visible=!1;continue}const e=(s&L.Q9.All)!==L.Q9.None,i=(s&L.jg.All)!==L.jg.None,a=!e||(r&s)==(s&L.Q9.All),l=!i||(this.state&s)==(s&L.jg.All);if(a&&l)for(const r of o)r.visible=!0,r.transformation=t;else for(const t of o)t.visible=!1}}_ensureEngineResources(){if(null==this._engineResources){const e=this._engineLayer,t=[],i=new Set;this.renderObjects.forEach((e=>{let{geometry:{material:r}}=e;i.has(r)||(t.push(r),i.add(r))}));const r=new Map;this._renderObjects.forEach((e=>{const t=new E.T({castShadow:!1,geometries:[e.geometry]}),i=r.get(e.stateMask)||[];i.push(t),r.set(e.stateMask,i)}));const n=[];r.forEach(((e,t)=>n.push({stateMask:t,objects:e}))),this._engineResources={objectsByState:n,layer:e,materials:t}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const e=this._stage;if(this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:r}=this._engineResources;r.forEach((t=>{const i=this._materialIdReferences,r=i.get(t.id)||0;0===r&&e.add(t),i.set(t.id,r+1)})),t.forEach((t=>{let{objects:r}=t;i.addMany(r),e.addMany(r)})),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(){const e=this._stage;if(!this._engineResourcesAddedToStage||null==this._engineResources||!e)return;const{objectsByState:t,layer:i,materials:r}=this._engineResources;t.forEach((t=>{let{objects:r}=t;i.removeMany(r),e.removeMany(r)})),r.forEach((t=>{const i=this._materialIdReferences,r=i.get(t.id);1===r?(e.remove(t),i.delete(t.id)):i.set(t.id,r-1)})),this._engineResourcesAddedToStage=!1}_getCollisionRadius(e){return this._getFocusedSize(this.radius,!0)*("touch"===e?this.touchMultiplier:1)}_getFocusedSize(e,t){return e*(t?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(e){const t=this._getWorldToScreenObjectScale(),i=this._calculateObjectTransform(t,z);return(0,f.s)(e,i[12],i[13],i[14])}_calculateModelTransformOffset(e){const t=this._calculateModelTransformPosition(e);return(0,f.f)(e,t,this.renderLocation)}_calculateObjectTransform(e,t){return(0,h.s)(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1),this._worldFrame&&(0,h.m)(t,t,this._worldFrame),(0,h.m)(t,t,this._modelTransform),t[12]+=this.renderLocation[0],t[13]+=this.renderLocation[1],t[14]+=this.renderLocation[2],t[15]=1,null!=this._applyObjectTransform&&this._applyObjectTransform(t),t}get test(){let e=!1;if(null!=this._engineResources)for(const t of this._engineResources.objectsByState){for(const i of t.objects)if(i.visible){e=!0;break}if(e)break}return{areAnyResourcesVisible:e}}}function F(e){return 0!==e[12]||0!==e[13]||0!==e[14]}const j=(0,l.s1)(),V=(0,w.Ue)(),H=(0,x.Ue)(),N=(0,d.a)(),z=(0,u.a)(),U=(0,u.a)(),G=(0,S.Ue)(),Z=(0,g.c)(),W=(0,g.c)(),B=(0,g.c)(),k=(0,g.c)(),q=(0,g.c)(),Y=(0,g.c)(),J=new M.Z({x:0,y:0,z:0,spatialReference:null}),X=()=>{}},40508:(e,t,i)=>{i.d(t,{r:()=>n});var r=i(99034);class n{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.Q9.None;this.geometry=e,this.stateMask=t}}},73289:(e,t,i)=>{i.d(t,{_:()=>ys});var r,n,s,o,a,l=i(51995),c=i(86950),d=i(93169),h=i(42537),u=i(11186),p=i(71353),f=i(5986),g=i(74509),_=i(90045),v=i(151),m=i(70444),y=i(95773),b=i(85981),w=i(40885),S=i(27366),x=i(7138),C=i(79056),T=i(49861),R=(i(25243),i(63780)),O=i(69912);!function(e){e[e.RasterImage=0]="RasterImage",e[e.Features=1]="Features"}(r||(r={})),function(e){e[e.MapLayer=0]="MapLayer",e[e.ViewLayer=1]="ViewLayer",e[e.Outline=2]="Outline",e[e.SnappingHint=3]="SnappingHint"}(n||(n={})),function(e){e[e.WithRasterImage=0]="WithRasterImage",e[e.WithoutRasterImage=1]="WithoutRasterImage"}(s||(s={})),function(e){e[e.ADD=0]="ADD",e[e.UPDATE=1]="UPDATE",e[e.REMOVE=2]="REMOVE"}(o||(o={})),function(e){e[e.NONE=0]="NONE",e[e.VISIBILITY=1]="VISIBILITY",e[e.GEOMETRY=2]="GEOMETRY",e[e.TRANSFORMATION=4]="TRANSFORMATION",e[e.HIGHLIGHT=8]="HIGHLIGHT",e[e.OCCLUDEE=16]="OCCLUDEE"}(a||(a={}));var P=i(78485);class E{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=n.Outline}destroy(){this._destroyResources()}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(e){var t;this._renderGroup=e;const i=null===(t=this._resources)||void 0===t?void 0:t.layerView;i&&(i.renderGroup=e)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?null!=this._resources&&(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?null==this._resources&&this._createResources():this._destroyResources()}_createResources(){var e;this._destroyResources();const t=this._resourceFactory.createResources(),i=new A({view:this._resourceFactory.view,renderGroup:this._renderGroup}),r=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:new A({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:t,geometriesAdded:!1},r&&(this._resources.drapeSourceRenderer=r.registerGeometryDrapeSource(i)),this._syncGeometriesToRenderer()}_destroyResources(){var e;if(null==this._resources)return;this._ensureRenderGeometriesRemoved();const t=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;t&&t.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,o.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){var e;null!=(null===(e=this._resources)||void 0===e?void 0:e.drapeSourceRenderer)&&(this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,o.UPDATE),this._resources.geometriesAdded=!0))}}let A=class extends((0,C.IG)(x.Z)){constructor(e){super(e),this.drapeSourceType=r.Features,this.updatePolicy=P.j.SYNC,this.renderGroup=n.Outline}};(0,S._)([(0,T.Cb)({constructOnly:!0})],A.prototype,"view",void 0),(0,S._)([(0,T.Cb)({readOnly:!0})],A.prototype,"drapeSourceType",void 0),(0,S._)([(0,T.Cb)()],A.prototype,"renderGroup",void 0),A=(0,S._)([(0,O.j)("DrapedVisualElementLayerView")],A);var D=i(86244),L=i(94172),M=i(79100),I=i(66327),F=i(97882);class j{constructor(e){this._resourceFactory=e,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return null!=this._resources?this._resources.object:null}get resources(){return null!=this._resources?this._resources.external:null}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this._syncVisible())}get attached(){return this._attached}set attached(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const e=this._resourceFactory.view._stage;if(null==this._resources||!e)return;const t=this._resources.object;this._resources.external.forEach((t=>{t.type!==M.U.Mesh&&t.type!==M.U.Line&&t.type!==M.U.Point||e.remove(t)})),t.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,t,this._resources.layer),this._resources.external.forEach((t=>{t.type!==M.U.Mesh&&t.type!==M.U.Line&&t.type!==M.U.Point||e.add(t)}))}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const e=this._resourceFactory,t=e.view,i=t._stage;if(!i)return;const r=new F.F(i,{pickable:!1,updatePolicy:P.j.SYNC}),n=new I.T({castShadow:!1}),s=e.createResources(n,r);s.forEach((e=>{i.add(e),e.type===M.U.Texture&&e.load(i.renderView.renderingContext)})),i.add(n),r.add(n);const o=e.cameraChanged,a=o?(0,L.YP)((()=>t.state.camera),(e=>o(e)),L.nn):null;this._resources={layer:r,object:n,external:s,cameraHandle:a},this._syncVisible()}_destroyResources(){var e;if(null==this._resources)return;const t=this._resourceFactory.view._stage;t&&(t.remove(this._resources.object),this._resources.layer.destroy(),this._resources.external.forEach((e=>{t.remove(e),e.type===M.U.Texture&&e.unload()}))),this._resources.object.dispose(),null!==(e=this._resources.cameraHandle)&&void 0!==e&&e.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){null!=this._resources&&(this._resources.object.visible=this._visible)}}class V extends D.l{constructor(e){var t;super(e),this._isDraped=!1,this.object3dResources=new j(this.createObject3DResourceFactory(e.view)),this.drapedResources=new E(this.createDrapedResourceFactory(e.view)),this.isDraped=null!==(t=e.isDraped)&&void 0!==t&&t}get isDraped(){return this._isDraped}set isDraped(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(e){this.drapedResources.renderGroup=e}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}var H=i(62389),N=i(91505),z=i(77427),U=i(92026),G=i(27546),Z=i(92377),W=i(14226),B=i(50951),k=i(94463),q=i(54134),Y=i(65156);class J{constructor(e,t){this.vec3=e,this.id=t}}function X(e,t,i,r){return new J((0,p.f)(e,t,i),r)}class Q{constructor(){this._extent=(0,Y.Ue)(),this.resolution=0,this.renderLocalOrigin=X(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new K}get extent(){return this._extent}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const t=.001*e.range;if(this._extent[0]-t<=e.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,Y.cv)(this._extent,e.range,0,t)}if(this._extent[2]+t>=e.max){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];(0,Y.cv)(this._extent,-e.range,0,t)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,(0,Y.JG)(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const t=this.canvasGeometries.extents[e];if(t[0]!==t[2]&&t[1]!==t[3])return!0}return!1}}class K{constructor(){this.extents=[(0,Y.Ue)(),(0,Y.Ue)(),(0,Y.Ue)()],this.numViews=0}}var $;!function(e){e[e.Color=0]="Color",e[e.ColorNoRasterImage=1]="ColorNoRasterImage",e[e.Highlight=2]="Highlight",e[e.WaterNormal=3]="WaterNormal",e[e.Occluded=4]="Occluded",e[e.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}($||($={}));class ee{constructor(e,t){this._fbos=e,this._format=t}get valid(){return null!=this._handle}dispose(){this._handle=(0,U.RY)(this._handle)}get texture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.colorTexture}bind(e,t,i){var r,n;this._handle&&this._handle.fbo.width===t&&this._handle.fbo.height===i||(null!==(r=this._handle)&&void 0!==r&&r.release(),this._handle=this._fbos.acquire(this._format,t,i)),e.bindFramebuffer(null===(n=this._handle)||void 0===n?void 0:n.fbo)}generateMipMap(){var e,t;(null===(e=this._handle)||void 0===e||null===(e=e.colorTexture)||void 0===e||null===(e=e.descriptor)||void 0===e?void 0:e.hasMipmap)&&(null===(t=this._handle)||void 0===t||null===(t=t.colorTexture)||void 0===t||t.generateMipmap())}}var te=i(64727),ie=i(37081);class re{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:te.qz.RGBA_MIPMAP;this.output=t,this.content=i,this.fbo=new ee(e,r)}get valid(){return this.fbo.valid}}class ne{constructor(e){this.targets=[new re(e,ie.H.Color,$.Color),new re(e,ie.H.Color,$.ColorNoRasterImage),new re(e,ie.H.Highlight,$.Highlight,te.qz.RGBA4),new re(e,ie.H.Normal,$.WaterNormal),new re(e,ie.H.Color,$.Occluded)],(0,d.Z)("enable-feature:objectAndLayerId-rendering")&&this.targets.push(new re(e,ie.H.ObjectAndLayerIdColor,$.ObjectAndLayerIdColor))}getTexture(e){var t;return null===(t=this.targets[e])||void 0===t?void 0:t.fbo.texture}dispose(){for(const e of this.targets)e.fbo.dispose()}computeValidity(){return this.targets.reduce(((e,t,i)=>t.valid?e|=1<<i:e),0)}}var se,oe=i(67077),ae=i(85380);!function(e){e[e.Material=0]="Material",e[e.ShadowMap=1]="ShadowMap",e[e.Highlight=2]="Highlight"}(se||(se={}));i(92395);var le=i(41481);i(29078),i(61809),i(99340);var ce;i(58406),i(98634),i(19253);!function(e){e[e.Disabled=0]="Disabled",e[e.Enabled=1]="Enabled",e[e.EnabledWithWater=2]="EnabledWithWater",e[e.COUNT=3]="COUNT"}(ce||(ce={}));(0,oe.c)();var de=i(61863),he=i(59447),ue=i(33559);class pe{constructor(e){this._context=e,this._perConstructorInstances=new he.r,this._frameCounter=0,this._keepAliveFrameCount=ge}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach((e=>e.forEach((e=>e.technique.destroy())))),this._perConstructorInstances.clear()}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_e;const i=t.key;let r=this._perConstructorInstances.get(e,i);if(null==r){const n=new e(this._context,t,(()=>this.release(n)));r=new fe(n),this._perConstructorInstances.set(e,i,r)}return++r.refCount,r.technique}releaseAndAcquire(e,t,i){if(null!=i){if(t.key===i.key)return i;this.release(i)}return this.acquire(e,t)}release(e){if(null==e||this._perConstructorInstances.empty)return;const t=this._perConstructorInstances.get(e.constructor,e.key);null!=t&&(--t.refCount,0===t.refCount&&(t.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==ge&&this._perConstructorInstances.forEach(((e,t)=>{e.forEach(((e,i)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(t,i))}))}))}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach(((t,i)=>{e.push((async(e,t)=>{const i=t.shader;i&&(await i.reload(),e.forEach((e=>e.technique.reload(this._context))))})(t,i))})),await Promise.all(e)}}class fe{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}}const ge=-1,_e=new ue.m;var ve=i(70374),me=i(86755),ye=i(32718),be=i(97731);class we{constructor(e,t,i,r){this._textureRepository=e,this._techniqueRepository=t,this.materialChanged=i,this.requestRender=r,this._id2glMaterialRef=new he.r}dispose(){this._textureRepository.destroy()}acquire(e,t,i){if(this._ownMaterial(e),!e.produces(t,i))return null;let r=this._id2glMaterialRef.get(i,e.id);if(null==r){const t=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRepository:this._textureRepository,output:i});r=new Se(t),this._id2glMaterialRef.set(i,e.id,r)}return r.ref(),r.glMaterial}release(e,t){const i=this._id2glMaterialRef.get(t,e.id);null!=i&&(i.unref(),i.referenced||((0,U.M2)(i.glMaterial),this._id2glMaterialRef.delete(t,e.id)))}_ownMaterial(e){e.repository&&e.repository!==this&&ye.Z.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}}class Se{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,(0,be.hu)(this._refCnt>=0)}get referenced(){return this._refCnt>0}}var xe=i(7566),Ce=i(4760),Te=i(8548),Re=i(61109);new Re.G(Ce.T.POSITION,3,Te.g.FLOAT,0,12),new Re.G(Ce.T.POSITION,3,Te.g.FLOAT,0,20),new Re.G(Ce.T.UV0,2,Te.g.FLOAT,12,20),new Re.G(Ce.T.POSITION,3,Te.g.FLOAT,0,32),new Re.G(Ce.T.NORMAL,3,Te.g.FLOAT,12,32),new Re.G(Ce.T.UV0,2,Te.g.FLOAT,24,32),new Re.G(Ce.T.POSITION,3,Te.g.FLOAT,0,16),new Re.G(Ce.T.COLOR,4,Te.g.UNSIGNED_BYTE,12,16),new Re.G(Ce.T.POSITION,2,Te.g.FLOAT,0,8),new Re.G(Ce.T.POSITION,2,Te.g.FLOAT,0,16),new Re.G(Ce.T.UV0,2,Te.g.FLOAT,8,16);var Oe=i(80658),Pe=i(44070),Ee=i(57808),Ae=i(52311);var De=i(95439),Le=i(50628),Me=i(91526),Ie=i(94695);const Fe=null;var je=i(16889),Ve=i(17842),He=i(88396),Ne=i(55652),ze=i(55158),Ue=i(23620),Ge=i(56529),Ze=i(93822),We=i(65964),Be=i(33720),ke=i(98186),qe=i(82144),Ye=i(31132),Je=i(78041),Xe=i(27627),Qe=i(19087),Ke=i(25920),$e=i(36207);const et=new Map([[Ce.T.POSITION,0],[Ce.T.SUBDIVISIONFACTOR,1],[Ce.T.UV0,2],[Ce.T.AUXPOS1,3],[Ce.T.AUXPOS2,4],[Ce.T.COLOR,5],[Ce.T.COLORFEATUREATTRIBUTE,5],[Ce.T.SIZE,6],[Ce.T.SIZEFEATUREATTRIBUTE,6],[Ce.T.OPACITYFEATUREATTRIBUTE,7],[Ce.T.OBJECTANDLAYERIDCOLOR,8]]);class tt extends Ye.A{initializeProgram(e){return new Xe.$(e.rctx,tt.shader.get().build(this.configuration),et)}_makePipelineState(e,t){const i=this.configuration,r=e===Ke.A.NONE,n=e===Ke.A.FrontFace;return(0,$e.sm)({blending:i.output===ie.H.Color||i.output===ie.H.Alpha?r?Je.wu:(0,Je.j7)(e):null,depthTest:{func:(0,Je.Bh)(e)},depthWrite:r?i.writeDepth?$e.LZ:null:(0,Je.K5)(e),colorWrite:$e.BK,stencilWrite:i.hasOccludees?Qe.s3:null,stencilTest:i.hasOccludees?t?Qe.eD:Qe.RY:null,polygonOffset:r||n?i.hasPolygonOffset?it:null:Je.E0})}initializePipeline(){const e=this.configuration;if(e.occluder){const t=e.hasPolygonOffset?it:null;this._occluderPipelineTransparent=(0,$e.sm)({blending:Je.wu,polygonOffset:t,depthTest:Qe.zV,depthWrite:null,colorWrite:$e.BK,stencilWrite:null,stencilTest:Qe.YD}),this._occluderPipelineOpaque=(0,$e.sm)({blending:Je.wu,polygonOffset:t,depthTest:Qe.zV,depthWrite:null,colorWrite:$e.BK,stencilWrite:Qe.P7,stencilTest:Qe.ii}),this._occluderPipelineMaskWrite=(0,$e.sm)({blending:null,polygonOffset:t,depthTest:Qe.JN,depthWrite:null,colorWrite:null,stencilWrite:Qe.s3,stencilTest:Qe.eD})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Te.MX.LINES:Te.MX.TRIANGLE_STRIP}getPipeline(e,t,i){return e?this._occludeePipelineState:this.configuration.occluder?i?this._occluderPipelineTransparent:t?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}tt.shader=new qe.J(ke.R,(()=>i.e(6279).then(i.bind(i,56279))));const it={factor:0,units:-4};var rt,nt=i(737);!function(e){e[e.LEFT_JOIN_START=-2]="LEFT_JOIN_START",e[e.LEFT_JOIN_END=-1]="LEFT_JOIN_END",e[e.LEFT_CAP_START=-4]="LEFT_CAP_START",e[e.LEFT_CAP_END=-5]="LEFT_CAP_END",e[e.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",e[e.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",e[e.RIGHT_CAP_START=4]="RIGHT_CAP_START",e[e.RIGHT_CAP_END=5]="RIGHT_CAP_END"}(rt||(rt={}));class st extends Ge.F5{constructor(e){super(e,new at),this._configuration=new nt.G,this._vertexAttributeLocations=et}getConfiguration(e,t){this._configuration.output=e,this._configuration.draped=t.slot===Ze.r.DRAPED_MATERIAL;const i=null!=this.parameters.stipplePattern&&e!==ie.H.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&null!=this.parameters.stippleOffColor,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins="round"===this.parameters.join,this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=null!=this.parameters.markerParameters&&function(e){return e.anchor===Be.i5.Tip&&e.hideOnShortSegments&&"begin-end"===e.placement&&e.worldSpace}(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&null!=this.parameters.innerColor,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===Ge.yD.OccludeAndTransparentStencil,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,t,i,r,n,s){if(!i.options.selectionMode)return;const o=e.attributes.get(Ce.T.POSITION).data,a=e.attributes.get(Ce.T.SIZE);let l=this.parameters.width;if(this.parameters.vvSize){const t=e.attributes.get(Ce.T.SIZEFEATUREATTRIBUTE).data[0];l*=(0,je.uZ)(this.parameters.vvSize.offset[0]+t*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a&&(l*=a.data[0]);const c=r[0],d=r[1],h=(l/2+4)*e.screenToWorldRatio;let u=Number.MAX_VALUE,p=0;for(let f=0;f<o.length-5;f+=3){const e=o[f],t=o[f+1],i=c-e,r=d-t,n=o[f+3]-e,s=o[f+4]-t,a=(0,je.uZ)((n*i+s*r)/(n*n+s*s),0,1),l=n*a-i,h=s*a-r,g=l*l+h*h;g<u&&(u=g,p=f/3)}u<h*h&&n(s.dist,s.normal,p,!1)}intersect(e,t,i,r,n,s){if(!i.options.selectionMode||!e.visible)return;if(!(0,be.kG)(t))return void ye.Z.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const o=e.attributes,a=o.get(Ce.T.POSITION).data;let l=this.parameters.width;if(this.parameters.vvSize){const e=o.get(Ce.T.SIZEFEATUREATTRIBUTE).data[0];l*=(0,je.uZ)(this.parameters.vvSize.offset[0]+e*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else o.has(Ce.T.SIZE)&&(l*=o.get(Ce.T.SIZE).data[0]);const c=i.camera,d=gt;(0,He.j)(d,i.point);const h=l*c.pixelRatio/2+4*c.pixelRatio;(0,u.s)(Tt[0],d[0]-h,d[1]+h,0),(0,u.s)(Tt[1],d[0]+h,d[1]+h,0),(0,u.s)(Tt[2],d[0]+h,d[1]-h,0),(0,u.s)(Tt[3],d[0]-h,d[1]-h,0);for(let u=0;u<4;u++)if(!c.unprojectFromRenderScreen(Tt[u],Rt[u]))return;(0,Ne.zk)(c.eye,Rt[0],Rt[1],Ot),(0,Ne.zk)(c.eye,Rt[1],Rt[2],Pt),(0,Ne.zk)(c.eye,Rt[2],Rt[3],Et),(0,Ne.zk)(c.eye,Rt[3],Rt[0],At);let p=Number.MAX_VALUE,f=0;const g=dt(this.parameters,o)?a.length-2:a.length-5;for(let m=0;m<g;m+=3){ht[0]=a[m]+t[12],ht[1]=a[m+1]+t[13],ht[2]=a[m+2]+t[14];const e=(m+3)%a.length;if(ut[0]=a[e]+t[12],ut[1]=a[e+1]+t[13],ut[2]=a[e+2]+t[14],(0,Ne.jH)(Ot,ht)<0&&(0,Ne.jH)(Ot,ut)<0||(0,Ne.jH)(Pt,ht)<0&&(0,Ne.jH)(Pt,ut)<0||(0,Ne.jH)(Et,ht)<0&&(0,Ne.jH)(Et,ut)<0||(0,Ne.jH)(At,ht)<0&&(0,Ne.jH)(At,ut)<0)continue;if(c.projectToRenderScreen(ht,_t),c.projectToRenderScreen(ut,vt),_t[2]<0&&vt[2]>0){(0,u.f)(pt,ht,ut);const e=c.frustum,t=-(0,Ne.jH)(e[y.Nu.NEAR],ht)/(0,u.j)(pt,(0,Ne.mJ)(e[y.Nu.NEAR]));(0,u.i)(pt,pt,t),(0,u.g)(ht,ht,pt),c.projectToRenderScreen(ht,_t)}else if(_t[2]>0&&vt[2]<0){(0,u.f)(pt,ut,ht);const e=c.frustum,t=-(0,Ne.jH)(e[y.Nu.NEAR],ut)/(0,u.j)(pt,(0,Ne.mJ)(e[y.Nu.NEAR]));(0,u.i)(pt,pt,t),(0,u.g)(ut,ut,pt),c.projectToRenderScreen(ut,vt)}else if(_t[2]<0&&vt[2]<0)continue;_t[2]=0,vt[2]=0;const i=(0,b.Jk)((0,b.zk)(_t,vt,bt),d);i<p&&(p=i,(0,u.c)(mt,ht),(0,u.c)(yt,ut),f=m/3)}const _=i.rayBegin,v=i.rayEnd;if(p<h*h){let e=Number.MAX_VALUE;if((0,b.AR)((0,b.zk)(mt,yt,bt),(0,b.zk)(_,v,wt),ft)){(0,u.f)(ft,ft,_);const t=(0,u.l)(ft);(0,u.i)(ft,ft,1/t),e=t/(0,u.o)(_,v)}s(e,ft,f,!1)}}get _layout(){const e=(0,ze.U$)().vec3f(Ce.T.POSITION).f32(Ce.T.SUBDIVISIONFACTOR).vec2f(Ce.T.UV0).vec3f(Ce.T.AUXPOS1).vec3f(Ce.T.AUXPOS2);return this.parameters.vvSize?e.f32(Ce.T.SIZEFEATUREATTRIBUTE):e.f32(Ce.T.SIZE),this.parameters.vvColor?e.f32(Ce.T.COLORFEATUREATTRIBUTE):e.vec4f(Ce.T.COLOR),this.parameters.vvOpacity&&e.f32(Ce.T.OPACITYFEATUREATTRIBUTE),(0,d.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(Ce.T.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new lt(this._layout,this.parameters)}produces(e,t){return(t===ie.H.Color||t===ie.H.Alpha||t===ie.H.Highlight||t===ie.H.Depth||t===ie.H.ObjectAndLayerIdColor)&&(e===Ze.r.DRAPED_MATERIAL||(this.parameters.renderOccluded===Ge.yD.OccludeAndTransparentStencil?e===Ze.r.OPAQUE_MATERIAL||e===Ze.r.OCCLUDER_MATERIAL||e===Ze.r.TRANSPARENT_OCCLUDER_MATERIAL:t===ie.H.Color||t===ie.H.Alpha?e===(this.parameters.writeDepth?Ze.r.TRANSPARENT_MATERIAL:Ze.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===Ze.r.OPAQUE_MATERIAL))}createGLMaterial(e){return new ot(e)}validateParameters(e){"miter"!==e.join&&(e.miterLimit=0),null!=e.markerParameters&&(e.markerScale=e.markerParameters.width/e.width)}}class ot extends Ue.Z{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==ie.H.Color&&this._output!==ie.H.Alpha||this._updateOccludeeState(e);const t=this._material.parameters.stipplePattern;return this._stipplePattern!==t&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(t,this._stipplePattern)}),this._stipplePattern=t),this.ensureTechnique(tt,e)}}class at extends We.n{constructor(){super(...arguments),this.width=0,this.color=oe.O,this.join="miter",this.cap=nt.R.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}}class lt{constructor(e,t){this.vertexBufferLayout=e,this._parameters=t,this.numJoinSubdivisions=0;const i=t.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=ke.r+i}}_isClosed(e){return dt(this._parameters,e.attributes)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const t=e.attributes.get(Ce.T.POSITION).indices.length/2+1,i=this._isClosed(e);let r=i?2:4;return r+=((i?t:t-1)-(i?0:1))*(2*this.numJoinSubdivisions+4),r+=2,this._parameters.wireframe&&(r=2+4*(r-2)),r}write(e,t,i,r,n){var s;const o=St,a=xt,l=Ct,c=i.attributes.get(Ce.T.POSITION),h=c.indices,p=c.data.length/3,f=null===(s=i.attributes.get(Ce.T.DISTANCETOSTART))||void 0===s?void 0:s.data;h&&h.length!==2*(p-1)&&console.warn("RibbonLineMaterial does not support indices");let g=1,_=0;const v=this.vertexBufferLayout.fields.has(Ce.T.SIZEFEATUREATTRIBUTE);v?_=i.attributes.get(Ce.T.SIZEFEATUREATTRIBUTE).data[0]:i.attributes.has(Ce.T.SIZE)&&(g=i.attributes.get(Ce.T.SIZE).data[0]);let m=[1,1,1,1],y=0;const b=this.vertexBufferLayout.fields.has(Ce.T.COLORFEATUREATTRIBUTE);b?y=i.attributes.get(Ce.T.COLORFEATUREATTRIBUTE).data[0]:i.attributes.has(Ce.T.COLOR)&&(m=i.attributes.get(Ce.T.COLOR).data);const w=(0,d.Z)("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let S=0;const x=this.vertexBufferLayout.fields.has(Ce.T.OPACITYFEATUREATTRIBUTE);x&&(S=i.attributes.get(Ce.T.OPACITYFEATUREATTRIBUTE).data[0]);const C=new Float32Array(r.buffer),T=(0,d.Z)("enable-feature:objectAndLayerId-rendering")?new Uint8Array(r.buffer):null,R=this.vertexBufferLayout.stride/4;let O=n*R;const P=O;let E=0;const A=f?(e,t,i)=>E=f[i]:(e,t,i)=>E+=(0,u.o)(e,t),D=(0,d.Z)("enable-feature:objectAndLayerId-rendering"),L=(e,t,i,r,n,s,o)=>{if(C[O++]=t[0],C[O++]=t[1],C[O++]=t[2],C[O++]=r,C[O++]=o,C[O++]=n,C[O++]=e[0],C[O++]=e[1],C[O++]=e[2],C[O++]=i[0],C[O++]=i[1],C[O++]=i[2],C[O++]=v?_:g,b)C[O++]=y;else{const e=Math.min(4*s,m.length-4);C[O++]=m[e],C[O++]=m[e+1],C[O++]=m[e+2],C[O++]=m[e+3]}x&&(C[O++]=S),D&&(null!=w&&(T[4*O]=w[0],T[4*O+1]=w[1],T[4*O+2]=w[2],T[4*O+3]=w[3]),O++)};O+=R,(0,u.s)(a,c.data[0],c.data[1],c.data[2]),e&&(0,u.e)(a,a,e);const M=this._isClosed(i);if(M){const t=c.data.length-3;(0,u.s)(o,c.data[t],c.data[t+1],c.data[t+2]),e&&(0,u.e)(o,o,e)}else(0,u.s)(l,c.data[3],c.data[4],c.data[5]),e&&(0,u.e)(l,l,e),L(a,a,l,1,rt.LEFT_CAP_START,0,0),L(a,a,l,1,rt.RIGHT_CAP_START,0,0),(0,u.c)(o,a),(0,u.c)(a,l);const I=M?0:1,F=M?p:p-1;for(let d=I;d<F;d++){const t=(d+1)%p*3;(0,u.s)(l,c.data[t],c.data[t+1],c.data[t+2]),e&&(0,u.e)(l,l,e),A(o,a,d),L(o,a,l,0,rt.LEFT_JOIN_END,d,E),L(o,a,l,0,rt.RIGHT_JOIN_END,d,E);const i=this.numJoinSubdivisions;for(let e=0;e<i;++e){const t=(e+1)/(i+1);L(o,a,l,t,rt.LEFT_JOIN_END,d,E),L(o,a,l,t,rt.RIGHT_JOIN_END,d,E)}L(o,a,l,1,rt.LEFT_JOIN_START,d,E),L(o,a,l,1,rt.RIGHT_JOIN_START,d,E),(0,u.c)(o,a),(0,u.c)(a,l)}M?((0,u.s)(l,c.data[3],c.data[4],c.data[5]),e&&(0,u.e)(l,l,e),E=A(o,a,F),L(o,a,l,0,rt.LEFT_JOIN_END,I,E),L(o,a,l,0,rt.RIGHT_JOIN_END,I,E)):(E=A(o,a,F),L(o,a,a,0,rt.LEFT_CAP_END,F,E),L(o,a,a,0,rt.RIGHT_CAP_END,F,E)),ct(C,P+R,C,P,R),O=ct(C,O-R,C,O,R),this._parameters.wireframe&&this._addWireframeVertices(r,P,O,R)}_addWireframeVertices(e,t,i,r){const n=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),s=new Float32Array(e.buffer,t*Float32Array.BYTES_PER_ELEMENT,i-t);let o=0;const a=e=>o=ct(s,e,n,o,r);for(let l=0;l<s.length-1;l+=2*r)a(l),a(l+2*r),a(l+1*r),a(l+2*r),a(l+1*r),a(l+3*r)}}function ct(e,t,i,r,n){for(let s=0;s<n;s++)i[r++]=e[t++];return r}function dt(e,t){return!!e.isClosed&&t.get(Ce.T.POSITION).indices.length>2}const ht=(0,p.c)(),ut=(0,p.c)(),pt=(0,p.c)(),ft=(0,p.c)(),gt=(0,p.c)(),_t=(0,Ve.J$)(),vt=(0,Ve.J$)(),mt=(0,p.c)(),yt=(0,p.c)(),bt=(0,b.Ue)(),wt=(0,b.Ue)(),St=(0,p.c)(),xt=(0,p.c)(),Ct=(0,p.c)(),Tt=[(0,Ve.J$)(),(0,Ve.J$)(),(0,Ve.J$)(),(0,Ve.J$)()],Rt=[(0,p.c)(),(0,p.c)(),(0,p.c)(),(0,p.c)()],Ot=(0,Ne.Ue)(),Pt=(0,Ne.Ue)(),Et=(0,Ne.Ue)(),At=(0,Ne.Ue)();class Dt{constructor(e){this._originSR=e,this._rootOriginId="root/"+(0,De.D)(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(e){const t=this._origins.get(this._rootOriginId);if(null==t){const t=Fe;if(null!=t)return this._origins.set(this._rootOriginId,X(t[0],t[1],t[2],this._rootOriginId)),this.getOrigin(e);const i=X(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,i),i}const i=this._gridSize,r=Math.round(e[0]/i),n=Math.round(e[1]/i),s=Math.round(e[2]/i),o="".concat(r,"/").concat(n,"/").concat(s);let a=this._origins.get(o);const l=.5*i;if((0,u.f)(Lt,e,t.vec3),Lt[0]=Math.abs(Lt[0]),Lt[1]=Math.abs(Lt[1]),Lt[2]=Math.abs(Lt[2]),Lt[0]<l&&Lt[1]<l&&Lt[2]<l){if(a){const t=Math.max(...Lt);if((0,u.f)(Lt,e,a.vec3),Lt[0]=Math.abs(Lt[0]),Lt[1]=Math.abs(Lt[1]),Lt[2]=Math.abs(Lt[2]),Math.max(...Lt)<t)return a}return t}return a||(a=X(r*i,n*i,s*i,o),this._origins.set(o,a)),a}_drawOriginBox(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,oe.f)(1,1,0,1);const i=window.view,r=i._stage,n=t.toString();if(!this._objects.has(n)){this._material=new st({width:2,color:t}),r.add(this._material);const e=new F.F(r,{pickable:!1}),i=new I.T({castShadow:!1});r.add(i),e.add(i),this._objects.set(n,i)}const s=this._objects.get(n),o=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],a=o.length,l=new Array(3*a),c=new Array,d=.5*this._gridSize;for(let u=0;u<a;u++)l[3*u]=e[0]+(1&o[u]?d:-d),l[3*u+1]=e[1]+(2&o[u]?d:-d),l[3*u+2]=e[2]+(4&o[u]?d:-d),u>0&&c.push(u-1,u);(0,Le.projectBuffer)(l,this._originSR,0,l,i.renderSpatialReference,0,a);const h=new Ie.Z(this._material,[[Ce.T.POSITION,new Me.a(l,c,3,!0)]],null,M.U.Line);r.add(h),s.addGeometry(h)}get test(){const e=this;return{set gridSize(t){e._gridSize=t}}}}const Lt=(0,p.c)();var Mt=i(81949),It=i(6394),Ft=i(5573),jt=i(83866),Vt=i(43565),Ht=i(15226),Nt=i(68401),zt=i(48919);class Ut{constructor(e,t){this.shadowMap=e,this.slicePlane=t,this.slot=Ze.r.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=Ke.A.NONE,this.alignPixelEnabled=!1,this.decorations=Nt.Iq.ON,this.overlayStretch=1,this._camera=new me.V,this._inverseViewport=(0,It.a)(),this.oldLighting=new zt.c,this.newLighting=new zt.c,this._fadedLighting=new zt.c,this._lighting=this.newLighting,this.ssr=new Gt,this.multipassEnabled=!1,this.multipassTerrain=new Ht.a,this.multipassGeometry=new Vt._,this.hudRenderStyle=jt.U.Occluded,this.cloudsFade=new Ft.Kf}get camera(){return this._camera}set camera(e){this._camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:t,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(t,i,e),this._lighting=this._fadedLighting)}}class Gt{constructor(){this.fadeFactor=1,this.reprojectionMatrix=(0,Mt.a)()}}class Zt{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.rctx=e,this.sliceHelper=i,this.lastFrameCamera=new me.V,this.output=ie.H.Color,this.renderOccludedMask=Wt,this.bindParameters=new Ut(t,null!=i?i.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=Wt}}const Wt=Ge.yD.Occlude|Ge.yD.OccludeAndTransparent|Ge.yD.OccludeAndTransparentStencil;var Bt=i(11873);let kt=class extends me.V{constructor(){super(...arguments),this._projectionMatrix=(0,Mt.a)()}get projectionMatrix(){return this._projectionMatrix}};(0,S._)([(0,T.Cb)()],kt.prototype,"_projectionMatrix",void 0),(0,S._)([(0,T.Cb)({readOnly:!0})],kt.prototype,"projectionMatrix",null),kt=(0,S._)([(0,O.j)("esri.views.3d.webgl-engine.lib.CascadeCamera")],kt);var qt,Yt=i(32251);!function(e){e[e.Highlight=0]="Highlight",e[e.Default=1]="Default"}(qt||(qt={}));class Jt{constructor(){this.camera=new kt,this.lightMat=(0,Mt.a)()}}class Xt{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}}class Qt{get depthTexture(){var e;return null===(e=this._handle)||void 0===e?void 0:e.colorTexture}get _textureWidth(){return this._textureHeight*this._numCascades}get numCascades(){return this._numCascades}get cascadeDistances(){return(0,_.s)(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,t){this._fbos=e,this._viewingMode=t,this._enabled=!1,this._snapshots=new Array,this._textureHeight=0,this._numCascades=1,this.settings=new Xt,this._projectionView=(0,Mt.a)(),this._projectionViewInverse=(0,Mt.a)(),this._modelViewLight=(0,Mt.a)(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=(0,oe.c)(),this._cascades=[new Jt,new Jt,new Jt,new Jt],this._lastOrigin=null,this._maxTextureWidth=Math.min((0,d.Z)("esri-mobile")?4096:16384,e.rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._handle=(0,U.RY)(this._handle),this._discardSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=(0,je.uZ)(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&null!=this.depthTexture}get cascades(){for(let e=0;e<this._numCascades;++e)ai[e]=this._cascades[e];return ai.length=this._numCascades,ai}start(e,t,i,r,n){(0,be.hu)(this.enabled);const{near:s,far:o}=this._clampNearFar(i);this._computeCascadeDistances(s,o,r),this._textureHeight=this._computeTextureHeight(e,n,r),this._setupMatrices(e,t);const{viewMatrix:a,projectionMatrix:l}=e;for(let c=0;c<this._numCascades;++c)this._constructCascade(c,l,a,t);this._lastOrigin=null,this.clear()}finish(){var e;(0,be.hu)(this.enabled),null===(e=this._handle)||void 0===e||e.releaseDepth()}getShadowMapMatrices(e){if(!this._lastOrigin||!(0,u.h)(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||(0,p.c)(),(0,u.c)(this._lastOrigin,e);for(let t=0;t<this._numCascades;++t){(0,W.w)(li,this._cascades[t].lightMat,e);for(let e=0;e<16;++e)ci[16*t+e]=li[e]}}return ci}moveSnapshot(e){var t,i;(0,be.hu)(this.enabled),null!==(t=this._handle)&&void 0!==t&&t.releaseDepth(),null!==(i=this._snapshots[e])&&void 0!==i&&i.release(),this._snapshots[e]=this._handle,this._handle=null}copySnapshot(e){var t,i,r;const n=null===(t=this._handle)||void 0===t||null===(t=t.colorTexture)||void 0===t?void 0:t.descriptor;if(!this.enabled||!n)return;null===(i=this._snapshots[e])||void 0===i||i.release();const{width:s,height:o}=n;this._snapshots[e]=this._fbos.acquire(te.qz.RGBA4,s,o);const a=this._fbos.rctx;this._bindFbo();const l=a.bindTexture(null===(r=this._snapshots[e])||void 0===r?void 0:r.colorTexture,Ee.x.TEXTURE_UNIT_FOR_UPDATES);a.gl.copyTexSubImage2D(Te.No.TEXTURE_2D,0,0,0,0,0,s,o),a.bindTexture(l,Ee.x.TEXTURE_UNIT_FOR_UPDATES)}getSnapshot(e){var t;return this.enabled?null===(t=this._snapshots[e])||void 0===t?void 0:t.colorTexture:null}clear(){const e=this._fbos.rctx;this._ensureFbo(),this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Te.lk.COLOR_BUFFER_BIT|Te.lk.DEPTH_BUFFER_BIT)}_computeTextureHeight(e,t,i){const r=Math.min(window.devicePixelRatio,t)/e.pixelRatio,n=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality,s=(0,Yt.nq)(Math.floor(Math.max(e.fullWidth,e.fullHeight)*r*n));return Math.min(this._maxTextureWidth,this._numCascades*s)/this._numCascades}_ensureFbo(){var e,t,i;(null===(e=this._handle)||void 0===e?void 0:e.fbo.width)===this._textureWidth&&(null===(t=this._handle)||void 0===t?void 0:t.fbo.height)===this._textureHeight||(null!==(i=this._handle)&&void 0!==i&&i.release(),this._handle=this._fbos.acquire(te.qz.RGBA4,this._textureWidth,this._textureHeight)),this._handle.acquireDepth(te.qk.DEPTH16_BUFFER)}_discardSnapshot(e){this._snapshots[e]=(0,U.RY)(this._snapshots[e])}_discardSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){var e;const t=this._fbos.rctx;t.unbindTexture(this.depthTexture),t.bindFramebuffer(null===(e=this._handle)||void 0===e?void 0:e.fbo)}_constructCascade(e,t,i,r){const n=this._cascades[e],s=-this._cascadeDistances[e],o=-this._cascadeDistances[e+1],a=(t[10]*s+t[14])/Math.abs(t[11]*s+t[15]),l=(t[10]*o+t[14])/Math.abs(t[11]*o+t[15]);(0,be.hu)(a<l);for(let u=0;u<8;++u){(0,_.s)($t,u%4==0||u%4==3?-1:1,u%4==0||u%4==1?-1:1,u<4?a:l,1);const e=ei[u];(0,_.t)(e,$t,this._projectionViewInverse),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3]}(0,u.E)(oi,ei[0]),n.camera.viewMatrix=(0,W.w)(Kt,this._modelViewLight,oi);for(let p=0;p<8;++p)(0,u.e)(ei[p],ei[p],n.camera.viewMatrix);let c=ei[0][2],d=ei[0][2];for(let u=1;u<8;++u)c=Math.min(c,ei[u][2]),d=Math.max(d,ei[u][2]);c-=200,d+=200,n.camera.near=-d,n.camera.far=-c,function(e,t,i,r,n){const s=1/ei[0][3],o=1/ei[4][3];(0,be.hu)(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin((0,je.ZF)(e[2]*t[0]+e[6]*t[1]+e[10]*t[2]));a/=l,function(e,t,i,r,n,s,o,a){(0,He.s)(di,0,0);for(let w=0;w<4;++w)(0,He.i)(di,di,e[w]);(0,He.a)(di,di,.25),(0,He.s)(hi,0,0);for(let w=4;w<8;++w)(0,He.i)(hi,hi,e[w]);(0,He.a)(hi,hi,.25),(0,He.l)(ui[0],e[4],e[5],.5),(0,He.l)(ui[1],e[5],e[6],.5),(0,He.l)(ui[2],e[6],e[7],.5),(0,He.l)(ui[3],e[7],e[4],.5);let l=0,c=(0,He.k)(ui[0],di);for(let w=1;w<4;++w){const e=(0,He.k)(ui[w],di);e<c&&(c=e,l=w)}(0,He.c)(pi,ui[l],e[l+4]);const d=pi[0];let h,u;pi[0]=-pi[1],pi[1]=d,(0,He.c)(fi,hi,di),(0,He.g)(fi,pi)<0&&(0,He.n)(pi,pi),(0,He.l)(pi,pi,fi,i),(0,He.e)(pi,pi),h=u=(0,He.g)((0,He.c)(gi,e[0],di),pi);for(let w=1;w<8;++w){const t=(0,He.g)((0,He.c)(gi,e[w],di),pi);t<h?h=t:t>u&&(u=t)}(0,He.j)(r,di),(0,He.a)(gi,pi,h-t),(0,He.i)(r,r,gi);let p=-1,f=1,g=0,_=0;for(let w=0;w<8;++w){(0,He.c)(_i,e[w],r),(0,He.e)(_i,_i);const t=pi[0]*_i[1]-pi[1]*_i[0];t>0?t>p&&(p=t,g=w):t<f&&(f=t,_=w)}(0,be.T)(p>0,"leftArea"),(0,be.T)(f<0,"rightArea"),(0,He.a)(vi,pi,h),(0,He.i)(vi,vi,di),(0,He.a)(mi,pi,u),(0,He.i)(mi,mi,di),yi[0]=-pi[1],yi[1]=pi[0];const v=(0,be.ep)(r,e[_],mi,(0,He.i)(gi,mi,yi),1,n),m=(0,be.ep)(r,e[g],mi,gi,1,s),y=(0,be.ep)(r,e[g],vi,(0,He.i)(gi,vi,yi),1,o),b=(0,be.ep)(r,e[_],vi,gi,1,a);(0,be.T)(v,"rayRay"),(0,be.T)(m,"rayRay"),(0,be.T)(y,"rayRay"),(0,be.T)(b,"rayRay")}(ei,a,l,ti,ii,ri,ni,si),function(e,t,i,r,n){(0,He.c)(xi,i,r),(0,He.a)(xi,xi,.5),Ci[0]=xi[0],Ci[1]=xi[1],Ci[2]=0,Ci[3]=xi[1],Ci[4]=-xi[0],Ci[5]=0,Ci[6]=xi[0]*xi[0]+xi[1]*xi[1],Ci[7]=xi[0]*xi[1]-xi[1]*xi[0],Ci[8]=1,Ci[bi(0,2)]=-(0,He.g)(Si(Ci,0),e),Ci[bi(1,2)]=-(0,He.g)(Si(Ci,1),e);let s=(0,He.g)(Si(Ci,0),i)+Ci[bi(0,2)],o=(0,He.g)(Si(Ci,1),i)+Ci[bi(1,2)],a=(0,He.g)(Si(Ci,0),r)+Ci[bi(0,2)],l=(0,He.g)(Si(Ci,1),r)+Ci[bi(1,2)];s=-(s+a)/(o+l),Ci[bi(0,0)]+=Ci[bi(1,0)]*s,Ci[bi(0,1)]+=Ci[bi(1,1)]*s,Ci[bi(0,2)]+=Ci[bi(1,2)]*s,s=1/((0,He.g)(Si(Ci,0),i)+Ci[bi(0,2)]),o=1/((0,He.g)(Si(Ci,1),i)+Ci[bi(1,2)]),Ci[bi(0,0)]*=s,Ci[bi(0,1)]*=s,Ci[bi(0,2)]*=s,Ci[bi(1,0)]*=o,Ci[bi(1,1)]*=o,Ci[bi(1,2)]*=o,Ci[bi(2,0)]=Ci[bi(1,0)],Ci[bi(2,1)]=Ci[bi(1,1)],Ci[bi(2,2)]=Ci[bi(1,2)],Ci[bi(1,2)]+=1,s=(0,He.g)(Si(Ci,1),t)+Ci[bi(1,2)],o=(0,He.g)(Si(Ci,2),t)+Ci[bi(2,2)],a=(0,He.g)(Si(Ci,1),i)+Ci[bi(1,2)],l=(0,He.g)(Si(Ci,2),i)+Ci[bi(2,2)],s=-.5*(s/o+a/l),Ci[bi(1,0)]+=Ci[bi(2,0)]*s,Ci[bi(1,1)]+=Ci[bi(2,1)]*s,Ci[bi(1,2)]+=Ci[bi(2,2)]*s,s=(0,He.g)(Si(Ci,1),t)+Ci[bi(1,2)],o=(0,He.g)(Si(Ci,2),t)+Ci[bi(2,2)],a=-o/s,Ci[bi(1,0)]*=a,Ci[bi(1,1)]*=a,Ci[bi(1,2)]*=a,n[0]=Ci[0],n[1]=Ci[1],n[2]=0,n[3]=Ci[2],n[4]=Ci[3],n[5]=Ci[4],n[6]=0,n[7]=Ci[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=Ci[6],n[13]=Ci[7],n[14]=0,n[15]=Ci[8]}(ti,ii,ni,si,n.projectionMatrix),n.projectionMatrix[10]=2/(i-r),n.projectionMatrix[14]=-(i+r)/(i-r)}(i,r,c,d,n.camera),(0,W.m)(n.lightMat,n.camera.projectionMatrix,n.camera.viewMatrix);const h=this._textureHeight;n.camera.viewport=[e*h,0,h,h]}_setupMatrices(e,t){(0,W.m)(this._projectionView,e.projectionMatrix,e.viewMatrix),(0,W.i)(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===B.JY.Global?e.eye:(0,u.s)(oi,0,0,1);(0,W.u)(this._modelViewLight,[0,0,0],[-t[0],-t[1],-t[2]],i)}_clampNearFar(e){let{near:t,far:i}=e;return t<2&&(t=2),i<2&&(i=2),t>=i&&(t=2,i=4),{near:t,far:i}}_computeCascadeDistances(e,t,i){const r=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor((0,be.E6)(t/e,4)),r);const n=(t-e)/this._numCascades,s=(t/e)**(1/this._numCascades);let o=e,a=e;for(let l=0;l<this._numCascades+1;++l)this._cascadeDistances[l]=(0,je.t7)(o,a,this.settings.splitSchemeLambda),o*=s,a+=n}get test(){return{cascades:this._cascades,textureHeight:this._textureHeight}}}const Kt=(0,Mt.a)(),$t=(0,oe.c)(),ei=[];for(let Ts=0;Ts<8;++Ts)ei.push((0,oe.c)());const ti=(0,It.a)(),ii=(0,It.a)(),ri=(0,It.a)(),ni=(0,It.a)(),si=(0,It.a)(),oi=(0,p.c)(),ai=[],li=(0,Mt.a)(),ci=Mt.I.concat(Mt.I,Mt.I,Mt.I,Mt.I),di=(0,It.a)(),hi=(0,It.a)(),ui=[(0,It.a)(),(0,It.a)(),(0,It.a)(),(0,It.a)()],pi=(0,It.a)(),fi=(0,It.a)(),gi=(0,It.a)(),_i=(0,It.a)(),vi=(0,It.a)(),mi=(0,It.a)(),yi=(0,It.a)();function bi(e,t){return 3*t+e}const wi=(0,It.a)();function Si(e,t){return(0,He.s)(wi,e[t],e[t+3]),wi}const xi=(0,It.a)(),Ci=(0,Bt.a)();var Ti=i(54463),Ri=i(55848);i(22178);class Oi extends Ri.Dx{constructor(e,t,i){super(e,t),this.triangleNr=i}}class Pi{constructor(){this.adds=new G.Z,this.removes=new G.Z,this.updates=new G.Z({allocator:e=>e||new Ei,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}class Ei{}class Ai{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}}var Di=i(88153);function Li(e){return e.geometry.indexCount>=1}var Mi=i(50256);class Ii{constructor(e,t){this._material=e,this._repository=t,this._map=new Map}dispose(){this._map.forEach(((e,t)=>{null!=e&&this._repository.release(this._material,t)}))}load(e,t,i){if(!this._material.produces(t,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,t,i));const r=this._map.get(i);if(null!=r){if(r.ensureResources(e)===Nt.Rw.LOADED)return r;this._repository.requestRender()}return null}}class Fi extends ae.Pf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,p.c)();super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}}var ji=i(38499);class Vi{constructor(){this.enabled=!0,this._time=(0,ji.HA)(0)}get time(){return this._time}advance(e){let{deltaTime:t,fixedTime:i}=e;return null!=i?this._time!==i&&(this._time=i,!0):(this._time=(0,ji.HA)(this._time+t),0!==t)}}var Hi=i(12594);(0,ze.U$)().vec3f(Ce.T.POSITION);const Ni=(0,ze.U$)().vec3f(Ce.T.POSITION).vec2f(Ce.T.UV0),zi=((0,ze.U$)().vec3f(Ce.T.POSITION).vec4u8(Ce.T.COLOR),(0,ze.U$)().vec3f(Ce.T.POSITION).vec4u8(Ce.T.OBJECTANDLAYERIDCOLOR),(0,ze.U$)().vec3f(Ce.T.POSITION).vec2f(Ce.T.UV0).vec4u8(Ce.T.OBJECTANDLAYERIDCOLOR));(0,ze.U$)().vec3f(Ce.T.POSITION).vec4u8(Ce.T.COLOR).vec4u8(Ce.T.OBJECTANDLAYERIDCOLOR);var Ui=i(11983),Gi=(i(79246),i(8883)),Zi=i(49810);class Wi extends Ye.A{initializeConfiguration(e,t){t.spherical=e.viewingMode===B.JY.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Xe.$(e.rctx,Wi.shader.get().build(this.configuration),xe.i)}_setPipelineState(e){const t=this.configuration,i=e===Ke.A.NONE,r=e===Ke.A.FrontFace;return(0,$e.sm)({blending:t.output!==ie.H.Normal&&t.output!==ie.H.Highlight&&t.output!==ie.H.ObjectAndLayerIdColor&&t.transparent?i?Je.wu:(0,Je.j7)(e):null,depthTest:{func:(0,Je.Bh)(e)},depthWrite:i?t.writeDepth?$e.LZ:null:(0,Je.K5)(e),colorWrite:$e.BK,polygonOffset:i||r?null:(0,Je.je)(t.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}Wi.shader=new qe.J(Zi.W,(()=>i.e(9106).then(i.bind(i,19106))));class Bi extends Gi.W{constructor(){super(...arguments),this.output=ie.H.Color,this.transparencyPassType=Ke.A.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,S._)([(0,ue.o)({count:ie.H.COUNT})],Bi.prototype,"output",void 0),(0,S._)([(0,ue.o)({count:Ke.A.COUNT})],Bi.prototype,"transparencyPassType",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"spherical",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"receiveShadows",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"hasSlicePlane",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"transparent",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"enableOffset",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"writeDepth",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"hasScreenSpaceReflections",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"doublePrecisionRequiresObfuscation",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"hasCloudsReflections",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"objectAndLayerIdColorInstanced",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"isDraped",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"multipassEnabled",void 0),(0,S._)([(0,ue.o)()],Bi.prototype,"cullAboveGround",void 0),(0,S._)([(0,ue.o)({constValue:!1})],Bi.prototype,"occlusionPass",void 0),(0,S._)([(0,ue.o)({constValue:le.f7.Water})],Bi.prototype,"pbrMode",void 0),(0,S._)([(0,ue.o)({constValue:!0})],Bi.prototype,"useCustomDTRExponentForWater",void 0),(0,S._)([(0,ue.o)({constValue:!0})],Bi.prototype,"highStepCount",void 0),(0,S._)([(0,ue.o)({constValue:!1})],Bi.prototype,"useFillLights",void 0);class ki extends Ue.Z{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){const t=null!=e.ssr.lastFrameColor;t!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:t})}_updateCloudsReflectionState(e){const t=null!=e.cloudsFade.data;t!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:t})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===ie.H.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(Wi,e)}}class qi extends Ui.c{constructor(e){super(e,new Yi),this._configuration=new Bi,this._animation=new Vi}getConfiguration(e,t){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<Je.ve,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}update(e){const t=Math.min(e.camera.relativeElevation,e.camera.distance);this._animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*t<Ji;const i=this._animation.advance(e);return this.setParameters({timeElapsed:(0,ji.D9)(this._animation.time)*this.parameters.animationSpeed},!1),this._animation.enabled&&i}produces(e,t){switch(t){case ie.H.Normal:return e===Ze.r.DRAPED_WATER;case ie.H.Color:if(this.parameters.isDraped)return e===Ze.r.DRAPED_MATERIAL;break;case ie.H.Alpha:break;case ie.H.Highlight:case ie.H.ObjectAndLayerIdColor:return e===Ze.r.OPAQUE_MATERIAL||e===Ze.r.DRAPED_MATERIAL;default:return!1}let i=Ze.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?Ze.r.TRANSPARENT_MATERIAL:Ze.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new ki(e)}createBufferWriter(){return new Hi.G((0,d.Z)("enable-feature:objectAndLayerId-rendering")?zi:Ni)}get test(){return{animationEnabled:this._animation.enabled}}}class Yi extends Ge.Mt{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=(0,It.f)(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=(0,oe.f)(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=(0,p.c)(),this.modelTransformation=null}}const Ji=35e3;class Xi{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.from=e,this.to=t}get numElements(){return this.to-this.from}}function Qi(e){const t=new Map;e.forAll((e=>t.set(e.from,e)));let i=!0;for(;i;)i=!1,e.forEach((r=>{const n=t.get(r.to);n&&(r.to=n.to,t.delete(n.from),e.removeUnordered(n),i=!0)}))}class Ki extends Xi{constructor(e,t,i){super(t,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return null!=this.geometry.highlights&&this.isVisible}get hasOccludees(){return null!=this.geometry.occludees}}class $i{constructor(){this.first=0,this.count=0}}class er{constructor(){this._numElements=0,this._instances=new Map,this.holes=new G.Z({allocator:e=>e||new Xi,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=tr(),this.drawCommandsHighlight=tr(),this.drawCommandsOccludees=tr(),this.drawCommandsShadowHighlightRest=tr()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,t){this.deleteInstance(e),this._instances.set(e,t),this._numElements+=t.numElements}deleteInstance(e){const t=this._instances.get(e);t&&(this._numElements-=t.numElements,this._instances.delete(e))}updateInstance(e,t,i){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,r.from=t,r.to=i,this._numElements+=r.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,0===this._instances.size)return;if(!this.needsMultipleCommands()){const t=this.drawCommandsDefault.pushNew(),i=this.holes.front();return null!=this.vao&&1===this.holes.length&&i.to===Math.floor(this.vao.byteSize/e)?(t.first=0,void(t.count=i.from)):(t.first=1/0,t.count=0,this._instances.forEach((e=>{t.first=Math.min(t.first,e.from),t.count=Math.max(t.count,e.to)})),void(t.count-=t.first))}const t=Array.from(this._instances.values()).sort(((e,t)=>e.from===t.from?e.to-t.to:e.from-t.from));for(const i of t)i.isVisible&&(ir(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),ir(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}}function tr(){return new G.Z({allocator:e=>e||new $i,deallocator:e=>e})}function ir(e,t){const i=e.back();if(null==i){const i=e.pushNew();return i.first=t.from,void(i.count=t.numElements)}if(function(e,t){return e.first+e.count>=t.from}(i,t)){const e=t.from-i.first+t.numElements;i.count=e}else{const i=e.pushNew();i.first=t.from,i.count=t.numElements}}class rr{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach((e=>e.vao.dispose())),this.buffers.length=0}findBuffer(e){return this.buffers.find((t=>t.instances.has(e)))}}var nr=i(18759),sr=i(76861);const or=nr.o1+1;class ar{constructor(e,t,i){this._rctx=e,this._locations=t,this._layout=i,this._cache=new sr.N(e.newCache,"VAOCache")}dispose(){this._cache.destroy()}newVao(e){const t=e.toString();let i=this._cache.pop(t);return i||(i=new Oe.U(this._rctx,this._locations,{geometry:this._layout},{geometry:Pe.f.createVertex(this._rctx,Te.l1.STATIC_DRAW)}),i.vertexBuffers.geometry.setSize(e),i)}deleteVao(e){if(null==e)return;const t=e.byteSize.toString();this._cache.put(t,e,or)}}let lr=class extends ve.He{constructor(e){super(e),this._vaoCache=null,this._glMaterials=null,this._bufferWriter=null,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this.priority=0,this.produces=new Map}dispose(){this._glMaterials=(0,U.M2)(this._glMaterials),this._dataByOrigin.forEach((e=>e.dispose())),this._dataByOrigin.clear(),this._vaoCache=(0,U.M2)(this._vaoCache)}initializeRenderContext(e,t){const{rctx:i}=e.renderContext;this._glMaterials=new Ii(this.material,null!==t&&void 0!==t?t:e.materialRepository),this._bufferWriter=this.material.createBufferWriter(),this._vaoCache=new ar(i,this.material.vertexAttributeLocations,(0,Mi.K)(this._bufferWriter.vertexBufferLayout))}uninitializeRenderContext(){}get isEmpty(){return 0===this._dataByOrigin.size}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof qi}get isDecoration(){return this.material.parameters.isDecoration}get rendersOccluded(){return!this.isEmpty&&this.material.parameters.renderOccluded!==Ge.yD.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.instances.size),0))),e}get usedMemory(){let e=0;return this._dataByOrigin.forEach((t=>e+=t.buffers.reduce(((e,t)=>e+t.vao.usedMemory),0))),e}forEachGeometry(e){this._dataByOrigin.forEach((t=>t.buffers.forEach((t=>t.instances.forEach((t=>e(t.geometry)))))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const t=this._bufferWriter;if(null===t)return;const i=t.vertexBufferLayout.stride/4;for(const r of e){const e=r.renderGeometry,n=this._dataByOrigin.get(e.localOrigin.id),s=null===n||void 0===n?void 0:n.findBuffer(e.id);if(null==s)return;const o=s.instances.get(e.id);if(r.updateType&(a.GEOMETRY|a.TRANSFORMATION)){const r=wr(t.elementCount(o.geometry.geometry)*i),n=t.vertexBufferLayout.createView(r.buffer);this._writeGeometry(e,n,0),s.vao.vertexBuffers.geometry.setSubData(r,o.from*i,0,o.numElements*i)}r.updateType&(a.HIGHLIGHT|a.OCCLUDEE|a.VISIBILITY)&&(s.drawCommandsDirty=!0)}}_computeDeltas(e,t){const i=new he.r;for(const r of e){const e=r.localOrigin;if(null==e)continue;let t=i.get(e.id,null);null==t&&(t=new cr(e.vec3),i.set(e.id,null,t)),t.changes.push(r)}for(const r of t){const e=r.localOrigin;if(null==e)continue;const t=this._dataByOrigin.get(e.id),n=null===t||void 0===t?void 0:t.findBuffer(r.id);if(null==n)continue;let s=i.get(e.id,n);null==s&&(s=new cr(e.vec3),i.set(e.id,n,s)),s.changes.push(r)}return i}_addAndRemoveGeometries(e,t){if(null===this._bufferWriter||null===this._vaoCache)return;const{_bufferWriter:i,_dataByOrigin:r}=this,n=i.vertexBufferLayout.stride/4,s=this._computeDeltas(e,t);s.forEach(((e,t)=>{const o=e.get(null),a=null!=o?o.changes:[];s.delete(t,null);let l=r.get(t);if(e.forEach(((e,o)=>{if(s.delete(t,o),null==o)return void(0,be.hu)(!1,"No VAO for removed geometries");if(o.instances.size===e.changes.length)return this._vaoCache.deleteVao(o.vao),(0,R.e$)(l.buffers,o),void(0===l.buffers.length&&0===a.length&&r.delete(t));const c=o.numElements,d=o.vao.byteSize/4,h=a.reduce(((e,t)=>e+i.elementCount(t.geometry)),0),u=e.changes.reduce(((e,t)=>e+i.elementCount(t.geometry)),0),p=Math.min((c+h-u)*n,yr),f=p>d;p>gr&&p<d/2?(e.changes.forEach((e=>{let{id:t}=e;return o.deleteInstance(t)})),o.instances.forEach((e=>{let{geometry:t}=e;return a.push(t)})),this._vaoCache.deleteVao(o.vao),(0,R.e$)(l.buffers,o)):f?this._applyAndRebuild(o,a,e):this._applyRemoves(o,e)})),a.length>0)for(null==l&&(l=new rr(o.origin),r.set(t,l)),l.buffers.forEach((e=>this._applyAdds(e,a)));a.length>0;)l.buffers.push(this._applyAndRebuild(new er,a,null))}))}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach((e=>{e.buffers.forEach((e=>{e.drawCommandsDirty&&(e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,(0,z.oE)(e.instances,(t=>(e.updateDrawState(t),e.hasHiddenInstances&&e.hasHighlights&&e.hasOccludees))),e.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||e.hasHighlights,this._hasOccludees=this._hasOccludees||e.hasOccludees}))}))}_applyAndRebuild(e,t,i){if(null!=i)for(const p of i.changes)e.deleteInstance(p.id);const r=this._bufferWriter,n=r.vertexBufferLayout.stride,s=n/4,o=Math.floor(yr/s);let a=e.numElements;for(;t.length>0;){const i=t.pop(),n=r.elementCount(i.geometry);if(a+n>o&&a>0){t.push(i);break}a+=n;const s=new Ki(i,0,0);(0,be.hu)(null==e.instances.get(i.id)),e.addInstance(i.id,s)}const l=a*s,c=wr(l),d=r.vertexBufferLayout.createView(c.buffer);let h=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach(((t,i)=>{this._writeGeometry(t.geometry,d,h);const n=h;h+=r.elementCount(t.geometry.geometry),e.updateInstance(i,n,h),e.updateDrawState(t)})),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Sr(l)),e.vao.vertexBuffers.geometry.setSubData(c,0,0,h*s),e.holes.clear();const u=e.holes.pushNew();return u.from=h,u.to=Math.floor(e.vao.byteSize/n),e.updateDrawCommands(n),e}_applyRemoves(e,t){if(0===t.changes.length||null===this._bufferWriter)return;for(const o of t.changes){const t=o.id,i=e.instances.get(t);if(!i)continue;e.deleteInstance(t);const r=fr.back();if(r){if(r.to===i.from){r.to=i.to;continue}if(r.from===i.to){r.from=i.from;continue}}const n=fr.pushNew();n.from=i.from,n.to=i.to}Qi(fr);const i=this._bufferWriter.vertexBufferLayout.stride/4,r=fr.reduce(((e,t)=>Math.max(e,t.numElements)),0)*i,n=wr(r);n.fill(0,0,r);const s=e.vao.vertexBuffers.geometry;fr.forAll((e=>s.setSubData(n,e.from*i,0,e.numElements*i))),e.holes.pushArray(fr.data,fr.length),fr.forAll(((e,t)=>fr.data[t]=null)),fr.clear(),e.drawCommandsDirty=!0}_applyAdds(e,t){if(0===t.length||null===this._bufferWriter)return;if(!function(e){return null!=e.vao}(e))return void this._applyAndRebuild(e,t,null);const i=this._bufferWriter,r=i.vertexBufferLayout.stride/4,n=e.numElements,s=t.reduce(((e,t)=>e+i.elementCount(t.geometry)),0),o=Math.min((n+s)*r,yr),a=4*o;if(e.vao.byteSize<Sr(yr-gr)&&a>e.vao.byteSize)return void this._applyAndRebuild(e,t,null);Qi(e.holes);const l=new Array;for(const _ of t){const t=i.elementCount(_.geometry),r=dr(e.holes,t);l.push(r)}const c=e.vao.vertexBuffers.geometry;let d=0,h=0,u=0;const p=wr(o),f=i.vertexBufferLayout.createView(p.buffer);t.forEach(((t,n)=>{const s=l[n];if(null==s)return;if(u!==s){const e=u-h;e>0&&c.setSubData(p,h*r,0,e*r),h=s,d=0}const o=i.elementCount(t.geometry);this._writeGeometry(t,f,d),d+=o,u=s+o;const a=new Ki(t,s,s+o);(0,be.hu)(null==e.instances.get(t.id)),e.addInstance(t.id,a),e.drawCommandsDirty=!0}));const g=u-h;g>0&&c.setSubData(p,h*r,0,g*r),(0,R.hv)(t,((e,t)=>null==l[t]))}_writeGeometry(e,t,i){if(null===this._bufferWriter)return;const r=e.localOrigin.vec3;(0,be.u_)(hr,-r[0],-r[1],-r[2]);const n=(0,W.m)(ur,hr,e.transformation);(0,W.i)(pr,n),(0,W.t)(pr,pr),this._bufferWriter.write(n,pr,e.geometry,t,i)}updateAnimation(e){return this.material.update(e)}prepareTechnique(e){if(!this.material.shouldRender(e))return null;const{output:t,bindParameters:i}=e;if(!this.material.produces(i.slot,t))return null;const r=t===ie.H.Highlight||t===ie.H.ShadowHighlight;if(r&&!this._hasHighlights)return null;const n=t===ie.H.ShadowExcludeHighlight,s=!(r||n);for(const o of this._dataByOrigin.values())for(const a of o.buffers){if(r&&!a.hasHighlights)continue;const o=(r?a.drawCommandsHighlight:n&&a.needsMultipleCommands()?a.drawCommandsShadowHighlightRest:a.drawCommandsDefault)||null,l=s&&a.drawCommandsOccludees||null;if(null!==o&&void 0!==o&&o.length||null!==l&&void 0!==l&&l.length){const r=this._glMaterials.load(e.rctx,i.slot,t),n=null!=r?r.beginSlot(i):null;if(null!=n)return n}}return null}renderNode(e,t){const{output:i,bindParameters:r}=e,n=i===ie.H.Highlight||i===ie.H.ShadowHighlight,s=i===ie.H.ShadowExcludeHighlight,o=!(n||s),a=e.rctx,l=e.bindParameters.slot===Ze.r.OCCLUDER_MATERIAL,c=e.bindParameters.slot===Ze.r.TRANSPARENT_OCCLUDER_MATERIAL;a.runAppleAmdDriverHelper(),a.bindTechnique(t,this.material.parameters,r);for(const d of this._dataByOrigin.values())for(const e of d.buffers){if(n&&!e.hasHighlights)continue;const i=(n?e.drawCommandsHighlight:s&&e.needsMultipleCommands()?e.drawCommandsShadowHighlightRest:e.drawCommandsDefault)||null,h=o&&e.drawCommandsOccludees||null;(null!==i&&void 0!==i&&i.length||null!==h&&void 0!==h&&h.length)&&(t.program.bindDraw(new Fi(d.origin),r,this.material.parameters),t.ensureAttributeLocations(e.vao),a.bindVAO(e.vao),null!==i&&void 0!==i&&i.length&&(a.setPipelineState(t.getPipeline(!1,l,c)),i.forAll((e=>a.drawArrays(t.primitiveType,e.first,e.count)))),(null===h||void 0===h?void 0:h.length)&&(a.setPipelineState(t.getPipeline(!0,l,c)),h.forAll((e=>a.drawArrays(t.primitiveType,e.first,e.count)))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}};(0,S._)([(0,T.Cb)({constructOnly:!0})],lr.prototype,"material",void 0),lr=(0,S._)([(0,O.j)("esri.views.3d.webgl-engine.materials.renderers.MergedRenderer")],lr);class cr{constructor(e){this.origin=e,this.changes=new Array}}function dr(e,t){let i;if(!e.some((e=>!(e.numElements<t)&&(i=e,!0))))return null;const r=i.from;return i.from+=t,i.from>=i.to&&e.removeUnordered(i),r}const hr=(0,Mt.a)(),ur=(0,Mt.a)(),pr=(0,Mt.a)(),fr=new G.Z({allocator:e=>e||new Xi,deallocator:null}),gr=65536,_r=4*gr,vr=1024,mr=16777216,yr=mr/4;let br=new Float32Array(gr);function wr(e){return br.length<e&&(br=new Float32Array(e)),br}function Sr(e){const t=4*e;return t<=vr?vr:t<_r?(0,je.Sf)(t):Math.max(Math.min(Math.ceil(1.5*t/_r)*_r,mr),t)}let xr=class extends x.Z{constructor(e){super(e),this._pending=new Cr,this._changes=new Pi,this._materialRenderers=new G.Z,this._sortedMaterialRenderers=new G.Z,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forAll((e=>e.dispose())),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._materialRenderers.some((e=>e.rendersOccluded))}get isEmpty(){return!this.updating&&0===this._materialRenderers.length&&0===this._geometries.size}getMemoryForMaterial(e){var t;if(null==e)return 0;const i=this._materialRenderers.find((t=>t.material===e));return null!==(t=null===i||void 0===i?void 0:i.usedMemory)&&void 0!==t?t:0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=function(e){const t=new Map,i=e=>{let i=t.get(e);return i||(i=new Ai,t.set(e,i)),i};return e.removes.forAll((e=>{Li(e)&&i(e.material).removes.push(e)})),e.adds.forAll((e=>{Li(e)&&i(e.material).adds.push(e)})),e.updates.forAll((e=>{Li(e.renderGeometry)&&i(e.renderGeometry.material).updates.push(e)})),t}(this._changes);let t=!1,i=!1,r=!1;return e.forEach(((e,n)=>{let s=this._materialRenderers.find((e=>e.material===n));if(!s&&e.adds.length>0){const e=new lr({material:n});e.initializeRenderContext(this.rendererContext.pluginContext,this._materialRepository),s=e,this._materialRenderers.push(s),t=!0,i=!0,r=!0}if(!s)return;const o=i||s.hasHighlights,a=r||s.hasWater;s.modify(e),i=i||o!==s.hasHighlights,r=r||a!==s.hasWater,s.isEmpty&&(this._materialRenderers.removeUnordered(s),s.dispose(),t=!0)})),this._changes.clear(),t&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=this._materialRenderers.some((e=>e.hasHighlights))),r&&(this._hasWater=this._materialRenderers.some((e=>e.hasWater))),this.notifyChange("updating"),!0}addGeometries(e,t){if(0===e.length)return;const i=this._validateRenderGeometries(e);for(const n of i)this._geometries.set(n.id,n);const r=this._pending.empty;for(const n of i)this._pending.adds.add(n);r&&this.notifyChange("updating"),t===o.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,t){const i=this._pending.empty,r=this._pending.adds;for(const n of e)r.has(n)?(this._pending.removed.add(n),r.delete(n)):this._pending.removed.has(n)||this._pending.removes.add(n),this._geometries.delete(n.id);i&&!this._pending.empty&&this.notifyChange("updating"),t===o.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,t){const i=0===this._changes.updates.length;for(const r of e){const e=this._changes.updates.pushNew();e.renderGeometry=this._validateRenderGeometry(r),e.updateType=t}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),t){case a.TRANSFORMATION:case a.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case a.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let t=!1;return this._sortedMaterialRenderers.forAll((i=>t=i.updateAnimation(e)||t)),t}shouldRender(e){return this._sortedMaterialRenderers.some((t=>t.prepareTechnique(e)))}render(e){this._sortedMaterialRenderers.forAll((t=>{const i=t.prepareTechnique(e);null!=i&&t.renderNode(e,i)}))}intersect(e,t,i,r,n){return this._geometries.forEach((s=>{if(r&&!r(s))return;this._intersectRenderGeometry(s,i,t,0,e,n);const o=this.rendererContext.longitudeCyclical;o&&(s.boundingSphere[0]-s.boundingSphere[3]<o.min&&this._intersectRenderGeometry(s,i,t,o.range,e,n),s.boundingSphere[0]+s.boundingSphere[3]>o.max&&this._intersectRenderGeometry(s,i,t,-o.range,e,n)),n++})),n}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear(),this._materialRenderers.forAll(((e,t)=>{e.priority=t,this._sortedMaterialRenderers.push(e)})),this._sortedMaterialRenderers.sort(((e,t)=>t.material.renderPriority===e.material.renderPriority?e.priority-t.priority:t.material.renderPriority-e.material.renderPriority))}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const t=this._changes.updates.data[e];this._pending.has(t.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,t,i,r,n,s){if(!e.visible)return;let o=0;r+=e.transformation[12],o=e.transformation[13],Tr[0]=i[0]-r,Tr[1]=i[1]-o,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,n,Tr,((i,r,o)=>{!function(e,t,i,r,n,s,o){const a=new Oi(s,o,t),l=t=>{t.set(Ti.q7.OVERLAY,a,e.dist,e.normal,e.transformation,i,r)};if((null==n.results.min.drapedLayerOrder||i>=n.results.min.drapedLayerOrder)&&(null==n.results.min.dist||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Ti.eC.MIN&&(null==n.results.max.drapedLayerOrder||i<n.results.max.drapedLayerOrder)&&(null==n.results.max.dist||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Ti.eC.ALL){const e=(0,Di.LP)(n.ray);l(e),n.results.all.push(e)}}(t,o,e.material.renderPriority,s,n,e.layerUid,e.graphicUid)}),t)}_notifyGraphicGeometryChanged(e){if(null==this.drapeSource.notifyGraphicGeometryChanged)return;let t;for(const i of e){const e=i.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicGeometryChanged(e),t=e)}}_notifyGraphicVisibilityChanged(e){if(null==this.drapeSource.notifyGraphicVisibilityChanged)return;let t;for(const i of e){const e=i.graphicUid;null!=e&&e!==t&&(this.drapeSource.notifyGraphicVisibilityChanged(e),t=e)}}_validateRenderGeometries(e){for(const t of e)this._validateRenderGeometry(t);return e}_validateRenderGeometry(e){return null==e.localOrigin&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};(0,S._)([(0,T.Cb)()],xr.prototype,"drapeSource",void 0),(0,S._)([(0,T.Cb)()],xr.prototype,"updating",null),(0,S._)([(0,T.Cb)()],xr.prototype,"rctx",null),(0,S._)([(0,T.Cb)({constructOnly:!0})],xr.prototype,"rendererContext",void 0),(0,S._)([(0,T.Cb)()],xr.prototype,"_materialRepository",null),(0,S._)([(0,T.Cb)()],xr.prototype,"_localOriginFactory",null),(0,S._)([(0,T.Cb)({readOnly:!0})],xr.prototype,"isEmpty",null),(0,S._)([(0,T.Cb)()],xr.prototype,"_materialRenderers",void 0),(0,S._)([(0,T.Cb)()],xr.prototype,"_geometries",void 0),xr=(0,S._)([(0,O.j)("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],xr);class Cr{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}}const Tr=(0,It.a)();class Rr extends Ye.A{initializeProgram(e){return new Xe.$(e.rctx,Rr.shader.get().build(),xe.i)}initializePipeline(){return this.configuration.hasAlpha?(0,$e.sm)({blending:(0,$e.wK)(Te.zi.SRC_ALPHA,Te.zi.ONE,Te.zi.ONE_MINUS_SRC_ALPHA,Te.zi.ONE_MINUS_SRC_ALPHA),colorWrite:$e.BK}):(0,$e.sm)({colorWrite:$e.BK})}}Rr.shader=new qe.J(de.a,(()=>i.e(7026).then(i.bind(i,77026))));class Or extends ue.m{constructor(){super(...arguments),this.hasAlpha=!1}}(0,S._)([(0,ue.o)()],Or.prototype,"hasAlpha",void 0);var Pr=i(11954),Er=i(38365);class Ar extends Ye.A{initializeProgram(e){return new Xe.$(e.rctx,Ar.shader.get().build(),xe.i)}initializePipeline(){return(0,$e.sm)({blending:(0,$e.if)(Te.zi.ONE,Te.zi.ONE_MINUS_SRC_ALPHA),colorWrite:$e.BK})}}Ar.shader=new qe.J(Er.a,(()=>i.e(6487).then(i.bind(i,46487))));var Dr=i(99912);let Lr=class extends ve.tY{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._renderTargets=null,this._overlayParameters=new Er.O,this.hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new G.Z,this._passParameters=new de.T,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._camera=new me.V,this.worldToPCSRatio=1,this.events=new N.Z,this.longitudeCyclical=null,this.produces=new Map([[Ze.r.DRAPED_MATERIAL,e=>e!==ie.H.Highlight||this.hasHighlights],[Ze.r.DRAPED_WATER,()=>!0]]),this._hasTargetWithoutRasterImage=!1,this._hasDrapedFeatureSource=!1,this._hasDrapedRasterSource=!1}initialize(){const e=this.view._stage.renderer.fboCache,t=this.view._stage.renderView,{waterTextureRepository:i,stippleTextureRepository:r,markerTextureRepository:n}=t;this._shaderTechniqueRepository=new pe({rctx:this._rctx,viewingMode:B.JY.Local,stippleTextureRepository:r,markerTextureRepository:n,waterTextureRepository:i}),this._renderContext=new Zt(this._rctx,new Qt(e,this.view.state.viewingMode),null),this.addHandles([(0,L.YP)((()=>i.updating),(()=>this.events.emit("content-changed")),L.tX),(0,L.YP)((()=>this.spatialReference),(e=>this._localOriginFactory=new Dt(e)),L.tX),(0,L.on)((()=>this.view.allLayerViews),"after-changes",(()=>this._sortedDrapeSourceRenderersDirty=!0))]),this._materialRepository=new we(t.textureRepository,this._shaderTechniqueRepository,(e=>{(e.parameters.renderOccluded&Fr)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")}),(()=>this.events.emit("content-changed"))),this._bindParameters.slot=Ze.r.DRAPED_MATERIAL,this._bindParameters.mainDepth=function(e){const t=new Ae.X(1);return t.samplingMode=Te.cw.NEAREST,new Ee.x(e,t,new Uint8Array([255,255,255,255]))}(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=Ke.A.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Pr.Mi((0,p.f)(1,1,1))]),this.addHandles(this.view.resourceController.scheduler.registerTask(Dr.T8.STAGE,this))}destroy(){this._renderers.forEach((e=>e.destroy())),this._renderers.clear(),this._debugTextureTechnique=(0,U.RY)(this._debugTextureTechnique),this._passParameters.texture=(0,U.M2)(this._passParameters.texture),this._bindParameters.mainDepth=(0,U.M2)(this._bindParameters.mainDepth),this._shaderTechniqueRepository=(0,U.SC)(this._shaderTechniqueRepository),this.disposeOverlays()}initializeRenderContext(e){this.pluginContext=e}uninitializeRenderContext(){}renderNode(){}get updating(){return this._sortedDrapeSourceRenderersDirty||(0,z.oE)(this._renderers,(e=>e.updating))}get hasOverlays(){return null!=this._overlays&&null!=this._renderTargets}getMemoryForMaterial(e){return Array.from(this._renderers.values()).reduce(((t,i)=>t+i.getMemoryForMaterial(e)),0)}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,xr)}createDrapeSourceRenderer(e,t,i){const r=this._renderers.get(e);null!=r&&r.destroy();const n=new t({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,n),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this.addHandles((0,L.YP)((()=>e.fullOpacity),(()=>this.events.emit("content-changed"))),e),n}removeDrapeSourceRenderer(e){if(null==e)return;const t=this._renderers.get(e);null!=t&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this.removeHandles(e),t.destroy())}computeValidity(){var e,t;return null!==(e=null===(t=this._renderTargets)||void 0===t?void 0:t.computeValidity())&&void 0!==e?e:0}releaseRenderTargets(){var e;null===(e=this._renderTargets)||void 0===e||e.dispose()}get overlays(){var e;return null!==(e=this._overlays)&&void 0!==e?e:[]}ensureDrapeTargets(e){this._hasTargetWithoutRasterImage=!!this._overlays&&(0,Z.fn)(e,(e=>e.drapeTargetType===s.WithoutRasterImage))}ensureDrapeSources(e){this._overlays?(this._hasDrapedFeatureSource=(0,Z.fn)(e,(e=>e.drapeSourceType===r.Features)),this._hasDrapedRasterSource=(0,Z.fn)(e,(e=>e.drapeSourceType===r.RasterImage))):this._hasDrapedFeatureSource=this._hasDrapedRasterSource=!1}get _needsColorWithoutRasterImage(){return this._hasDrapedRasterSource&&this._hasDrapedFeatureSource&&this._hasTargetWithoutRasterImage}ensureOverlays(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._bindParameters.overlayStretch;null==this._overlays&&(this._renderTargets=new ne(this.view._stage.renderer.fboCache),this._overlays=[new Q,new Q]),this.ensureDrapeTargets(e),this.ensureDrapeSources(t),this._bindParameters.overlayStretch=i}disposeOverlays(){this._overlays=null,this._renderTargets=(0,U.M2)(this._renderTargets),this.events.emit("textures-disposed")}getTexture(e){var t,i;if(null!=e)return e===$.ColorNoRasterImage&&!this._needsColorWithoutRasterImage&&this._hasDrapedFeatureSource?null===(t=this._renderTargets)||void 0===t?void 0:t.getTexture($.Color):null===(i=this._renderTargets)||void 0===i?void 0:i.getTexture(e)}get running(){return this.updating}runTask(e){this._processDrapeSources(e,(()=>!0))}_processDrapeSources(e,t){let i=!1;for(const[r,n]of this._renderers){if(e.done)break;(r.destroyed||t(r))&&n.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(null!=this._overlays&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this.hasHighlights=(0,z.oE)(this._renderers,(e=>e.hasHighlights)),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(Dr.G5,(e=>e.updatePolicy===P.j.SYNC))}get isEmpty(){return!k.h.OVERLAY_DRAW_DEBUG_TEXTURE&&!(0,z.oE)(this._renderers,(e=>!e.isEmpty))}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}get mode(){var e,t;return this.isEmpty?ce.Disabled:null!==(e=this._renderTargets)&&void 0!==e&&e.getTexture($.WaterNormal)?ce.EnabledWithWater:null!==(t=this._renderTargets)&&void 0!==t&&t.getTexture($.Color)?ce.Enabled:ce.Disabled}updateAnimation(e){let t=!1;return this._renderers.forEach((i=>t=i.updateAnimation(e)||t)),t}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawOverlays(e){if(this._overlays&&this._renderTargets){for(const e of this._overlays)this.longitudeCyclical?e.setupGeometryViewsCyclical(this.longitudeCyclical):e.setupGeometryViewsDirect();for(const t of this._renderTargets.targets)(t.content!==$.ColorNoRasterImage||this._needsColorWithoutRasterImage)&&(this._drawTarget(q.fu.INNER,t,e),this._drawTarget(q.fu.OUTER,t,e))}}_drawTarget(e,t,i){const n=this._overlays[e],s=n.canvasGeometries;if(0===s.numViews)return;const{alignPixelEnabled:o,contentPixelRatio:a}=i;this._screenToWorldRatio=a*n.mapUnitsPerPixel/this._bindParameters.overlayStretch;const l=t.output;if(this.isEmpty||l===ie.H.Highlight&&!this.hasHighlights||l===ie.H.Normal&&!this.hasWater||!n.hasSomeSizedView())return;const c=this._rctx;this._camera.pixelRatio=n.pixelRatio*a,this._renderContext.output=l,this._bindParameters.alignPixelEnabled=o,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=l===ie.H.Normal?Ze.r.DRAPED_WATER:Ze.r.DRAPED_MATERIAL;const d=k.h.OVERLAY_DRAW_DEBUG_TEXTURE&&t.content!==$.Occluded;if(!d&&!this._sortedRenderers.some((e=>{let{renderer:t}=e;return t.shouldRender(this._renderContext)})))return;const h=n.resolution;this._rctx.setViewport(e===q.fu.INNER?0:h,0,h,h);const u=2*n.resolution,p=n.resolution,f=t.fbo;if(f.bind(c,u,p),e===q.fu.INNER&&(c.setClearColor(0,0,0,0),c.clearSafe(Te.lk.COLOR_BUFFER_BIT)),t.content===$.Occluded&&(this._renderContext.renderOccludedMask=Fr),d)for(let r=0;r<s.numViews;r++)this._setViewParameters(s.extents[r],n),this._ensureDebugPatternResources(n.resolution,Ir[e]),this._rctx.bindTechnique(this._debugTextureTechnique,this._passParameters,null),this._rctx.screen.draw();this._sortedRenderers.forAll((i=>{let{drapeSource:o,renderer:a}=i;if(t.content===$.ColorNoRasterImage&&o.drapeSourceType===r.RasterImage)return;const{fullOpacity:d}=o,h=null!=d&&d<1&&l===ie.H.Color?this.bindTemporaryFramebuffer(u,p):null;for(let e=0;e<s.numViews;e++)this._setViewParameters(s.extents[e],n),a.render(this._renderContext);if(h){f.bind(c,u,p),this._overlayParameters.texture=h.colorTexture,this._overlayParameters.opacity=d,this._overlayParameters.overlayIndex=e;const t=this.pluginContext.techniqueRepository.acquire(Ar);this._rctx.bindTechnique(t,this._overlayParameters,this._renderContext.bindParameters),this._rctx.screen.draw(),t.release(),h.release()}})),c.bindFramebuffer(null),e===q.fu.OUTER&&f.generateMipMap(),this._renderContext.resetRenderOccludedMask()}bindTemporaryFramebuffer(e,t){const i=this.view._stage.renderer.fboCache,r=i.acquire(te.qz.RGBA,e,t);return i.rctx.bindFramebuffer(r.fbo),i.rctx.clearSafe(Te.lk.COLOR_BUFFER_BIT),r}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,t,i,r){let n=0;for(const a of this._renderers.values()){var s,o;n=null!==(s=null===(o=a.intersect)||void 0===o?void 0:o.call(a,e,t,i,r,n))&&void 0!==s?s:n}}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),0===this._renderers.size)return;const e=this.view.map.allLayers;this._renderers.forEach(((t,i)=>{var r;const s=e.indexOf(i.layer),o=s>=0,a=this._renderers.size*(null!==(r=i.renderGroup)&&void 0!==r?r:o?n.MapLayer:n.ViewLayer)+(o?s:0);this._sortedRenderers.push(new Mr(i,t,a))})),this._sortedRenderers.sort(((e,t)=>e.index-t.index))}_setViewParameters(e,t){const i=this._camera;i.viewport=[0,0,t.resolution,t.resolution],(0,W.x)(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),(0,W.d)(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=(0,z.oE)(this._renderers,(e=>e.hasWater));e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateRendersOccluded(){const e=(0,z.oE)(this._renderers,(e=>e.rendersOccluded));e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_ensureDebugPatternResources(e,t){if((0,u.s)(this._passParameters.color,t[0],t[1],t[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let r=0;for(let o=0;o<e;o++)for(let t=0;t<e;t++){const n=Math.floor(t/10),s=Math.floor(o/10);n<2||s<2||10*n>e-20||10*s>e-20?(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=255):(i[r++]=255,i[r++]=255,i[r++]=255,i[r++]=1&n&&1&s?1&t^1&o?0:255:1&n^1&s?0:128)}const n=new Ae.X(e);n.samplingMode=Te.cw.NEAREST,this._passParameters.texture=new Ee.x(this._rctx,n,i);const s=new Or;s.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(Rr,s)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};(0,S._)([(0,T.Cb)()],Lr.prototype,"hasHighlights",void 0),(0,S._)([(0,T.Cb)()],Lr.prototype,"_sortedDrapeSourceRenderersDirty",void 0),(0,S._)([(0,T.Cb)({autoDestroy:!0})],Lr.prototype,"_shaderTechniqueRepository",void 0),(0,S._)([(0,T.Cb)({constructOnly:!0})],Lr.prototype,"view",void 0),(0,S._)([(0,T.Cb)()],Lr.prototype,"worldToPCSRatio",void 0),(0,S._)([(0,T.Cb)()],Lr.prototype,"spatialReference",void 0),(0,S._)([(0,T.Cb)({type:Boolean,readOnly:!0})],Lr.prototype,"updating",null),(0,S._)([(0,T.Cb)()],Lr.prototype,"isEmpty",null),Lr=(0,S._)([(0,O.j)("esri.views.3d.terrain.OverlayRenderer")],Lr);class Mr{constructor(e,t,i){this.drapeSource=e,this.renderer=t,this.index=i}}const Ir=[[1,.5,.5],[.5,.5,1]],Fr=Ge.yD.OccludeAndTransparent;var jr=i(70619),Vr=i(23470),Hr=i(80064);class Nr{constructor(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.geometry=e,this.screenToWorldRatio=1,this._transformation=(0,Mt.a)(),this._shaderTransformation=null,this._boundingSphere=null,this.id=(0,De.D)(),this.layerUid=i.layerUid,this.graphicUid=i.graphicUid,this.castShadow=null!==(t=i.castShadow)&&void 0!==t&&t,null!=i.objectShaderTransformation&&this.objectShaderTransformationChanged(i.objectShaderTransformation)}get transformation(){return this._transformation}set transformation(e){(0,W.h)(this._transformation,e),this._boundingSphere=null}get boundingInfo(){return this.geometry.boundingInfo}objectShaderTransformationChanged(e){var t;null==e?this._shaderTransformation=null:(null!==(t=this._shaderTransformation)&&void 0!==t||(this._shaderTransformation=(0,Mt.a)()),(0,W.m)(this._shaderTransformation,e,this.geometry.transformation)),this._boundingSphere=null}get boundingSphere(){var e;return this.boundingInfo?(null==this._boundingSphere&&(null!==(e=this._boundingSphere)&&void 0!==e||(this._boundingSphere=(0,Vr.c)()),(0,u.e)(this._boundingSphere,this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*(0,Hr.u1)(this.shaderTransformation)),this._boundingSphere):Vr.N}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return null==this._shaderTransformation?this.transformation:this._shaderTransformation}get attributes(){return this.geometry.attributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}}class zr extends V{constructor(e){super(e),this._ray=(0,w.Ue)(),this._isWorldDown=!1,this._start=(0,p.c)(),this._end=(0,p.f)(1,0,0),this._width=1,this._color=(0,v.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,v.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=Br.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=Ge.yD.OccludeAndTransparent,this._fadedExtensions=qr,this._laserline=new H.W({view:this.view,isDecoration:e.isDecoration}),this.applyProperties(e)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyExternalResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}updateVisibility(e){super.updateVisibility(e),this._laserline.visible=e}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(e){this._isWorldDown=!0,(0,u.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,u.f)(this._end,e,this._end),(0,w.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(e){this._isWorldDown=!1,(0,u.h)(this._start,e)||((0,u.c)(this._start,e),(0,w.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(e){this._isWorldDown=!1,(0,u.h)(this._end,e)||((0,u.c)(this._end,e),(0,w.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){(0,_.h)(e,this._color)||((0,_.c)(this._color,e),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(e){(0,_.h)(e,this._innerColor)||((0,_.c)(this._innerColor,e),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(e){const t=null!=e!=(null!=this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(e){null!=e&&null!=this._stippleOffColor&&(0,_.h)(e,this._stippleOffColor)||(this._stippleOffColor=null!=e?(0,v.c)(e):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&null!=this._laserlineStyle&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,null!=e&&(this._laserline.style=e)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===Ge.yD.OccludeAndTransparentStencil?Ge.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(e){this._fadedExtensions=null!==e&&void 0!==e?e:qr,this.recreateGeometry()}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,isDecoration:this.isDecoration,writeDepth:this._writeDepthEnabled}}_createObject3DResources(e){const t=new st(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyExternalResources(e){e.geometries=[]}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const r=this._createGeometry(e);i.push(r),t.addGeometry(r),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new st(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}_recreateDrapedGeometry(e){e.geometries=[this._createDrapedGeometry(e.material)]}_createDrapedGeometry(e){const t=this._createGeometry(e);return this._updateVerticesDraped(t),new Nr(t)}_createGeometry(e){const t=this.extensionType===Br.FADED,i=t?[(0,p.c)(),(0,p.c)(),(0,p.c)(),(0,p.c)()]:[(0,p.c)(),(0,p.c)()];return(0,jr.rh)(e,i,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}_updateVerticesDraped(e){this._updateVertexAttributesDraped(e,this._lineSegment)}get _lineSegment(){return this._extensionType===Br.FADED?this._updateLineSegmentFinite(Wr):this._updateLineSegmentInfinite(this._extensionType,Wr)}_updateLineSegmentFinite(e){return(0,b.zk)(this._start,this._end,e)}_updateLineSegmentInfinite(e,t){const i=this.view.state.camera;switch((0,m.iL)(this._ray,Ur),e){case Br.LINE:Ur.c0=-Number.MAX_VALUE;break;case Br.RAY:case Br.GROUND_RAY:{var r;const e=this._ray.origin,t=null!==(r=this.view.elevationProvider.getElevation(e[0],e[1],e[2],this.view.renderCoordsHelper.spatialReference,"ground"))&&void 0!==r?r:0,i=this.view.renderCoordsHelper.getAltitude(e);this._isWorldDown&&i<t&&(0,u.E)(Ur.ray.direction,Ur.ray.direction),this._extensionType===Br.GROUND_RAY&&null!=t&&(Ur.c1=Math.abs(i-t));break}}if(!(0,y.zq)(i.frustum,Ur))return this._updateLineSegmentFinite(t);const n=(0,m.Ws)(Ur,Gr),s=(0,m.S$)(Ur,Zr);return(0,b.zk)(n,s,t)}_updateVertexAttributesObject3D(e,t){var i;const r=null===(i=e.geometries[0].getMutableAttribute(Ce.T.POSITION))||void 0===i?void 0:i.data;if(!r)return;let n=0;for(const s of this._lineVertices(t))r[n++]=s[0],r[n++]=s[1],r[n++]=s[2];e.geometryVertexAttributeUpdated(e.geometries[0],Ce.T.POSITION)}_updateVertexAttributesDraped(e,t){var i;const r=null===(i=e.getMutableAttribute(Ce.T.POSITION))||void 0===i?void 0:i.data;if(!r)return;let n=0;for(const s of this._lineVertices(t))r[n++]=s[0],r[n++]=s[1],r[n++]=-2;e.invalidateBoundingInfo()}*_lineVertices(e){this.extensionType===Br.FADED?(yield(0,b.KU)(e,-this.fadedExtensions.start,Gr),yield(0,b.KU)(e,0,Gr),yield(0,b.KU)(e,1,Gr),yield(0,b.KU)(e,1+this.fadedExtensions.end,Gr)):(yield(0,b.KU)(e,0,Gr),yield(0,b.KU)(e,1,Gr))}}const Ur=(0,m.Ue)(),Gr=(0,p.c)(),Zr=(0,p.c)(),Wr=(0,b.Ue)();var Br;!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(Br||(Br={}));const kr=1/3,qr={start:kr,end:kr};var Yr=i(55946);class Jr extends V{constructor(e){super(e),this._location=(0,p.c)(),this._direction=(0,p.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,v.f)(1,0,1,1),this._renderOccluded=Ge.yD.OccludeAndTransparent,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:e=>this._destroyObject3DResources(e),recreateGeometry:(e,t)=>this._recreateObject3DGeometry(e,t),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e),recreateGeometry:e=>this._recreateDrapedGeometry(e)}}get location(){return this._location}set location(e){(0,u.h)(this._location,e)||((0,u.c)(this._location,e),this._updateGeometry())}get direction(){return this._direction}set direction(e){(0,u.h)(this._direction,e)||((0,u.c)(this._direction,e),this._updateGeometry())}setDirectionFromPoints(e,t){(0,u.n)(this._direction,(0,u.f)(this._direction,t,e)),this._updateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get offset(){return this._offset}set offset(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}get length(){return this._length}set length(e){e!==this._length&&(this._length=e,this._updateGeometry())}get color(){return this._color}set color(e){(0,_.h)(e,this._color)||((0,_.c)(this._color,e),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}_createObject3DResources(e){const t=new st(this.materialParameters),i=new Array;return this._createObject3DGeometry(t,e,i),{material:t,geometries:i,forEach:e=>{e(t),i.forEach(e)}}}_destroyObject3DResources(e){e.geometries.length=0}_recreateObject3DGeometry(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}_createObject3DGeometry(e,t,i){const[r,n]=this._createGeometries(e);t.addGeometry(r),t.addGeometry(n),i.push(r),i.push(n),this._updateVerticesObject3D(t)}_createDrapedResources(){const e=new st(this.materialParameters),t=(0,L.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}));return{material:e,geometries:this._createDrapedGeometry(e),pixelRatioHandle:t}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_recreateDrapedGeometry(e){e.geometries=this._createDrapedGeometry(e.material)}_createDrapedGeometry(e){const t=this._createGeometries(e);return this._updateVerticesDraped(t),t.map((e=>new Nr(e)))}_createGeometries(e){return[(0,jr.rh)(e,[(0,p.c)(),(0,p.c)()]),(0,jr.rh)(e,[(0,p.c)(),(0,p.c)()])]}_updateMaterial(){var e,t;const{materialParameters:i}=this;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.material.setParameters(i),null===(t=this.drapedResources.resources)||void 0===t||t.material.setParameters(i)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const e=this.object3dResources.object;e&&this._updateVerticesObject3D(e)}}_updateVerticesObject3D(e){const t=this.view.state.camera;t.projectToScreen(this.location,en),(0,u.g)(Xr,this.location,this.direction),t.projectToScreen(Xr,tn),(0,He.e)(tn,(0,He.c)(tn,tn,en)),this._updateVertexAttributesObject3D(t,e,0,en,tn,1),this._updateVertexAttributesObject3D(t,e,1,en,tn,-1)}_updateVertexAttributesObject3D(e,t,i,r,n,s){var o;const a=t.geometries[i],l=null===(o=a.getMutableAttribute(Ce.T.POSITION))||void 0===o?void 0:o.data;if(!l)return;const{start:c,end:d}=this._computeStartEnd(n,r,s,this.offset,this.width,this.length);e.unprojectFromScreen((0,Ve.c$)(c),Xr),l[0]=Xr[0],l[1]=Xr[1],l[2]=Xr[2],e.unprojectFromScreen((0,Ve.c$)(d),Xr),l[3]=Xr[0],l[4]=Xr[1],l[5]=Xr[2],t.geometryVertexAttributeUpdated(a,Ce.T.POSITION)}_updateVerticesDraped(e){const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{location:r,width:n,length:s,offset:o}=this,a=rn;a.spatialReference=t.renderer.spatialReference,a.x=r[0],a.y=r[1];const l=this.view.overlayPixelSizeInMapUnits(a)*i,c=n*l,d=s*l,h=o*l;this._updateVertexAttributesDraped(e[0],c,d,h,-1),this._updateVertexAttributesDraped(e[1],c,d,h,1)}_updateVertexAttributesDraped(e,t,i,r,n){var s;const o=null===(s=e.getMutableAttribute(Ce.T.POSITION))||void 0===s?void 0:s.data;if(!o)return;const{location:a,direction:l}=this,{start:c,end:d}=this._computeStartEnd(l,a,n,r,t,i);o[0]=c[0],o[1]=c[1],o[2]=-2,o[3]=d[0],o[4]=d[1],o[5]=-2,e.invalidateBoundingInfo()}_computeStartEnd(e,t,i,r,n,s){const o=(0,He.a)(Qr,(0,He.s)(Qr,e[1]*i,e[0]*-i),r+n/2),a=(0,He.i)(Kr,(0,He.i)(Kr,(0,He.i)(Kr,t,(0,He.a)(Kr,e,s/2)),o),o);return{start:a,end:(0,He.i)($r,a,(0,He.a)($r,e,-s))}}}const Xr=(0,p.c)(),Qr=(0,It.a)(),Kr=(0,It.a)(),$r=(0,It.a)(),en=(0,Ve.s1)(),tn=(0,Ve.s1)(),rn=(0,Yr.T)(0,0,void 0,null);var nn=i(41414),sn=i(51378);class on extends D.l{constructor(e){super(e),this._resources=null,this._transform=(0,Mt.a)()}get object(){return null!=this._resources?this._resources.object:null}get transform(){return this._transform}set transform(e){(0,W.h)(this._transform,e),null!=this._resources&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if(null==this._resources)return;const e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),e.visible=this.visible,t.addMany(e.geometries)}createResources(){this.destroyResources();const e=this.view._stage;if(!e)return;const t=new F.F(e,{pickable:!1,updatePolicy:P.j.SYNC}),i=new I.T({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((t=>e.add(t))),e.add(i),t.add(i),i.visible=this.visible,this._resources={layer:t,object:i}}destroyResources(){const e=this.view._stage;null!=this._resources&&e&&(e.remove(this._resources.object),this._resources.layer.destroy(),this.forEachExternalMaterial((t=>{e.remove(t)})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(e){null!=this._resources&&(this._resources.object.visible=e)}}i(37998);var an,ln=i(81020),cn=(i(96387),i(77648));function dn(e,t,i,r,n){const s=((0,ln.f)(e)?e.z:(0,cn.Fb)(e)?e.array[e.offset+2]:e[2])||0;switch(i.mode){case"on-the-ground":{var o;const i=null!==(o=(0,cn.KO)(t,e,"ground"))&&void 0!==o?o:0;return n.verticalDistanceToGround=0,n.sampledElevation=i,void(n.z=i)}case"relative-to-ground":{var a;const o=null!==(a=(0,cn.KO)(t,e,"ground"))&&void 0!==a?a:0,l=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=l,n.sampledElevation=o,void(n.z=l+o)}case"relative-to-scene":{var l;const o=null!==(l=(0,cn.KO)(t,e,"scene"))&&void 0!==l?l:0,a=i.geometryZWithOffset(s,r);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{var c;const o=i.geometryZWithOffset(s,r),a=null!==(c=(0,cn.KO)(t,e,"ground"))&&void 0!==c?c:0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}!function(e){e[e.NONE=0]="NONE",e[e.UPDATE=1]="UPDATE",e[e.RECREATE=2]="RECREATE"}(an||(an={}));(0,Mt.a)();const hn=new class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};(0,p.c)();var un=i(88152),pn=(i(66978),i(37818));i(819);const fn=ye.Z.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function gn(e){return null!=e.cachedResult}class _n{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=(0,un.Z7)(e)}get requiresSampledElevationInfo(){return"absolute-height"!==this.mode}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,t){const i=this.calculateOffsetRenderUnits(t);return null!=this.featureExpressionInfoContext?i:e+i}calculateOffsetRenderUnits(e){let t=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return null!=i&&(t+=function(e){if(null!=e){if(gn(e))return e.cachedResult;const t=e.arcade;let i=null===t||void 0===t?void 0:t.modules.arcadeUtils.executeFunction(t.func,t.context);return"number"!=typeof i&&(e.cachedResult=0,i=0),i}return 0}(i)*this._metersPerElevationInfoUnit),t/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){var t;this.mode=e.mode,this.unit=(0,un.lt)(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=null!==(t=e.offset)&&void 0!==t?t:0}updateFeatureExpressionInfoContext(e,t,i){if(null==e)return void(this._featureExpressionInfoContext=null);const r=null===e||void 0===e?void 0:e.arcade;r&&null!=t&&null!=i?(this._featureExpressionInfoContext=function(e){return{cachedResult:e.cachedResult,arcade:e.arcade?{func:e.arcade.func,context:e.arcade.modules.arcadeUtils.createExecContext(null,{sr:e.arcade.context.spatialReference}),modules:e.arcade.modules}:null}}(e),function(e,t){if(null!=e&&!gn(e)){if(!t||!e.arcade)return void fn.errorOncePerTick("Arcade support required but not provided");const i=t;i._geometry&&(i._geometry=(0,pn.kB)(i._geometry)),e.arcade.modules.arcadeUtils.updateExecContext(e.arcade.context,t)}}(this._featureExpressionInfoContext,function(e,t,i){return e.arcadeUtils.createFeature(t.attributes,t.geometry,i)}(r.modules,t,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const t=new _n;return null!=e&&t.setFromElevationInfo(e),t}}var vn=i(67794),mn=i(22753);function yn(e){return function(e){return e instanceof Float32Array&&e.length>=16}(e)||function(e){return Array.isArray(e)&&e.length>=16}(e)}var bn=i(25158),wn=i(66202),Sn=i(81879),xn=i(17363),Cn=i(65216);class Tn{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}var Rn=i(33236),On=i(22909),Pn=i(18442);class En extends Ye.A{initializeConfiguration(e,t){t.spherical=e.viewingMode===B.JY.Global}initializeProgram(e){return new Xe.$(e.rctx,En.shader.get().build(this.configuration),xe.i)}initializePipeline(){const e=this.configuration.transparencyPassType,t=this.configuration,i=e===Ke.A.NONE,r=e===Ke.A.FrontFace,n=this.configuration.hasPolygonOffset?An:null,s=(i||r)&&t.output!==ie.H.Highlight&&(t.depthEnabled||t.occlusionPass)?$e.LZ:null;return(0,$e.sm)({blending:t.output===ie.H.Color||t.output===ie.H.Alpha||t.output===ie.H.Highlight?i?Dn:(0,Je.j7)(e):null,depthTest:{func:Te.wb.LEQUAL},depthWrite:s,colorWrite:$e.BK,polygonOffset:n})}get primitiveType(){return this.configuration.occlusionPass?Te.MX.POINTS:Te.MX.TRIANGLES}}En.shader=new qe.J(Pn.H,(()=>i.e(6823).then(i.bind(i,16823))));const An={factor:0,units:-4},Dn=(0,$e.if)(Te.zi.ONE,Te.zi.ONE_MINUS_SRC_ALPHA);class Ln extends Gi.W{constructor(){super(...arguments),this.output=ie.H.Color,this.transparencyPassType=Ke.A.NONE,this.screenCenterOffsetUnitsEnabled=!1,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}}(0,S._)([(0,ue.o)({count:ie.H.COUNT})],Ln.prototype,"output",void 0),(0,S._)([(0,ue.o)({count:Ke.A.COUNT})],Ln.prototype,"transparencyPassType",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"spherical",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"occlusionTestEnabled",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"signedDistanceFieldEnabled",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"vvSize",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"vvColor",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"hasVerticalOffset",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"hasScreenSizePerspective",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"debugDrawLabelBorder",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"hasSlicePlane",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"hasPolygonOffset",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"depthEnabled",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"pixelSnappingEnabled",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"draped",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"multipassEnabled",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"cullAboveGround",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"occlusionPass",void 0),(0,S._)([(0,ue.o)()],Ln.prototype,"objectAndLayerIdColorInstanced",void 0),(0,S._)([(0,ue.o)({constValue:!0})],Ln.prototype,"hasSliceInVertexProgram",void 0),(0,S._)([(0,ue.o)({constValue:!1})],Ln.prototype,"hasVvInstancing",void 0);class Mn extends Ge.F5{constructor(e){super(e,new es),this._configuration=new Ln}getConfiguration(e,t){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=t.slot===Ze.r.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===ie.H.Color||e===ie.H.Alpha),e===ie.H.Color&&(this._configuration.debugDrawLabelBorder=!!k.h.LABELS_SHOW_BORDER),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,r,n,s){if(!(i.options.selectionMode&&i.options.hud&&e.visible&&i.point))return;const o=this.parameters,a=i.point,l=i.camera;let{scaleX:c,scaleY:d}=this._getScreenScale(e);c*=l.pixelRatio,d*=l.pixelRatio,(0,mn.f)(Zn,t),e.attributes.has(Ce.T.FEATUREATTRIBUTE)&&function(e){const t=e[0],i=e[1],r=e[2],n=e[3],s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],d=1/Math.sqrt(t*t+i*i+r*r),h=1/Math.sqrt(n*n+s*s+o*o),u=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*d,e[1]=i*d,e[2]=r*d,e[3]=n*h,e[4]=s*h,e[5]=o*h,e[6]=a*u,e[7]=l*u,e[8]=c*u}(Zn);const h=e.attributes.get(Ce.T.POSITION),f=e.attributes.get(Ce.T.SIZE),g=e.attributes.get(Ce.T.NORMAL),_=e.attributes.get(Ce.T.AUXPOS1);(0,be.hu)(h.size>=3);const v=(0,Pn.c)(o),m="screen"===this.parameters.centerOffsetUnits;for(let y=0;y<h.data.length/h.size;y++){const e=y*h.size;(0,u.s)(Hn,h.data[e],h.data[e+1],h.data[e+2]),(0,u.e)(Hn,Hn,t);const r=y*f.size;Kn[0]=f.data[r]*c,Kn[1]=f.data[r+1]*d,(0,u.e)(Hn,Hn,l.viewMatrix);const n=y*_.size;if((0,u.s)(kn,_.data[n],_.data[n+1],_.data[n+2]),!m&&(Hn[0]+=kn[0],Hn[1]+=kn[1],0!==kn[2])){const e=kn[2];(0,u.n)(kn,Hn),(0,u.f)(Hn,Hn,(0,u.i)(kn,kn,e))}const b=y*g.size;if((0,u.s)(Nn,g.data[b],g.data[b+1],g.data[b+2]),this._normalAndViewAngle(Nn,Zn,l,Jn),this._applyVerticalOffsetTransformationView(Hn,Jn,l,jn),l.applyProjection(Hn,zn),zn[0]>-1){m&&(kn[0]||kn[1])&&(zn[0]+=kn[0]*l.pixelRatio,0!==kn[1]&&(zn[1]+=(0,Cn.sX)(kn[1],jn.factorAlignment)*l.pixelRatio),l.unapplyProjection(zn,Hn)),zn[0]+=this.parameters.screenOffset[0]*l.pixelRatio,zn[1]+=this.parameters.screenOffset[1]*l.pixelRatio,zn[0]=Math.floor(zn[0]),zn[1]=Math.floor(zn[1]),(0,Cn.TU)(Kn,jn.factor,Kn);const e=Xn*l.pixelRatio;let t=0;if(o.textureIsSignedDistanceField&&(t=o.outlineSize*l.pixelRatio/2),Fn(a,zn[0],zn[1],Kn,e,t,o,v)){const e=i.ray;if((0,u.e)(Gn,Hn,(0,W.i)(Bn,l.viewMatrix)),zn[0]=a[0],zn[1]=a[1],l.unprojectFromRenderScreen(zn,Hn)){const t=(0,p.c)();(0,u.c)(t,e.direction);const i=1/(0,u.l)(t);(0,u.i)(t,t,i),s((0,u.o)(e.origin,Hn)*i,t,-1,!0,1,Gn)}}}}}intersectDraped(e,t,i,r,n,s){const o=e.attributes.get(Ce.T.POSITION),a=e.attributes.get(Ce.T.SIZE),l=this.parameters,c=(0,Pn.c)(l);let{scaleX:d,scaleY:h}=this._getScreenScale(e);d*=e.screenToWorldRatio,h*=e.screenToWorldRatio;const u=Qn*e.screenToWorldRatio;for(let p=0;p<o.data.length/o.size;p++){const t=p*o.size,i=o.data[t],f=o.data[t+1],g=p*a.size;Kn[0]=a.data[g]*d,Kn[1]=a.data[g+1]*h;let _=0;l.textureIsSignedDistanceField&&(_=l.outlineSize*e.screenToWorldRatio/2),Fn(r,i,f,Kn,u,_,l,c)&&n(s.dist,s.normal,-1,!1)}}createBufferWriter(){return new rs(this)}_normalAndViewAngle(e,t,i,r){return yn(t)&&(t=(0,mn.f)(Wn,t)),(0,u.t)(r.normal,e,t),(0,u.e)(r.normal,r.normal,i.viewInverseTransposeMatrix),r.cosAngle=(0,u.j)(Un,$n),r}_updateScaleInfo(e,t,i){const r=this.parameters;null!=r.screenSizePerspective?(0,Cn.PV)(i,t,r.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minScaleFactor=0),null!=r.screenSizePerspectiveAlignment?(0,Cn.PV)(i,t,r.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minScaleFactor=e.factor.minScaleFactor)}applyShaderOffsetsView(e,t,i,r,n,s,o){const a=this._normalAndViewAngle(t,i,n,Jn);return this._applyVerticalGroundOffsetView(e,a,n,o),this._applyVerticalOffsetTransformationView(o,a,n,s),this._applyPolygonOffsetView(o,a,r[3],n,o),this._applyCenterOffsetView(o,r,o),o}applyShaderOffsetsNDC(e,t,i,r,n){return this._applyCenterOffsetNDC(e,t,i,r),null!=n&&(0,u.c)(n,r),this._applyPolygonOffsetNDC(r,t,i,r),r}_applyPolygonOffsetView(e,t,i,r,n){const s=r.aboveGround?1:-1;let o=Math.sign(i);0===o&&(o=s);const a=s*o;if(this.parameters.shaderPolygonOffset<=0)return(0,u.c)(n,e);const l=(0,je.uZ)(Math.abs(t.cosAngle),.01,1),c=1-Math.sqrt(1-l*l)/l/r.viewport[2];return(0,u.i)(n,e,a>0?c:1/c),n}_applyVerticalGroundOffsetView(e,t,i,r){const n=(0,u.l)(e),s=i.aboveGround?1:-1,o=i.computeRenderPixelSizeAtDist(n)*Sn.c,a=(0,u.i)(Hn,t.normal,s*o);return(0,u.g)(r,e,a),r}_applyVerticalOffsetTransformationView(e,t,i,r){var n,s;const o=this.parameters;if(null===(n=o.verticalOffset)||void 0===n||!n.screenLength){if(o.screenSizePerspective||o.screenSizePerspectiveAlignment){const i=(0,u.l)(e);this._updateScaleInfo(r,i,t.cosAngle)}else r.factor.scale=1,r.factorAlignment.scale=1;return e}const a=(0,u.l)(e),l=null!==(s=o.screenSizePerspectiveAlignment)&&void 0!==s?s:o.screenSizePerspective,c=(0,On.Hx)(i,a,o.verticalOffset,t.cosAngle,l);return this._updateScaleInfo(r,a,t.cosAngle),(0,u.i)(t.normal,t.normal,c),(0,u.g)(e,e,t.normal)}_applyCenterOffsetView(e,t,i){const r="screen"!==this.parameters.centerOffsetUnits;return i!==e&&(0,u.c)(i,e),r&&(i[0]+=t[0],i[1]+=t[1],t[2]&&((0,u.n)(Nn,i),(0,u.g)(i,i,(0,u.i)(Nn,Nn,t[2])))),i}_applyCenterOffsetNDC(e,t,i,r){const n="screen"!==this.parameters.centerOffsetUnits;return r!==e&&(0,u.c)(r,e),n||(r[0]+=t[0]/i.fullWidth*2,r[1]+=t[1]/i.fullHeight*2),r}_applyPolygonOffsetNDC(e,t,i,r){const n=this.parameters.shaderPolygonOffset;if(e!==r&&(0,u.c)(r,e),n){const e=i.aboveGround?1:-1,s=e*Math.sign(t[3]);r[2]-=(s||e)*n}return r}produces(e,t){if(t===ie.H.Color||t===ie.H.Alpha||t===ie.H.Highlight||t===ie.H.ObjectAndLayerIdColor){if(e===Ze.r.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:t,occlusionTest:i}=this.parameters;return e===(t?Ze.r.LABEL_MATERIAL:Ze.r.HUD_MATERIAL)||i&&e===Ze.r.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new In(e)}calculateRelativeScreenBounds(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,Y.Ue)();return function(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Vn;(0,He.j)(r,e.anchorPosition),r[0]*=-t[0],r[1]*=-t[1],r[0]+=e.screenOffset[0]*i,r[1]+=e.screenOffset[1]*i}(this.parameters,e,t,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}_getScreenScale(e){const t=e.attributes.get(Ce.T.FEATUREATTRIBUTE);if(null==t)return{scaleX:1,scaleY:1};const i=(0,oe.b)(t.data,Yn),[r,n]=(0,wn.FE)(qn,this.parameters,i);return{scaleX:r,scaleY:n}}}class In extends xn.F{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(En,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}}function Fn(e,t,i,r,n,s,o,a){let l=t-n-(a[0]>0?r[0]*a[0]:0),c=l+r[0]+2*n,d=i-n-(a[1]>0?r[1]*a[1]:0),h=d+r[1]+2*n;const u=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&null!=u&&(l+=r[0]*u[0],d+=r[1]*u[1],c-=r[0]*(1-u[2]),h-=r[1]*(1-u[3]),l-=s,c+=s,d-=s,h+=s),e[0]>l&&e[0]<c&&e[1]>d&&e[1]<h}const jn=new class{constructor(){this.factor=new Tn,this.factorAlignment=new Tn}},Vn=(0,It.a)(),Hn=(0,p.c)(),Nn=(0,p.c)(),zn=(0,oe.c)(),Un=(0,p.c)(),Gn=(0,p.c)(),Zn=(0,Bt.a)(),Wn=(0,Bt.a)(),Bn=(0,Mt.a)(),kn=(0,p.c)(),qn=(0,oe.c)(),Yn=(0,oe.c)(),Jn={normal:Un,cosAngle:0},Xn=1,Qn=2,Kn=[0,0],$n=(0,p.f)(0,0,1);class es extends xn.E{constructor(){super(...arguments),this.renderOccluded=Ge.yD.Occlude,this.isDecoration=!1,this.color=(0,oe.f)(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=(0,It.f)(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=(0,oe.f)(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}}const ts=(0,ze.U$)().vec3f(Ce.T.POSITION).vec3f(Ce.T.NORMAL).vec2f(Ce.T.UV0).vec4u8(Ce.T.COLOR).vec2f(Ce.T.SIZE).vec4f(Ce.T.AUXPOS1).vec4f(Ce.T.FEATUREATTRIBUTE),is=ts.clone().vec4u8(Ce.T.OBJECTANDLAYERIDCOLOR);class rs{constructor(e){this._material=e,this.vertexBufferLayout=(0,d.Z)("enable-feature:objectAndLayerId-rendering")?is:ts}elementCount(e){return 6*e.attributes.get(Ce.T.POSITION).indices.length}write(e,t,i,r,n){(0,Rn.ho)(i.attributes.get(Ce.T.POSITION),e,r.position,n,6),(0,Rn.s5)(i.attributes.get(Ce.T.NORMAL),t,r.normal,n,6);const s=i.attributes.get(Ce.T.UV0).data;let o,a,l,c;if(null==s||s.length<4){const e=this._material.parameters;o=0,a=0,l=e.texCoordScale[0],c=e.texCoordScale[1]}else o=s[0],a=s[1],l=s[2],c=s[3];l=Math.min(1.99999,l+1),c=Math.min(1.99999,c+1);let d=i.attributes.get(Ce.T.POSITION).indices.length,h=n;const u=r.uv0;for(let v=0;v<d;++v)u.set(h,0,o),u.set(h,1,a),h++,u.set(h,0,l),u.set(h,1,a),h++,u.set(h,0,l),u.set(h,1,c),h++,u.set(h,0,l),u.set(h,1,c),h++,u.set(h,0,o),u.set(h,1,c),h++,u.set(h,0,o),u.set(h,1,a),h++;(0,Rn.Vs)(i.attributes.get(Ce.T.COLOR),4,r.color,n,6);const{data:p,indices:f}=i.attributes.get(Ce.T.SIZE);d=f.length;const g=r.size;h=n;for(let v=0;v<d;++v){const e=p[2*f[v]],t=p[2*f[v]+1];for(let i=0;i<6;++i)g.set(h,0,e),g.set(h,1,t),h++}if(i.attributes.get(Ce.T.AUXPOS1)?(0,Rn.SW)(i.attributes.get(Ce.T.AUXPOS1),r.auxpos1,n,6):(0,Rn.h)(r.auxpos1,n,6*d),i.attributes.get(Ce.T.FEATUREATTRIBUTE)?(0,Rn.SW)(i.attributes.get(Ce.T.FEATUREATTRIBUTE),r.featureAttribute,n,6):(0,Rn.h)(r.featureAttribute,n,6*d),null!=i.objectAndLayerIdColor){var _;const e=null===(_=i.attributes.get(Ce.T.POSITION))||void 0===_?void 0:_.indices;if(e){const t=e.length,s=r.getField(Ce.T.OBJECTANDLAYERIDCOLOR,bn.mc);(0,Rn.xP)(i.objectAndLayerIdColor,s,t,n,6)}}}}class ns extends on{constructor(e){super(e),this._material=null,this._texture=null,this._geometry=null,this._size=3,this._color=(0,oe.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,oe.f)(1,1,1,1),this._elevationInfo=null,this.applyProperties(e)}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get size(){return this._size}set size(e){if(e!==this._size){const t=this._preferredTextureSize;this._size=e,t<this._preferredTextureSize?this.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(e){(0,_.h)(e,this._color)||((0,_.c)(this._color,e),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(e){this._pixelSnappingEnabled!==e&&(this._pixelSnappingEnabled=e,this._updateMaterial())}get primitive(){return this._primitive}set primitive(e){this._primitive!==e&&(this._primitive=e,this.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,_.h)(e,this._outlineColor)||((0,_.c)(this._outlineColor,e),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(e){this._elevationInfo=e,this.recreateGeometry()}_updateMaterial(){this._material&&this._material.setParameters(this._materialParameters)}_updateSizeAttribute(){const e=this.object;if(null==e)return;const t=e.geometries[0];if(null==t)return;const i=t.getMutableAttribute(Ce.T.SIZE).data,r=this._geometrySize;i[0]=r,i[1]=r,e.geometryVertexAttributeUpdated(e.geometries[0],Ce.T.SIZE)}get _materialParameters(){var e;return{color:this._color,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:(0,vn.Rg)(this._primitive),distanceFieldBoundingBox:os,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:null===(e=this._texture)||void 0===e?void 0:e.id,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled,isDecoration:this.isDecoration}}get _geometrySize(){return this._size/ss}createExternalResources(){this._texture=(0,vn.cU)(this._primitive,this._preferredTextureSize),this._material=new Mn(this._materialParameters);const e=this.view._stage;this._texture.load(e.renderView.renderingContext),e.add(this._texture)}destroyExternalResources(){this._texture&&(this.view._stage.remove(this._texture),this._texture.dispose(),this._texture=null),this._material=null}createGeometries(e){const t=this._createRenderGeometry();null!=t&&e.addGeometry(t)}forEachExternalMaterial(e){this._material&&e(this._material)}get _preferredTextureSize(){return(0,je.uZ)(2*this._geometrySize,16,128)}calculateMapBounds(e){var t;const i=null===(t=this.object)||void 0===t?void 0:t.geometries[0];if(!i)return!1;const r=i.attributes.get(Ce.T.POSITION);return(0,f.S)(r.data,this.view.renderCoordsHelper.spatialReference,as,this.view.spatialReference),(0,nn.G1)(e,as),!0}_createRenderGeometry(){const{geometry:e,_material:t}=this;if(null==e||null==t)return null;const{renderCoordsHelper:i,elevationProvider:r}=this.view,n=function(e,t,i,r){return dn(e,t,i,r,hn),hn.z}(e,r,_n.fromElevationInfo(this.elevationInfo),i),s=(0,u.s)(sn.WM.get(),e.x,e.y,n),o=sn.WM.get();(0,f.S)(s,e.spatialReference,o,i.spatialReference);const a=this._geometrySize;return(0,jr.dV)(t,null,o,null,[a,a],[0,0,0,1])}}const ss=vn.hy,os=[ss/2,ss/2,1-ss/2,1-ss/2],as=(0,p.c)();var ls=i(66832);class cs extends V{constructor(e){super(e),this._maxSize=0,this._position=(0,p.c)(),this._up=(0,p.c)(),this._right=(0,p.c)(),this._renderOccluded=Ge.yD.OccludeAndTransparent,this._color=(0,oe.f)(1,0,0,1),this._outlineColor=(0,oe.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=Ge.yD.Opaque,this.applyProperties(e)}createObject3DResourceFactory(e){return{view:e,createResources:e=>this._createObject3DResources(e),destroyResources:()=>{},cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(e){return{view:e,createResources:()=>this._createDrapedResources(),destroyResources:e=>this._destroyDrapedResources(e)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}get color(){return this._color}set color(e){(0,_.c)(this._color,e),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(e){(0,_.c)(this._outlineColor,e),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(e){const t=0===this._outlineSize!=(0===e);this._outlineSize=e,t?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(e){e!==this._size&&(this._size=e,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}set geometry(e){let{previous:t,center:i,next:r}=e;this._maxSize=Math.min((0,u.o)(i,t),(0,u.o)(i,r))/3,(0,u.n)(this._up,(0,u.f)(this._up,t,i)),(0,u.n)(this._right,(0,u.f)(this._right,r,i)),(0,u.c)(this._position,i),this.recreateGeometry()}_createObject3DResources(e){const t=new ls.E(this._quadMaterialParameters),i=0===this._outlineSize?void 0:new st(this._outlineMaterialParameters);return this._createObject3DGeometries(e,t,i),{quadMaterial:t,outlineMaterial:i,forEach:e=>{e(t),i&&e(i)}}}_createObject3DGeometries(e,t,i){if((0,u.h)(this._up,p.Z)&&(0,u.h)(this._right,p.Z))return;const r=this._createGeometries(t,i);for(const n of r)e.addGeometry(n);this._updateTransformObject3D(e)}_createDrapedResources(){const e=new ls.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new st(this._outlineMaterialParameters),i=this._createGeometries(e,t).map((e=>new Nr(e)));return this._setTransformDraped(i),{quadMaterial:e,outlineMaterial:t,geometries:i,pixelRatioHandle:(0,L.YP)((()=>this.view.state.contentPixelRatio),(()=>{this.drapedResources.recreateGeometry()}))}}_destroyDrapedResources(e){e.pixelRatioHandle.remove(),e.geometries=[]}_createGeometries(e,t){const{up:i,right:r,corner:n}=this._getVertices(),s=this._quadGeometryData(i,r,n,e);return t?[s,(0,jr.rh)(t,[i,n,r])]:[s]}_getVertices(){let e=this._up,t=this._right;const i=(0,u.g)(sn.WM.get(),e,t);return this.isDraped&&(e=(0,u.c)(sn.WM.get(),e),t=(0,u.c)(sn.WM.get(),t),e[2]=0,t[2]=0,i[2]=0),{up:e,right:t,corner:i}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.object3dResources.object;if(!e)return;const t=this.view.state.camera,i=this._size*t.computeScreenPixelSizeAt(this._position),r=Math.min(this._maxSize,i);(0,W.d)(ds,this._position),(0,W.b)(ds,ds,[r,r,r]),e.transformation=ds}_setTransformDraped(e){if(0===e.length)return;const{view:{basemapTerrain:{overlayManager:t},state:{contentPixelRatio:i}}}=this,{_position:r,_size:n}=this,s=(0,u.c)(sn.WM.get(),r);s[2]=-2;const o=hs;o.spatialReference=t.renderer.spatialReference,o.x=s[0],o.y=s[1];const a=n*(this.view.overlayPixelSizeInMapUnits(o)*i),l=Math.min(this._maxSize,a);(0,W.d)(ds,s),(0,W.b)(ds,ds,[l,l,1]);for(const c of e)c.transformation=ds}_quadGeometryData(e,t,i,r){return new Ie.Z(r,[[Ce.T.POSITION,new Me.a([0,0,0,...t,...e,...i],[0,1,2,1,2,3],3,!0)]])}get _quadMaterialParameters(){return{color:this._color,forceTransparentMode:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded,isDecoration:this.isDecoration}}_updateQuadMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&e.quadMaterial.setParameters(this._quadMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||t.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded,isDecoration:this.isDecoration}}_updateOutlineMaterial(){var e,t;null!==(e=this.object3dResources.resources)&&void 0!==e&&null!==(e=e.outlineMaterial)&&void 0!==e&&e.setParameters(this._outlineMaterialParameters),null===(t=this.drapedResources.resources)||void 0===t||null===(t=t.outlineMaterial)||void 0===t||t.setParameters(this._outlineMaterialParameters)}}const ds=(0,Mt.a)(),hs=(0,Yr.T)(0,0,void 0,null);var us=i(38054),ps=i(76014),fs=i(80371),gs=i(64674),_s=i(38561),vs=i(53397),ms=i(11208);class ys extends _s.a{sortUniqueHints(e){return e.sort(((e,t)=>(t instanceof vs.w?t.length:0)-(e instanceof vs.w?e.length:0)))}visualizeIntersectionPoint(e,t){const{spatialReference:i,view:r}=t,n=bs(t);return(0,h.ed)(new ns({view:r,primitive:"circle",geometry:(0,us.Ju)(e.intersectionPoint,i),elevationInfo:e.isDraped?g.tR:g.jG,size:20,outlineSize:2,color:n.intersectionPointColor,outlineColor:n.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,t){const{view:i,spatialReference:r}=t,n=bs(t),s=ws(e.point,e.domain,t);return(0,h.ed)(new ns({view:i,primitive:"circle",geometry:(0,us.Ju)(s,r),elevationInfo:Ss(e,t),size:20,outlineSize:2,color:n.pointColor,outlineColor:n.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,t){const{view:i,spatialReference:r}=t,n=bs(t),s=ws(e.lineStart,e.domain,t),o=ws(e.lineEnd,e.domain,t);return(0,h.ed)(this._createLineSegmentHint(e.type,s,o,r,Ss(e,t),i,n,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,t){const{view:i,spatialReference:r}=t,s=bs(t),{isDraped:o}=e,a=Ss(e,t),l=ws(e.lineStart,e.domain,t),c=ws(e.lineEnd,e.domain,t),d=Cs(l,r,a,i,o),p=Cs(c,r,a,i,o),f=(0,u.p)(p,d,p,.5),g=new Jr({view:i,attached:!1,offset:ps.c.parallelLineHintOffset,length:ps.c.parallelLineHintLength,width:ps.c.parallelLineHintWidth,color:s.parallelSignColor,location:f,renderOccluded:o?Ge.yD.OccludeAndTransparent:Ge.yD.Opaque,isDraped:o,renderGroup:n.SnappingHint,isDecoration:!0});return g.setDirectionFromPoints(d,f),g.attached=!0,(0,h.ed)(g)}visualizeRightAngleQuad(e,t){const{view:i,spatialReference:r}=t,s=bs(t),o=Ss(e,t),{isDraped:a}=e,l=ws(e.previousVertex,e.domain,t),c=ws(e.centerVertex,e.domain,t),d=ws(e.nextVertex,e.domain,t),u=Cs(l,r,o,i,a),p=Cs(c,r,o,i,a),f=Cs(d,r,o,i,a);return(0,h.ed)(new cs({view:i,attached:!0,color:a?s.rightAngleColorDraped:s.rightAngleColor,renderOccluded:a?Ge.yD.OccludeAndTransparent:Ge.yD.Transparent,outlineRenderOccluded:a?Ge.yD.OccludeAndTransparent:Ge.yD.Opaque,outlineColor:s.rightAngleOutlineColor,outlineSize:ps.c.rightAngleHintOutlineSize,size:ps.c.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:p,next:f},renderGroup:n.SnappingHint,isDecoration:!0}))}_createLineSegmentHint(e,t,i,r,s,o,a){let l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],d=!(arguments.length>9&&void 0!==arguments[9])||arguments[9];const h=Cs(t,r,s,o,l),u=Cs(i,r,s,o,l),p=new zr({view:o,extensionType:Br.FADED,start:h,end:u,isDraped:l,color:a.lineColor,renderOccluded:l?Ge.yD.OccludeAndTransparent:Ge.yD.Opaque,renderGroup:n.SnappingHint,isDecoration:!0});switch(e){case gs.ze.TARGET:p.width=ps.c.lineHintWidthTarget,p.fadedExtensions={start:0,end:ps.c.lineHintFadedExtensions};break;case gs.ze.REFERENCE_EXTENSION:p.width=ps.c.lineHintWidthReference,p.fadedExtensions={start:0,end:0};break;case gs.ze.REFERENCE:p.width=ps.c.lineHintWidthReference,p.fadedExtensions={start:c?ps.c.lineHintFadedExtensions:0,end:d?ps.c.lineHintFadedExtensions:0}}return p.attached=!0,p}}function bs(e){const{effectiveTheme:t}=e.view,i=l.Z.toUnitRGBA(t.accentColor),r=[0,0,0,0];return{intersectionPointColor:r,intersectionPointOutlineColor:i,pointColor:r,pointOutlineColor:i,lineColor:i,lineOutlineColor:void 0,parallelSignColor:i,rightAngleColor:i,rightAngleColorDraped:l.Z.toUnitRGBA((0,c.G)(t.accentColor,.5)),rightAngleOutlineColor:i}}function ws(e,t,i){const r=xs(t,i);return null==r?e:(0,us.Ue)(e[0],e[1],r)}function Ss(e,t){return null!=xs(e.domain,t)?t.selfSnappingZ.elevationInfo:e.isDraped?g.tR:g.jG}function xs(e,t){let{selfSnappingZ:i}=t;return e===fs.B.SELF&&null!=i?i.value:null}function Cs(e,t,i,r,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,p.c)();if(n){const i=r.basemapTerrain.overlayManager.renderer.spatialReference;(0,f.S)(e,t,s,i)}else(0,ms.RS)(e,t,i,r,s);return s}},51328:(e,t,i)=>{i.d(t,{J4:()=>d,cx:()=>r,gv:()=>h});var r,n=i(17842),s=(i(11186),i(71353)),o=(i(45925),i(55652),i(40885)),a=(i(40927),i(51378),i(74509),i(81703),i(88153)),l=i(54463),c=i(76783);i(21641);function d(e){let t=null;return i=>{switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":null!=t&&(t.remove(),t=null)}return i}}function h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=(0,a.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=l.eC.MIN,i.options.hud=!1;const o=(0,n.s1)(),d={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},h=(0,s.c)(),u=null!==t&&void 0!==t?t:e.spatialReference,p=t=>{e.map.ground&&e.map.ground.opacity<1?d.exclude.add(c.xX):d.exclude.delete(c.xX),e.sceneIntersectionHelper.intersectIntersectorScreen((0,n.md)(t,o),i,d);const s=i.results.min;let a;if(s.getIntersectionPoint(h))a=s.intersector===l.q7.TERRAIN?r.GROUND:r.OTHER;else{if(!i.results.ground.getIntersectionPoint(h))return null;a=r.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(h,u),surfaceType:a}};let f;return e=>{if("start"===e.action){const t=p(e.screenStart);f=null!=t?t.location:null}if(null==f)return null;const t=p(e.screenEnd);return null!=(null===t||void 0===t?void 0:t.location)?{...e,mapStart:f,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(r||(r={}));(0,s.c)(),(0,s.c)(),(0,o.Ue)()},60142:(e,t,i)=>{i.d(t,{EA:()=>z});var r=i(86950),n=(i(14226),i(11186)),s=(i(51378),i(37818),i(35284),i(40508),i(96387),i(68401)),o=(i(70619),i(56529)),a=i(66832),l=i(71353),c=i(67077),d=i(41414),h=i(25158),u=i(55158),p=i(37081),f=i(23620),g=i(93822),_=i(97731),v=i(4760),m=i(33236),y=i(22909),b=i(27366),w=i(82144),S=i(31132),x=i(33559),C=i(78041),T=i(27627),R=i(25920),O=i(8883),P=i(72511),E=i(8548),A=i(36207);class D extends S.A{initializeProgram(e){return new T.$(e.rctx,D.shader.get().build(this.configuration),M)}_setPipelineState(e){const t=this.configuration,i=e===R.A.NONE,r=e===R.A.FrontFace;return(0,A.sm)({blending:t.output!==p.H.Color&&t.output!==p.H.Alpha||!t.transparent?null:i?C.wu:(0,C.j7)(e),culling:(0,A.zp)(t.cullFace),depthTest:{func:r?E.wb.LESS:t.shadingEnabled?E.wb.LEQUAL:E.wb.LESS},depthWrite:i?t.writeDepth?A.LZ:null:(0,C.K5)(e),colorWrite:A.BK,polygonOffset:i||r?null:C.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}D.shader=new w.J(P.S,(()=>i.e(6556).then(i.bind(i,36556))));class L extends O.W{constructor(){super(...arguments),this.output=p.H.Color,this.cullFace=s.Vr.None,this.transparencyPassType=R.A.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.multipassEnabled=!1,this.cullAboveGround=!1}}(0,b._)([(0,x.o)({count:p.H.COUNT})],L.prototype,"output",void 0),(0,b._)([(0,x.o)({count:s.Vr.COUNT})],L.prototype,"cullFace",void 0),(0,b._)([(0,x.o)({count:R.A.COUNT})],L.prototype,"transparencyPassType",void 0),(0,b._)([(0,x.o)()],L.prototype,"hasSlicePlane",void 0),(0,b._)([(0,x.o)()],L.prototype,"transparent",void 0),(0,b._)([(0,x.o)()],L.prototype,"writeDepth",void 0),(0,b._)([(0,x.o)()],L.prototype,"screenSizeEnabled",void 0),(0,b._)([(0,x.o)()],L.prototype,"shadingEnabled",void 0),(0,b._)([(0,x.o)()],L.prototype,"multipassEnabled",void 0),(0,b._)([(0,x.o)()],L.prototype,"cullAboveGround",void 0),(0,b._)([(0,x.o)({constValue:!1})],L.prototype,"occlusionPass",void 0);const M=new Map([[v.T.POSITION,0],[v.T.NORMAL,1],[v.T.OFFSET,2]]);class I extends o.F5{constructor(e){super(e,new j),this.supportsEdges=!0,this._configuration=new L,this._vertexAttributeLocations=M}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration}intersect(e,t,i,r,s,o){if(this.parameters.screenSizeEnabled){const t=e.attributes.get(v.T.OFFSET),a={applyToVertex:(e,r,s,o)=>{const a=(0,n.s)(H,t.data[3*o],t.data[3*o+1],t.data[3*o+2]),l=(0,n.s)(N,e,r,s);return(0,n.i)(a,a,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(a)),(0,n.g)(l,l,a),[l[0],l[1],l[2]]},applyToAabb:e=>{const t=(0,d.be)(e,H);return(0,d.bA)(e,this.parameters.screenSizeScale*i.camera.computeScreenPixelSizeAt(t))}};(0,y.Bw)(e,i,r,s,a,o)}else(0,y.Bw)(e,i,r,s,void 0,o)}produces(e,t){if(t===p.H.Highlight)return e===g.r.OPAQUE_MATERIAL;if(t===p.H.Color||t===p.H.Alpha||t===p.H.ObjectAndLayerIdColor){let t=g.r.OPAQUE_MATERIAL;return this._isTransparent&&(t=this.parameters.writeDepth?g.r.TRANSPARENT_MATERIAL:g.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===t||e===g.r.DRAPED_MATERIAL}return!1}createGLMaterial(e){return new F(e)}createBufferWriter(){return new V(this.parameters.screenSizeEnabled)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class F extends f.Z{beginSlot(e){return this.ensureTechnique(D,e)}}class j extends o.Mt{constructor(){super(...arguments),this.color=(0,c.f)(1,1,1,1),this.shadingTint=(0,c.f)(0,0,0,.25),this.shadingDirection=(0,n.n)((0,l.c)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=s.Vr.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class V{constructor(e){this.screenSizeEnabled=e;const t=(0,u.U$)().vec3f(v.T.POSITION).vec3f(v.T.NORMAL);this.screenSizeEnabled&&t.vec3f(v.T.OFFSET),this.vertexBufferLayout=t}elementCount(e){return e.attributes.get(v.T.POSITION).indices.length}write(e,t,i,r,n){if((0,m.NK)(i,this.vertexBufferLayout,e,t,r,n),this.screenSizeEnabled){if(!i.attributes.has(v.T.OFFSET))throw new Error("".concat(v.T.OFFSET," vertex attribute required for screenSizeEnabled ShadedColorMaterial"));{const e=i.attributes.get(v.T.OFFSET);(0,_.hu)(3===e.size);const s=r.getField(v.T.OFFSET,h.ct);if(!s)throw new Error("unable to acquire view for "+v.T.OFFSET);(0,m.ho)(e,t,s,n)}}}}const H=(0,l.c)(),N=(0,l.c)();i(99034);function z(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.yD.OccludeAndTransparent,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=(0,r.gp)(e),l=!(e[3]<1);return i?new I({color:n,writeDepth:l,cullFace:s.Vr.Back,renderOccluded:t,isDecoration:!0}):new a.E({color:n,writeDepth:l,cullFace:s.Vr.Back,renderOccluded:t,isDecoration:!0})}Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1});Object.freeze({autoScaleRenderObjects:!1,worldSized:!0})},62389:(e,t,i)=>{i.d(t,{W:()=>q});var r=i(11186),n=i(71353),s=i(85981),o=i(86244),a=i(27366),l=i(92026),c=i(49861),d=(i(25243),i(63780),i(93169),i(69912)),h=i(70444),u=i(95773),p=i(40885),f=i(50951),g=i(86372),_=i(50256),v=i(55158),m=i(80658),y=i(4760),b=i(82144),w=i(31132),S=i(27627),x=i(18300),C=i(8548),T=i(36207);class R extends w.A{initializeProgram(e){return new S.$(e.rctx,R.shader.get().build(this.configuration),O)}initializePipeline(){return(0,T.sm)({blending:(0,T.if)(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),colorWrite:T.BK})}}R.shader=new b.J(x.L,(()=>i.e(7515).then(i.bind(i,97515))));const O=new Map([[y.T.START,0],[y.T.END,1],[y.T.UP,2],[y.T.EXTRUDE,3]]);var P=i(44070);class E{constructor(e){this._renderCoordsHelper=e,this._buffers=null,this._origin=(0,n.c)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(e){const t=(0,g.bg)(3*e.length);let i=0;for(const r of e)t[i++]=r[0],t[i++]=r[1],t[i++]=r[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],t=3*Math.floor(e.length/3/2);(0,r.s)(this._origin,e[t],e[t+1],e[t+2])}else(0,r.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(C.MX.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}_ensureVAO(e){return null==this._buffers?null:(null==this._vao&&(this._vao=this._createVAO(e,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const i=this._createDataBuffer(t);return this._dirty=!1,new m.U(e,O,{data:(0,_.K)(L)},{data:P.f.createVertex(e,C.l1.STATIC_DRAW,i)})}_ensureVertexData(e,t){var i;if(!this._dirty)return;const r=this._createDataBuffer(t);null!==(i=e.vertexBuffers.data)&&void 0!==i&&i.setData(r),this._dirty=!1}_numberOfRenderVertices(e){return 2*(e.length/3-1)*3}_createDataBuffer(e){const t=e.reduce(((e,t)=>e+this._numberOfRenderVertices(t)),0);this._count=t;const i=L.createBuffer(t),n=this._origin;let s=0,o=0;for(const a of e){for(let e=0;e<a.length;e+=3){const t=(0,r.s)(D,a[e],a[e+1],a[e+2]);0===e?o=this._renderCoordsHelper.getAltitude(t):this._renderCoordsHelper.setAltitude(t,o);const l=this._renderCoordsHelper.worldUpAtPosition(t,A),c=s+2*e,d=(0,r.f)(D,t,n);if(e<a.length-3){i.up.setVec(c,l),i.up.setVec(c+3,l),i.up.setVec(c+5,l);for(let e=0;e<6;e++)i.start.setVec(c+e,d);i.extrude.setValues(c,0,-1),i.extrude.setValues(c+1,1,-1),i.extrude.setValues(c+2,1,1),i.extrude.setValues(c+3,0,-1),i.extrude.setValues(c+4,1,1),i.extrude.setValues(c+5,0,1)}if(e>0){i.up.setVec(c-2,l),i.up.setVec(c-4,l),i.up.setVec(c-5,l);for(let e=-6;e<0;e++)i.end.setVec(c+e,d)}}s+=this._numberOfRenderVertices(a)}return i.buffer}}const A=(0,n.c)(),D=(0,n.c)(),L=(0,v.U$)().vec3f(y.T.START).vec3f(y.T.END).vec3f(y.T.UP).vec2f(y.T.EXTRUDE);var M=i(70374),I=i(93822),F=i(22909),j=i(33559);class V extends j.m{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,a._)([(0,j.o)()],V.prototype,"contrastControlEnabled",void 0);var H=i(16889),N=i(98634),z=i(7566),U=i(83671);class G extends N.K{constructor(){super(...arguments),this.innerColor=(0,n.f)(1,1,1),this.innerWidth=1,this.glowColor=(0,n.f)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,H.Vl)(6),this.pointDistanceOrigin=(0,n.c)(),this.pointDistanceTarget=(0,n.c)(),this.lineVerticalPlaneSegment=(0,s.Ue)(),this.intersectsLineSegment=(0,s.Ue)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,n.c)(),this.lineStartWorld=(0,n.c)(),this.lineEndWorld=(0,n.c)()}}class Z extends w.A{initializeProgram(e){return new S.$(e.rctx,Z.shader.get().build(this.configuration),z.i)}initializePipeline(){return(0,T.sm)({blending:(0,T.if)(C.zi.ONE,C.zi.ONE_MINUS_SRC_ALPHA),colorWrite:T.BK})}}Z.shader=new b.J(U.L,(()=>i.e(5693).then(i.bind(i,45693))));class W extends V{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}(0,a._)([(0,j.o)()],W.prototype,"heightManifoldEnabled",void 0),(0,a._)([(0,j.o)()],W.prototype,"pointDistanceEnabled",void 0),(0,a._)([(0,j.o)()],W.prototype,"lineVerticalPlaneEnabled",void 0),(0,a._)([(0,j.o)()],W.prototype,"intersectsLineEnabled",void 0),(0,a._)([(0,j.o)()],W.prototype,"spherical",void 0);let B=class extends M.He{constructor(e){super(e),this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=f.JY.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this._passParameters=new G,this.produces=new Map([[I.r.LASERLINES,()=>!this.contrastControlEnabled],[I.r.LASERLINES_CONTRAST_CONTROL,()=>this.contrastControlEnabled]])}initialize(){this._passParameters.renderCoordsHelper=this.renderCoordsHelper}consumes(){return M.of}get isDecoration(){return this._isDecoration}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(e){this._heightManifoldEnabled!==e&&(this._heightManifoldEnabled=e,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(e){(0,r.c)(this._passParameters.heightManifoldTarget,e),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(e){e!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=e,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(e){(0,r.c)(this._passParameters.pointDistanceTarget,e),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(e){(0,r.c)(this._passParameters.pointDistanceOrigin,e),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(e){e!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=e,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){(0,s.JG)(e,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(e){e!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=e,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(e){(0,s.JG)(e,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(e){e!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=e,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){e!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=e,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(e){e!==this._viewingMode&&(this._viewingMode=e,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(e){e!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=e,null!=this._pathVerticalPlaneData&&this._requestRender())}set pathVerticalPlaneVertices(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new E(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=e,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(e){null==this._pathVerticalPlaneData&&(this._pathVerticalPlaneData=new E(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=e,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(e){(0,F.LO)(this._passParameters,e)&&this._requestRender()}initializeRenderContext(e){this._context=e,this._techniqueRepository=e.techniqueRepository,this._techniqueConfig=new W;const t=new V;t.contrastControlEnabled=this.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(R,t)}uninitializeRenderContext(){this._technique=(0,l.RY)(this._technique),this._pathVerticalPlaneData=(0,l.M2)(this._pathVerticalPlaneData),this._pathTechnique=(0,l.RY)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===f.JY.Global,this._technique=this._techniqueRepository.releaseAndAcquire(Z,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}renderNode(e,t){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(e,t),this.pathVerticalPlaneEnabled&&this._renderPath(e)}_renderUnified(e,t){const i=e.rctx;this._updatePassParameters(e),i.bindTechnique(t,this._passParameters,e.bindParameters),i.screen.draw()}_renderPath(e){if(null==this._pathVerticalPlaneData||null==this._pathTechnique)return;const t=e.rctx,i=this._pathTechnique;t.bindTechnique(i,{...this._passParameters,origin:this._pathVerticalPlaneData.origin},e.bindParameters),this._pathVerticalPlaneData.draw(e.rctx)}_updatePassParameters(e){if(!this._intersectsLineEnabled)return;const t=e.bindParameters.camera;if(this._intersectsLineInfinite){if((0,h.iL)((0,p.re)(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),k),k.c0=-Number.MAX_VALUE,!(0,u.zq)(t.frustum,k))return;(0,h.Ws)(k,this._passParameters.lineStartWorld),(0,h.S$)(k,this._passParameters.lineEndWorld)}else(0,r.c)(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),(0,r.g)(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}get test(){return{passParameters:this._passParameters}}};(0,a._)([(0,c.Cb)({constructOnly:!0})],B.prototype,"contrastControlEnabled",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],B.prototype,"_isDecoration",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],B.prototype,"renderCoordsHelper",void 0),B=(0,a._)([(0,d.j)("esri.views.3d.support.LaserLineRenderer")],B);const k=(0,h.Ue)();class q extends o.l{constructor(e){super(e),this._angleCutoff=U.d,this._style={},this._heightManifoldTarget=(0,n.c)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,s.Ue)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProperties(e)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(e){this._angleCutoff!==e&&(this._angleCutoff=e,this._syncAngleCutoff())}get style(){return this._style}set style(e){this._style=e,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(e){null!=e?((0,r.c)(this._heightManifoldTarget,e),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(e){if(null==e)return void(this.intersectsLine=null);const t=this.view.renderCoordsHelper.worldUpAtPosition(e,Y);this.intersectsLine=(0,s.al)(e,t),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(e){null!=e?((0,s.JG)(e,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(e){this._intersectsLineInfinite=e,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(e){this._lineVerticalPlaneSegment=null!=e?(0,s.JG)(e):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(e){this._pathVerticalPlaneBuffers=e,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(e){this._pointDistanceLine=null!=e?{origin:(0,n.g)(e.origin),target:e.target?(0,n.g)(e.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||null!=this._pointDistanceLine||null!=this._pathVerticalPlaneBuffers)?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){null==this._renderer&&(this._renderer=new B({renderCoordsHelper:this.view.renderCoordsHelper,contrastControlEnabled:!0,_isDecoration:this.isDecoration}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer))}_syncStyle(){null!=this._renderer&&(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){null!=this._renderer&&this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){null!=this._renderer&&(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){null!=this._renderer&&(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){null!=this._renderer&&(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){null!=this._renderer&&(this._renderer.pathVerticalPlaneEnabled=null!=this._pathVerticalPlaneBuffers&&this.visible,null!=this._pathVerticalPlaneBuffers&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){null!=this._renderer&&(this._renderer.lineVerticalPlaneEnabled=null!=this._lineVerticalPlaneSegment&&this.visible,null!=this._lineVerticalPlaneSegment&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if(null==this._renderer)return;const e=this._pointDistanceLine,t=null!=e;this._renderer.pointDistanceEnabled=t&&null!=e.target&&this.visible,t&&(this._renderer.pointDistanceOrigin=e.origin,null!=e.target&&(this._renderer.pointDistanceTarget=e.target))}_disposeRenderer(){null!=this._renderer&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const Y=(0,n.c)()},86244:(e,t,i)=>{i.d(t,{l:()=>n});var r=i(94172);class n{get isDecoration(){return this._isDecoration}set isDecoration(e){this._isDecoration=e}constructor(e){this._isDecoration=!1,this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=e.view,this._handle=(0,r.YP)((()=>e.view.ready),(e=>{this._resourcesCreated&&(e?this._createResources():this._destroyResources())}))}applyProperties(e){let t=!1;for(const i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(e))}onAttachedChange(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}},96387:(e,t,i)=>{i(68860),i(14226),i(81949),i(71353),i(90045),i(67077),i(45925),i(41414),i(65156),i(4954),i(69662),i(37818),i(4760)},77648:(e,t,i)=>{i.d(t,{Fb:()=>n,KO:()=>s});var r=i(81020);function n(e){return"array"in e}function s(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"ground";if((0,r.f)(t))return e.getElevation(t.x,t.y,t.z||0,t.spatialReference,i);if(n(t)){var s;let r=t.offset;return e.getElevation(t.array[r++],t.array[r++],t.array[r]||0,null!==(s=t.spatialReference)&&void 0!==s?s:e.spatialReference,i)}return e.getElevation(t[0],t[1],t[2]||0,e.spatialReference,i)}},67794:(e,t,i)=>{i.d(t,{Rg:()=>l,cU:()=>c,hy:()=>a});i(93169);var r=i(46228),n=i(76873),s=i(8548);const o=128,a=.5;function l(e){return"cross"===e||"x"===e}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;const i=d(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return new n.x(i,{mipmap:!1,wrap:{s:s.e8.CLAMP_TO_EDGE,t:s.e8.CLAMP_TO_EDGE},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0})}function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t*a,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;switch(e){case"circle":default:return function(e,t){const i=e/2-.5;return g(e,p(i,i,t/2))}(t,i);case"square":return function(e,t){return h(e,t,!1)}(t,i);case"cross":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!1,i)}(t,i,r);case"x":return function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return u(e,t,!0,i)}(t,i,r);case"kite":return function(e,t){return h(e,t,!0)}(t,i);case"triangle":return function(e,t){return g(e,f(e/2,t,t/2))}(t,i);case"arrow":return function(e,t){const i=t,r=t/2,n=e/2,s=.8*i,o=p(n,(e-t)/2-s,Math.sqrt(s*s+r*r)),a=f(n,i,r);return g(e,((e,t)=>Math.max(a(e,t),-o(e,t))))}(t,i)}}function h(e,t,i){return i&&(t/=Math.SQRT2),g(e,((r,n)=>{let s=r-.5*e+.25,o=.5*e-n-.75;if(i){const e=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(o))-.5*t}))}function u(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t-=r,i&&(t*=Math.SQRT2);const n=.5*t;return g(e,((t,s)=>{let o,a=t-.5*e,l=.5*e-s-1;if(i){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),o=a>l?a>n?Math.sqrt((a-n)*(a-n)+l*l):l:l>n?Math.sqrt(a*a+(l-n)*(l-n)):a,o-=r/2,o}))}function p(e,t,i){return(r,n)=>{const s=r-e,o=n-t;return Math.sqrt(s*s+o*o)-i}}function f(e,t,i){const r=Math.sqrt(t*t+i*i);return(n,s)=>{const o=Math.abs(n-e)-i,a=s-e+t/2+.75,l=(t*o+i*a)/r,c=-a;return Math.max(l,c)}}function g(e,t){const i=new Uint8Array(4*e*e);for(let n=0;n<e;n++)for(let s=0;s<e;s++){const o=s+e*n;let a=t(s,n);a=a/e+.5,(0,r.I)(a,i,4*o)}return i}},81703:(e,t,i)=>{i.d(t,{u4:()=>a});var r=i(17842),n=i(88396),s=i(11186),o=(i(40885),i(51378));function a(e,t,i){return function(e,t,i){const a=(0,r.Wv)((0,n.j)(o.WM.get(),t));if(a[2]=0,!e.unprojectFromRenderScreen(a,i.origin))return null;const l=(0,r.Wv)((0,n.j)(o.WM.get(),t));l[2]=1;const c=e.unprojectFromRenderScreen(l,o.WM.get());return null==c?null:((0,s.f)(i.direction,c,i.origin),i)}(e,e.screenToRender(t,(0,r.Wv)(o.WM.get())),i)}},54134:(e,t,i)=>{var r,n,s,o;i.d(t,{fu:()=>r}),function(e){e[e.INNER=0]="INNER",e[e.OUTER=1]="OUTER"}(r||(r={})),function(e){e[e.REGULAR=0]="REGULAR",e[e.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",e[e.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",e[e.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(n||(n={})),function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON"}(s||(s={})),function(e){e[e.FADING=0]="FADING",e[e.IMMEDIATE=1]="IMMEDIATE",e[e.UNFADED=2]="UNFADED"}(o||(o={}))},8084:(e,t,i)=>{i.d(t,{j:()=>v});var r,n,s,o,a,l,c=i(30168),d=i(21002),h=i(96415),u=i(82999),p=i(49450),f=i(58406),g=i(98634),_=i(19253);function v(e,t){const i=e.fragment;i.include(d.S),e.include(h.GZ),i.uniforms.add(new f.p("globalAlpha",(e=>e.globalAlpha)),new p.J("glowColor",(e=>e.glowColor)),new f.p("glowWidth",((e,t)=>e.glowWidth*t.camera.pixelRatio)),new f.p("glowFalloff",(e=>e.glowFalloff)),new p.J("innerColor",(e=>e.innerColor)),new f.p("innerWidth",((e,t)=>e.innerWidth*t.camera.pixelRatio)),new _.A("depthMap",((e,t)=>{var i;return null===(i=t.linearDepth)||void 0===i?void 0:i.colorTexture})),new u.A("nearFar",((e,t)=>t.camera.nearFar)),new _.A("frameColor",((e,t)=>t.mainColor))),i.code.add((0,g.H)(r||(r=(0,c.Z)(["vec4 blendPremultiplied(vec4 source, vec4 dest) {\nfloat oneMinusSourceAlpha = 1.0 - source.a;\nreturn vec4(\nsource.rgb + dest.rgb * oneMinusSourceAlpha,\nsource.a + dest.a * oneMinusSourceAlpha\n);\n}"])))),i.code.add((0,g.H)(n||(n=(0,c.Z)(["vec4 premultipliedColor(vec3 rgb, float alpha) {\nreturn vec4(rgb * alpha, alpha);\n}"])))),i.code.add((0,g.H)(s||(s=(0,c.Z)(["vec4 laserlineProfile(float dist) {\nif (dist > glowWidth) {\nreturn vec4(0.0);\n}\nfloat innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));\nfloat glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);\nreturn blendPremultiplied(\npremultipliedColor(innerColor, innerAlpha),\npremultipliedColor(glowColor, glowAlpha)\n);\n}"])))),i.code.add((0,g.H)(o||(o=(0,c.Z)(["bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {\nfloat depth = linearDepthFromTexture(depthMap, uv, nearFar);\nif (-depth == nearFar[0]) {\nreturn false;\n}\npos = reconstructPosition(gl_FragCoord.xy, depth);\nnormal = normalize(cross(dFdx(pos), dFdy(pos)));\nfloat ddepth = fwidth(depth);\ndepthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\nreturn true;\n}"])))),t.contrastControlEnabled?(i.uniforms.add(new f.p("globalAlphaContrastBoost",(e=>null!=e.globalAlphaContrastBoost?e.globalAlphaContrastBoost:1))),i.code.add((0,g.H)(a||(a=(0,c.Z)(["float rgbToLuminance(vec3 color) {\nreturn dot(vec3(0.2126, 0.7152, 0.0722), color);\n}\nvec4 laserlineOutput(vec4 color) {\nfloat backgroundLuminance = rgbToLuminance(texture(frameColor, uv).rgb);\nfloat alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);\nreturn color * alpha;\n}"]))))):i.code.add((0,g.H)(l||(l=(0,c.Z)(["vec4 laserlineOutput(vec4 color) {\nreturn color * globalAlpha;\n}"]))))}},43505:(e,t,i)=>{i.d(t,{A:()=>l});var r,n=i(30168),s=i(82552),o=i(58406),a=i(98634);function l(e,t){if(!t.screenSizeEnabled)return;const i=e.vertex;(0,s.hY)(i,t),i.uniforms.add(new o.p("perScreenPixelRatio",((e,t)=>t.camera.perScreenPixelRatio)),new o.p("screenSizeScale",(e=>e.screenSizeScale))),i.code.add((0,a.H)(r||(r=(0,n.Z)(["float computeRenderPixelSizeAt( vec3 pWorld ){\nvec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);\nfloat viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));\nreturn viewDirectionDistance * perScreenPixelRatio;\n}\nvec3 screenSizeScaling(vec3 position, vec3 anchor){\nreturn position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;\n}"]))))}},48353:(e,t,i)=>{i.d(t,{U:()=>v});var r,n,s,o,a,l,c=i(30168),d=i(28643),h=i(49450),u=i(58406),p=i(699),f=i(98634),g=i(4760);const _=8;function v(e,t){const i=e.vertex;i.uniforms.add(new u.p("intrinsicWidth",(e=>e.width))),t.vvSize?(e.attributes.add(g.T.SIZEFEATUREATTRIBUTE,"float"),i.uniforms.add(new h.J("vvSizeMinSize",(e=>e.vvSize.minSize)),new h.J("vvSizeMaxSize",(e=>e.vvSize.maxSize)),new h.J("vvSizeOffset",(e=>e.vvSize.offset)),new h.J("vvSizeFactor",(e=>e.vvSize.factor))),i.code.add((0,f.H)(r||(r=(0,c.Z)(["float getSize() {\nreturn intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;\n}"]))))):(e.attributes.add(g.T.SIZE,"float"),i.code.add((0,f.H)(n||(n=(0,c.Z)(["float getSize(){\nreturn intrinsicWidth * size;\n}"]))))),t.vvOpacity?(e.attributes.add(g.T.OPACITYFEATUREATTRIBUTE,"float"),i.constants.add("vvOpacityNumber","int",8),i.uniforms.add(new p.O("vvOpacityValues",(e=>e.vvOpacity.values),_),new p.O("vvOpacityOpacities",(e=>e.vvOpacity.opacityValues),_)),i.code.add((0,f.H)(s||(s=(0,c.Z)(["float interpolateOpacity( float value ){\nif (value <= vvOpacityValues[0]) {\nreturn vvOpacityOpacities[0];\n}\nfor (int i = 1; i < vvOpacityNumber; ++i) {\nif (vvOpacityValues[i] >= value) {\nfloat f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);\nreturn mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);\n}\n}\nreturn vvOpacityOpacities[vvOpacityNumber - 1];\n}\nvec4 applyOpacity( vec4 color ){\nreturn vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));\n}"]))))):i.code.add((0,f.H)(o||(o=(0,c.Z)(["vec4 applyOpacity( vec4 color ){\nreturn color;\n}"])))),t.vvColor?(e.include(d.k,t),e.attributes.add(g.T.COLORFEATUREATTRIBUTE,"float"),i.code.add((0,f.H)(a||(a=(0,c.Z)(["vec4 getColor(){\nreturn applyOpacity(interpolateVVColor(colorFeatureAttribute));\n}"]))))):(e.attributes.add(g.T.COLOR,"vec4"),i.code.add((0,f.H)(l||(l=(0,c.Z)(["vec4 getColor(){\nreturn applyOpacity(color);\n}"])))))}},28156:(e,t,i)=>{i.d(t,{H:()=>l});var r,n,s=i(30168),o=i(13773),a=i(98634);function l(e){e.uniforms.add(new o.U("alignPixelEnabled",((e,t)=>t.alignPixelEnabled))),e.code.add((0,a.H)(r||(r=(0,s.Z)(["vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\nif (!alignPixelEnabled)\nreturn clipCoord;\nvec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"])))),e.code.add((0,a.H)(n||(n=(0,s.Z)(["vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\nif (!alignPixelEnabled)\nreturn clipCoord;\nvec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;\nvec2 pixelSz = vec2(1.0) / widthHeight;\nvec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;\nvec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;\nreturn vec4(result, clipCoord.zw);\n}"]))))}},81879:(e,t,i)=>{i.d(t,{R:()=>y,c:()=>m});var r,n,s,o,a,l,c,d=i(30168),h=i(49223),u=i(62993),p=i(82552),f=i(95276),g=i(58406),_=i(98634),v=i(4760);const m=.5;function y(e,t){e.include(u.cK),e.attributes.add(v.T.POSITION,"vec3"),e.attributes.add(v.T.NORMAL,"vec3"),e.attributes.add(v.T.AUXPOS1,"vec4");const i=e.vertex;(0,p.Sv)(i,t),(0,p.hY)(i,t),i.uniforms.add(new f.N("viewport",((e,t)=>t.camera.fullViewport)),new g.p("polygonOffset",(e=>e.shaderPolygonOffset)),new g.p("cameraGroundRelative",((e,t)=>t.camera.aboveGround?1:-1))),t.hasVerticalOffset&&(0,h.V)(i),i.constants.add("smallOffsetAngle","float",.984807753012208),i.code.add((0,_.H)(r||(r=(0,d.Z)(["struct ProjectHUDAux {\nvec3 posModel;\nvec3 posView;\nvec3 vnormal;\nfloat distanceToCamera;\nfloat absCosAngle;\n};"])))),i.code.add((0,_.H)(n||(n=(0,d.Z)(["\n    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\n      float pointGroundSign = ",";\n      if (pointGroundSign == 0.0) {\n        pointGroundSign = cameraGroundRelative;\n      }\n\n      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\n      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\n      float groundRelative = cameraGroundRelative * pointGroundSign;\n\n      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is\n      // dropped is instead introduced using the ground-relative position of the symbol and the camera\n      if (polygonOffset > .0) {\n        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);\n        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\n        float factor = (1.0 - tanAlpha / viewport[2]);\n\n        // same side of the terrain\n        if (groundRelative > 0.0) {\n          posView *= factor;\n        }\n        // opposite sides of the terrain\n        else {\n          posView /= factor;\n        }\n      }\n\n      return groundRelative;\n    }\n  "])),t.multipassEnabled?_.H.float(0):(0,_.H)(s||(s=(0,d.Z)(["sign(pointGroundDistance)"]))))),t.draped&&!t.hasVerticalOffset||(0,p._8)(i),t.draped||(i.uniforms.add(new g.p("perDistancePixelRatio",((e,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2)))),i.code.add((0,_.H)(o||(o=(0,d.Z)(["\n    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\n      float distanceToCamera = length(posView);\n\n      // Compute offset in world units for a half pixel shift\n      float pixelOffset = distanceToCamera * perDistancePixelRatio * ",";\n\n      // Apply offset along normal in the direction away from the ground surface\n      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;\n\n      // Apply the same offset also on the view space position\n      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n\n      posModel += modelOffset;\n      posView += viewOffset;\n    }\n  "])),_.H.float(m)))),t.screenCenterOffsetUnitsEnabled&&(0,p.ZI)(i),t.hasScreenSizePerspective&&(0,u.m8)(i),i.code.add((0,_.H)(a||(a=(0,d.Z)(["\n    vec4 projectPositionHUD(out ProjectHUDAux aux) {\n      // centerOffset is in view space and is used to implement world size offset of labels with respect to objects.\n      // It also pulls the label towards the viewer so that the label is visible in front of the object.\n      vec3 centerOffset = auxpos1.xyz;\n\n      // The pointGroundDistance is the distance of the geometry to the ground and is\n      // negative if the point is below the ground, or positive if the point is above\n      // ground.\n      float pointGroundDistance = auxpos1.w;\n\n      aux.posModel = position;\n      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;\n      aux.vnormal = normal;\n      ","\n\n      // Screen sized offset in world space, used for example for line callouts\n      // Note: keep this implementation in sync with the CPU implementation, see\n      //   - MaterialUtil.verticalOffsetAtDistance\n      //   - HUDMaterial.applyVerticalOffsetTransformation\n\n      aux.distanceToCamera = length(aux.posView);\n\n      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);\n      float cosAngle = dot(aux.vnormal, viewDirObjSpace);\n\n      aux.absCosAngle = abs(cosAngle);\n\n      ","\n\n      ","\n\n      ","\n\n      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\n\n      ","\n\n      vec4 posProj = proj * vec4(aux.posView, 1.0);\n\n      ","\n\n      ","\n\n      // constant part of polygon offset emulation\n      posProj.z -= groundRelative * polygonOffset * posProj.w;\n      return posProj;\n    }\n  "])),t.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);",t.hasScreenSizePerspective&&(t.hasVerticalOffset||t.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"",t.hasVerticalOffset?t.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":"",t.hasVerticalOffset?(0,_.H)(l||(l=(0,d.Z)(["\n            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\n            vec3 modelOffset = aux.vnormal * worldOffset;\n            aux.posModel += modelOffset;\n            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;\n            aux.posView += viewOffset;\n            // Since we elevate the object, we need to take that into account\n            // in the distance to ground\n            pointGroundDistance += worldOffset;"]))):"",t.screenCenterOffsetUnitsEnabled?"":(0,_.H)(c||(c=(0,d.Z)(["\n            // Apply x/y in view space, but z in screen space (i.e. along posView direction)\n            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);\n\n            // Same material all have same z != 0.0 condition so should not lead to\n            // branch fragmentation and will save a normalization if it's not needed\n            if (centerOffset.z != 0.0) {\n              aux.posView -= normalize(aux.posView) * centerOffset.z;\n            }\n          "]))),t.screenCenterOffsetUnitsEnabled?t.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":"",t.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""))}},50913:(e,t,i)=>{i.d(t,{R:()=>u});var r,n,s,o,a=i(30168),l=i(28156),c=i(43565),d=i(15226),h=i(98634);function u(e,t){const{vertex:i,fragment:u}=e;i.include(l.H),t.multipassEnabled&&(i.include(c.S),e.varyings.add("depth","float")),i.code.add((0,h.H)(r||(r=(0,a.Z)(["\n  void main(void) {\n    vec4 posProjCenter;\n    if (dot(position, position) > 0.0) {\n      // Render single point to center of the pixel to avoid subpixel filtering to affect the marker color\n      ProjectHUDAux projectAux;\n      vec4 posProj = projectPositionHUD(projectAux);\n      posProjCenter = alignToPixelCenter(posProj, viewport.zw);\n\n      ","\n\n      ","\n      vec3 vpos = projectAux.posModel;\n      if (rejectBySlice(vpos)) {\n        // Project out of clip space\n        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n      }\n\n    } else {\n      // Project out of clip space\n      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n    }\n\n    gl_Position = posProjCenter;\n    gl_PointSize = 1.0;\n  }\n  "])),t.multipassEnabled?(0,h.H)(n||(n=(0,a.Z)(["\n        // Don't draw vertices behind geometry\n        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){\n          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);\n        }"]))):"",t.multipassEnabled?"depth = projectAux.posView.z;":"")),e.include(d.l,t),u.code.add((0,h.H)(s||(s=(0,a.Z)(["\n  void main() {\n    fragColor = vec4(1);\n    ","\n  }\n  "])),t.multipassEnabled?(0,h.H)(o||(o=(0,a.Z)(["\n        if(terrainDepthTest(depth)) {\n          fragColor.g = 0.5;\n        }"]))):""))}},83866:(e,t,i)=>{var r;i.d(t,{U:()=>r}),function(e){e[e.Occluded=0]="Occluded",e[e.NotOccluded=1]="NotOccluded",e[e.Both=2]="Both",e[e.COUNT=3]="COUNT"}(r||(r={}))},55616:(e,t,i)=>{i.d(t,{P:()=>h});var r,n=i(30168),s=i(28156),o=i(83866),a=i(95276),l=i(58406),c=i(98634),d=i(19253);function h(e){e.vertex.uniforms.add(new l.p("renderTransparentlyOccludedHUD",((e,t)=>t.hudRenderStyle===o.U.Occluded?1:t.hudRenderStyle===o.U.NotOccluded?0:.75)),new a.N("viewport",((e,t)=>t.camera.fullViewport)),new d.A("hudVisibilityTexture",((e,t)=>{var i;return null===(i=t.hudVisibility)||void 0===i?void 0:i.colorTexture}))),e.vertex.include(s.H),e.vertex.code.add((0,c.H)(r||(r=(0,n.Z)(["bool testHUDVisibility(vec4 posProj) {\nvec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);\nvec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\nif (renderTransparentlyOccludedHUD > 0.5) {\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;\n}\nreturn occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;\n}"]))))}},7683:(e,t,i)=>{i.d(t,{E:()=>l,K:()=>a});var r,n,s=i(30168),o=i(98634);function a(e){e.fragment.code.add((0,o.H)(r||(r=(0,s.Z)(["float normals2FoamIntensity(vec3 n, float waveStrength){\nfloat normalizationFactor =  max(0.015, waveStrength);\nreturn max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);\n}"]))))}function l(e){e.fragment.code.add((0,o.H)(n||(n=(0,s.Z)(["vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){\nreturn foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;\n}"]))))}},2631:(e,t,i)=>{i.d(t,{q:()=>T,C:()=>R});var r=i(30168),n=i(78980),s=i(82552),o=i(95276),a=i(58406),l=i(98634),c=i(19253);i(46228),i(8548),i(57808),i(52311);function d(e){return e.pattern.map((t=>Math.round(t*e.pixelRatio)))}function h(e){if(null==e)return 1;const t=d(e);return Math.floor(t.reduce(((e,t)=>e+t)))}function u(e){return d(e).reduce(((e,t)=>Math.max(e,t)))}var p=i(90045),f=i(67077);const g=(0,f.c)();var _,v,m,y,b,w,S,x,C;function T(e,t){e.constants.add("stippleAlphaColorDiscard","float",.001),e.constants.add("stippleAlphaHighlightDiscard","float",.5),t.stippleEnabled?function(e,t){const i=!(t.draped&&t.stipplePreferContinuous),{vertex:d,fragment:h}=e;h.include(n.n),t.draped||((0,s.hY)(d,t),d.uniforms.add(new a.p("worldToScreenPerDistanceRatio",((e,t)=>1/t.camera.perScreenPixelRatio))),d.code.add((0,l.H)(_||(_=(0,r.Z)(["float computeWorldToScreenRatio(vec3 segmentCenter) {\nfloat segmentDistanceToCamera = length(segmentCenter - cameraPosition);\nreturn worldToScreenPerDistanceRatio / segmentDistanceToCamera;\n}"]))))),e.varyings.add("vStippleDistance","float"),e.varyings.add("vStippleDistanceLimits","vec2"),e.varyings.add("vStipplePatternStretch","float"),d.code.add((0,l.H)(v||(v=(0,r.Z)(["\n    float discretizeWorldToScreenRatio(float worldToScreenRatio) {\n      float step = ",";\n\n      float discreteWorldToScreenRatio = log(worldToScreenRatio);\n      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;\n      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);\n      return discreteWorldToScreenRatio;\n    }\n  "])),O)),d.code.add((0,l.H)(m||(m=(0,r.Z)(["vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {"])))),d.code.add((0,l.H)(y||(y=(0,r.Z)(["\n    if (segmentLengthPseudoScreen >= ",") {\n  "])),i?"patternLength":"1e4")),(0,s.ZI)(d),d.code.add((0,l.H)(b||(b=(0,r.Z)(["float repetitions = segmentLengthScreen / (patternLength * pixelRatio);\nfloat flooredRepetitions = max(1.0, floor(repetitions + 0.5));\nfloat segmentLengthScreenRounded = flooredRepetitions * patternLength;\nfloat stretch = repetitions / flooredRepetitions;\nvStipplePatternStretch = max(0.75, stretch);\nreturn vec2(0.0, segmentLengthScreenRounded);\n}\nreturn vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);\n}"])))),h.uniforms.add(new c.A("stipplePatternTexture",(e=>e.stippleTexture)),new a.p("stipplePatternSDFNormalizer",(e=>function(e){return e?(Math.floor(.5*(u(e)-1))+.5)/e.pixelRatio:1}(e.stipplePattern))),new a.p("stipplePatternPixelSizeInv",(e=>1/R(e)))),h.code.add((0,l.H)(w||(w=(0,r.Z)(["float getStippleSDF(out bool isClamped) {\nfloat stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);\nvec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;\nisClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;\nfloat u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv * vLineSizeInv;\nu = fract(u);\nfloat encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));\nfloat sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;\nreturn (sdf - 0.5) * vStipplePatternStretch + 0.5;\n}\nfloat getStippleSDF() {\nbool ignored;\nreturn getStippleSDF(ignored);\n}\nfloat getStippleAlpha() {\nbool isClamped;\nfloat stippleSDF = getStippleSDF(isClamped);\nfloat antiAliasedResult = clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);\nreturn isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;\n}"])))),t.stippleOffColorEnabled?(h.uniforms.add(new o.N("stippleOffColor",(e=>function(e){return null==e?f.Z:4===e.length?e:(0,p.s)(g,e[0],e[1],e[2],1)}(e.stippleOffColor)))),h.code.add((0,l.H)(S||(S=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) {}\n#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)"]))))):h.code.add((0,l.H)(x||(x=(0,r.Z)(["#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }\n#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)"]))))}(e,t):function(e){e.fragment.code.add((0,l.H)(C||(C=(0,r.Z)(["float getStippleAlpha() { return 1.0; }\n#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}\n#define blendStipple(color, _stippleAlpha_) color"]))))}(e)}function R(e){const t=e.stipplePattern;return t?h(e.stipplePattern)/t.pixelRatio:1}const O=l.H.float(.4)},74823:(e,t,i)=>{i.d(t,{Q:()=>h});var r=i(30168);i(67794),i(8548),i(57808),i(52311);const n=10;var s,o,a=i(82552),l=i(58406),c=i(98634),d=i(33720);function h(e,t){const{vertex:i,constants:h}=e;h.add("markerSizePerLineWidth","float",n),(0,a.ZI)(i),null==i.uniforms.get("markerScale")&&i.constants.add("markerScale","float",1),i.code.add((0,c.H)(s||(s=(0,r.Z)(["float getLineWidth() {\nreturn max(getSize(), 1.0) * pixelRatio;\n}\nfloat getScreenMarkerSize() {\nreturn markerSizePerLineWidth * markerScale * getLineWidth();\n}"])))),t.space===d.I9.World&&(i.constants.add("maxSegmentLengthFraction","float",.45),i.uniforms.add(new l.p("perRenderPixelRatio",((e,t)=>t.camera.perRenderPixelRatio))),i.code.add((0,c.H)(o||(o=(0,r.Z)(["bool areWorldMarkersHidden(vec4 pos, vec4 other) {\nvec3 midPoint = mix(pos.xyz, other.xyz, 0.5);\nfloat distanceToCamera = length(midPoint);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nfloat worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;\nfloat segmentLen = length(pos.xyz - other.xyz);\nreturn worldMarkerSize > maxSegmentLengthFraction * segmentLen;\n}\nfloat getWorldMarkerSize(vec4 pos) {\nfloat distanceToCamera = length(pos.xyz);\nfloat screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;\nreturn getScreenMarkerSize() * screenToWorldRatio;\n}"])))))}},43565:(e,t,i)=>{i.d(t,{S:()=>c,_:()=>d});var r,n=i(30168),s=i(21002),o=i(82999),a=i(98634),l=i(19253);function c(e){e.include(s.S),e.uniforms.add(new l.A("geometryDepthTexture",((e,t)=>{var i;return null===(i=t.multipassGeometry.linearDepth)||void 0===i?void 0:i.colorTexture})),new o.A("nearFar",((e,t)=>t.camera.nearFar))),e.code.add((0,a.H)(r||(r=(0,n.Z)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}class d{}},8555:(e,t,i)=>{i.d(t,{n:()=>c});var r,n,s,o,a=i(30168),l=i(98634);function c(e,t){t.spherical?e.vertex.code.add((0,l.H)(r||(r=(0,a.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn normalize(pos + origin);\n}"])))):e.vertex.code.add((0,l.H)(n||(n=(0,a.Z)(["vec3 getLocalUp(in vec3 pos, in vec3 origin) {\nreturn vec3(0.0, 0.0, 1.0);\n}"])))),t.spherical?e.vertex.code.add((0,l.H)(s||(s=(0,a.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"])))):e.vertex.code.add((0,l.H)(o||(o=(0,a.Z)(["mat3 getTBNMatrix(in vec3 n) {\nvec3 t = vec3(1.0, 0.0, 0.0);\nvec3 b = normalize(cross(n, t));\nreturn mat3(t, b, n);\n}"]))))}},29078:(e,t,i)=>{i.d(t,{B:()=>W});var r,n=i(30168),s=i(7683),o=i(98634);function a(e){e.fragment.code.add((0,o.H)(r||(r=(0,n.Z)(["const float GAMMA = 2.2;\nconst float INV_GAMMA = 0.4545454545;\nvec4 delinearizeGamma(vec4 color) {\nreturn vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);\n}\nvec3 linearizeGamma(vec3 color) {\nreturn pow(color, vec3(GAMMA));\n}"]))))}var l,c=i(2116),d=i(21002),h=i(82999),u=i(58406),p=i(8654),f=i(19253);function g(e,t){const i=e.fragment;i.include(d.S),i.uniforms.add(new h.A("nearFar",((e,t)=>t.camera.nearFar))),i.uniforms.add(new f.A("depthMap",((e,t)=>{var i;return null===(i=t.linearDepth)||void 0===i?void 0:i.colorTexture}))),i.uniforms.add(new p.g("proj",((e,t)=>t.camera.projectionMatrix))),i.uniforms.add(new u.p("invResolutionHeight",((e,t)=>1/t.camera.height))),i.uniforms.add(new p.g("reprojectionMatrix",((e,t)=>t.ssr.reprojectionMatrix))),i.code.add((0,o.H)(l||(l=(0,n.Z)(["\n  vec2 reprojectionCoordinate(vec3 projectionCoordinate)\n  {\n    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);\n    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);\n    reprojectedCoord.xy /= reprojectedCoord.w;\n    return reprojectedCoord.xy * 0.5 + 0.5;\n  }\n\n  const int maxSteps = ",";\n\n  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)\n  {\n    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);\n    projectedCoord.xy /= projectedCoord.w;\n    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;\n    return projectedCoord;\n  }\n\n  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)\n  {\n    vec3 viewPos = startPosition;\n    vec3 viewPosEnd = startPosition;\n\n    // Project the start position to the screen\n    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);\n    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space\n    float k0 = 1.0/ projectedCoordStart.w;\n\n    // advance the position in the direction of the reflection\n    viewPos += dir;\n\n    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);\n\n    // Project the advanced position to the screen\n    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);\n    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space\n    float k1 = 1.0/ projectedCoordEnd.w;\n\n    // calculate the reflection direction in the screen space\n    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);\n    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);\n\n    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);\n\n    float projectedCoordDirLength = length(projectedCoordDir);\n    float maxSt = float(maxSteps);\n\n    // normalize the projection direction depending on maximum steps\n    // this determines how blocky the reflection looks\n    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);\n\n    // Normalize the homogeneous camera space coordinates\n    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);\n    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);\n\n    // initialize the variables for ray marching\n    vec2 P = projectedCoordStart.xy;\n    vec3 Q = Q0;\n    float k = k0;\n    float rayStartZ = -startPosition.z; // estimated ray start depth value\n    float rayEndZ = -startPosition.z;   // estimated ray end depth value\n    float prevEstimateZ = -startPosition.z;\n    float rayDiffZ = 0.0;\n    float dDepth;\n    float depth;\n    float rayDiffZOld = 0.0;\n\n    // early outs\n    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)\n      return vec3(P, 0.0);\n\n    for(int i = 0; i < maxSteps-1; i++)\n    {\n      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer\n\n      // estimate depth of the marching ray\n      rayStartZ = prevEstimateZ;\n      dDepth = -rayStartZ - depth;\n      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));\n      rayDiffZ = rayEndZ- rayStartZ;\n      prevEstimateZ = rayEndZ;\n\n      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )\n      {\n        return vec3(P, 0.);\n      }\n\n      // If we detect a hit - return the intersection point, two conditions:\n      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth\n      //  - if difference between dDepth and rayDiffZOld is not too large\n      //  - if difference between dDepth and 0.025/abs(k) is not too large\n      //  - if the sampled depth is not behind far plane or in front of near plane\n\n      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)\n      {\n        return vec3(P, depth);\n      }\n\n      // continue with ray marching\n      P = clamp(P + dP, vec2(0.0), vec2(0.999));\n      Q.z += dQ.z;\n      k += dk;\n      rayDiffZOld = rayDiffZ;\n    }\n    return vec3(P, 0.0);\n  }\n  "])),t.highStepCount?"150":"75"))}var _,v,m,y,b,w,S,x,C,T,R,O,P,E,A,D,L=i(16889),M=i(22186),I=i(46208),F=i(5573),j=i(82278),V=i(92395),H=i(13773),N=i(49450),z=i(61809),U=i(99340);class G extends z.x{constructor(e,t){super(e,"samplerCube",U.P.Pass,((i,r,n)=>i.bindTexture(e,t(r,n))))}}function Z(e){const t=e.fragment;t.uniforms.add(new p.g("rotationMatrixClouds",((e,t)=>t.cloudsFade.parallax.transform)),new p.g("rotationMatrixCloudsCrossFade",((e,t)=>t.cloudsFade.parallaxNew.transform)),new N.J("anchorPosition",((e,t)=>t.cloudsFade.parallax.anchorPointClouds)),new N.J("anchorPositionCrossFade",((e,t)=>t.cloudsFade.parallaxNew.anchorPointClouds)),new u.p("cloudsHeight",(()=>j.$T)),new u.p("radiusCurvatureCorrectionFactor",((e,t)=>t.cloudsFade.parallax.radiusCurvatureCorrectionFactor)),new u.p("totalFadeInOut",((e,t)=>1-t.cloudsFade.opacity)),new u.p("crossFadeAnchorFactor",((e,t)=>(0,L.uZ)(t.cloudsFade.fadeFactor,0,1))),new G("cubeMap",((e,t)=>{var i,r;return null!==(i=null===(r=t.cloudsFade.data)||void 0===r||null===(r=r.cubeMap)||void 0===r?void 0:r.colorTexture)&&void 0!==i?i:null})),new H.U("crossFade",((e,t)=>t.cloudsFade.fadeMode===F.lL.CROSS_FADE)),new H.U("readChannelsRG",((e,t)=>t.cloudsFade.readChannels===I.uz.RG)),new H.U("fadeTextureChannels",((e,t)=>t.cloudsFade.renderingStage===I.jL.FADING))),t.constants.add("planetRadius","float",M.sv.radius),t.code.add((0,o.H)(_||(_=(0,n.Z)(["vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)\n{\nfloat radiusClouds = planetRadius + cloudsHeight;\nfloat B = 2.0 * dot(cameraPosition, dir);\nfloat C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;\nfloat det = B * B - 4.0 * C;\nfloat pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));\nvec3 intersectionPont = cameraPosition + dir * pointIntDist;\nintersectionPont =  intersectionPont - spherePos;\nreturn intersectionPont;\n}"])))),t.code.add((0,o.H)(v||(v=(0,n.Z)(["vec3 correctForPlanetCurvature(vec3 dir)\n{\ndir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;\nreturn dir;\n}"])))),t.code.add((0,o.H)(m||(m=(0,n.Z)(["vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)\n{\nreturn (rotMat * vec4(inVec, 0.0)).xyz;\n}"])))),(0,V.Pe)(t),(0,V.F1)(t),t.code.add((0,o.H)(y||(y=(0,n.Z)(["const float SUNSET_TRANSITION_FACTOR = 0.3;\nconst vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);\nconst float RIM_SCATTERING_FACTOR = 140.0;\nconst float BACKLIGHT_FACTOR = 0.2;\nconst float BACKLIGHT_SCATTERING_FACTOR = 10.0;\nconst float BACKLIGHT_TRANSITION_FACTOR = 0.3;\nvec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)\n{\nfloat upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));\nfloat dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);\nfloat sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);\nvec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);\nvec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);\nvec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));\nvec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));\nfloat scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);\nfloat rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);\nvec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;\nfloat additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;\nreturn vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);\n}"])))),t.code.add((0,o.H)(b||(b=(0,n.Z)(["vec4 getCloudData(vec3 rayDir, bool readOtherChannel)\n{\nvec4 cloudData = texture(cubeMap, rayDir);\nfloat mu = dot(rayDir, vec3(0, 0, 1));\nbool readChannels = readChannelsRG ^^ readOtherChannel;\nif (readChannels) {\ncloudData = vec4(vec3(cloudData.r), cloudData.g);\n} else {\ncloudData = vec4(vec3(cloudData.b), cloudData.a);\n}\nif (length(cloudData) == 0.0) {\nreturn vec4(cloudData.rgb, 1.0);\n}\nreturn cloudData;\n}"])))),t.code.add((0,o.H)(w||(w=(0,n.Z)(["vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nfloat totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudData.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);\n}"])))),t.code.add((0,o.H)(S||(S=(0,n.Z)(["vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)\n{\nvec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);\nvec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));\nvec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\nvec4 cloudData = getCloudData(worldRayRotatedCorrected, false);\nvec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\nintersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);\nworldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));\nworldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);\ncloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);\nvec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);\ncloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);\nfloat totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);\nif (length(cloudColor.rgb) == 0.0) {\ntotalTransmittance = 1.0;\n}\nreturn vec4(cloudColor.rgb, totalTransmittance);\n}"])))),t.code.add((0,o.H)(x||(x=(0,n.Z)(["vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)\n{\nreturn crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);\n}"]))))}function W(e,t){e.include(c.g,t),e.include(a),e.include(s.E),t.hasCloudsReflections&&e.include(Z,t),t.hasScreenSpaceReflections&&e.include(g,t);const i=e.fragment;i.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),i.code.add((0,o.H)(C||(C=(0,n.Z)(["PBRShadingWater shadingInfo;\nvec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {\nfloat exponent = pow((1.0 - cosTheta), fresnelSky[2]);\nreturn mix(zenit, horizon, exponent);\n}"])))),i.uniforms.add(new u.p("lightingSpecularStrength",((e,t)=>t.lighting.mainLight.specularStrength)),new u.p("lightingEnvironmentStrength",((e,t)=>t.lighting.mainLight.environmentStrength))),i.code.add((0,o.H)(T||(T=(0,n.Z)(["vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {\nfloat reflectionHit = 0.0;\nfloat reflectionHitDiffused = 0.0;\nvec3 seaWaterColor = linearizeGamma(color);\nvec3 h = normalize(l + v);\nshadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);\nshadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);\nshadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);\nshadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);\nshadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);\nshadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);\nfloat upDotV = max(dot(localUp,v), 0.0);\nvec3 skyHorizon = linearizeGamma(skyColor);\nvec3 skyZenit = linearizeGamma(skyZenitColor);\nvec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );\nfloat upDotL = max(dot(localUp,l),0.0);\nfloat daytimeMod = 0.1 + upDotL * 0.9;\nskyColor *= daytimeMod;\nfloat shadowModifier = clamp(shadow, 0.8, 1.0);\nvec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);\nvec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;\nvec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;\nvec3 specular = vec3(0.0);\nif(upDotV > 0.0 && upDotL > 0.0) {\nvec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);\nvec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;\nspecular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;\n}\nvec3 foam = vec3(0.0);\nif(upDotV > 0.0) {\nfoam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);\n}\nfloat correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);\nvec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);\nvec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));"])))),t.hasCloudsReflections&&i.code.add((0,o.H)(R||(R=(0,n.Z)(["vec4 cloudsColor = renderClouds(reflectedWorld, position);\ncloudsColor.a = 1.0 - cloudsColor.a;\ncloudsColor = pow(cloudsColor, vec4(GAMMA));\ncloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);"])))),t.hasScreenSpaceReflections?(i.uniforms.add(new p.g("view",((e,t)=>t.camera.viewMatrix)),new f.A("lastFrameColorTexture",((e,t)=>{var i;return null===(i=t.ssr.lastFrameColor)||void 0===i?void 0:i.colorTexture})),new u.p("fadeFactorSSR",((e,t)=>t.ssr.fadeFactor))),i.code.add((0,o.H)(O||(O=(0,n.Z)(["vec3 viewDir = normalize(viewPosition);\nvec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);\nvec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);\nvec4 viewUp = view * vec4(localUp, 0.0);\nvec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);\nvec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));\nvec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);\nvec3 reflectedColor = vec3(0.0);\nif (hitCoordinate.z > 0.0)\n{\nvec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);\nvec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));\nfloat heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);\nreflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;\nreflectionHitDiffused = waterDiffusion * reflectionHit;\nreflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *\nreflectionHitDiffused * fresnelModifier.y * ssrIntensity;\n}\nfloat seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);\nvec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +\nreflSea * seaColorMod + specular + foam);"]))))):i.code.add((0,o.H)(P||(P=(0,n.Z)(["vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);"])))),t.hasCloudsReflections?t.hasScreenSpaceReflections?i.code.add((0,o.H)(E||(E=(0,n.Z)(["return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;\n}"])))):i.code.add((0,o.H)(A||(A=(0,n.Z)(["return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;\n}"])))):i.code.add((0,o.H)(D||(D=(0,n.Z)(["return waterRenderedColor;\n}"]))))}},79246:(e,t,i)=>{i.d(t,{M:()=>f});var r,n=i(30168),s=i(88396),o=i(6394),a=i(90045),l=i(67077),c=i(7683),d=(i(58335),i(82999)),h=i(95276),u=i(98634),p=i(19253);function f(e){e.fragment.uniforms.add(new p.A("texWaveNormal",(e=>e.waveNormal)),new p.A("texWavePerturbation",(e=>e.wavePerturbation)),new h.N("waveParams",(e=>(0,a.s)(g,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset))),new d.A("waveDirection",(e=>(0,s.s)(_,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity)))),e.include(c.K),e.fragment.code.add((0,u.H)(r||(r=(0,n.Z)(["const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);\nvec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture(_tex, _uv).rg - 1.0;\n}\nfloat sampleNoiseTexture(vec2 _uv) {\nreturn texture(texWavePerturbation, _uv).b;\n}\nvec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {\nreturn 2.0 * texture(_tex, _uv).rgb - 1.0;\n}\nfloat computeProgress(vec2 uv, float time) {\nreturn fract(time);\n}\nfloat computeWeight(vec2 uv, float time) {\nfloat progress = computeProgress(uv, time);\nreturn 1.0 - abs(1.0 - 2.0 * progress);\n}\nvec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {\nfloat flowStrength = waveParams[2];\nfloat flowOffset = waveParams[3];\nvec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;\nfloat progress = computeProgress(uv, time + phaseOffset);\nfloat weight = computeWeight(uv, time + phaseOffset);\nvec2 result = uv;\nresult -= flowVector * (progress + flowOffset);\nresult += phaseOffset;\nresult += (time - progress) * FLOW_JUMP;\nreturn vec3(result, weight);\n}\nconst float TIME_NOISE_TEXTURE_REPEAT = 0.3737;\nconst float TIME_NOISE_STRENGTH = 7.77;\nvec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {\nfloat waveStrength = waveParams[0];\nvec2 waveMovement = time * -_waveDir;\nfloat timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;\nvec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);\nvec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);\nvec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;\nvec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;\nvec3 mixNormal = normalize(normal_A + normal_B);\nmixNormal.xy *= waveStrength;\nmixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));\nreturn mixNormal;\n}\nvec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {\nfloat waveTextureRepeat = waveParams[1];\nvec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);\nfloat foam  = normals2FoamIntensity(normal, waveParams[0]);\nreturn vec4(normal, foam);\n}"]))))}const g=(0,l.c)(),_=(0,o.a)()},86755:(e,t,i)=>{i.d(t,{V:()=>x});var r,n=i(27366),s=i(7138),o=i(32718),a=i(16889),l=i(17842),c=i(49861),d=(i(25243),i(63780),i(93169),i(69912)),h=i(14226),u=i(81949),p=i(88396),f=i(6394),g=i(11186),_=i(71353),v=i(90045),m=i(67077),y=i(95773),b=i(40885),w=i(40927),S=i(50951);let x=r=class extends s.Z{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this._center=(0,_.c)(),this._up=(0,_.c)(),this._viewUp=(0,_.c)(),this._viewForward=(0,_.c)(),this._viewRight=(0,_.c)(),this._ray=(0,b.Ue)(),this._viewport=(0,m.f)(0,0,1,1),this._padding=(0,m.f)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,f.f)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,u.a)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,u.a)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,u.a)(),this._frustumDirty=!0,this._frustum=(0,y.Ue)(),this._fullViewport=(0,m.c)(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return(0,g.f)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){(0,h.h)(this._viewMatrix,e),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=(0,v.b)((0,m.c)(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&(0,v.e)(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=(0,v.b)((0,m.c)(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&(0,v.e)(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[E.LEFT],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[E.BOTTOM],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[E.RIGHT]+this._padding[E.LEFT]}set fullWidth(e){this.width=e-(this._padding[E.RIGHT]+this._padding[E.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[E.TOP]+this._padding[E.BOTTOM]}set fullHeight(e){this.height=e-(this._padding[E.TOP]+this._padding[E.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[E.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[E.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){(0,v.h)(this._padding,e)||(this._viewport[0]+=e[E.LEFT]-this._padding[E.LEFT],this._viewport[1]+=e[E.BOTTOM]-this._padding[E.BOTTOM],this._viewport[2]-=e[E.RIGHT]+e[E.LEFT]-(this._padding[E.RIGHT]+this._padding[E.LEFT]),this._viewport[3]-=e[E.TOP]+e[E.BOTTOM]-(this._padding[E.TOP]+this._padding[E.BOTTOM]),(0,v.c)(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,h.m)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const e=this.width,t=this.height,i=this.near*Math.tan(this.fovY/2),r=i*this._aspect,n=(0,h.q)((0,u.a)(),-r*(1+2*this._padding[E.LEFT]/e),r*(1+2*this._padding[E.RIGHT]/e),-i*(1+2*this._padding[E.BOTTOM]/t),i*(1+2*this._padding[E.TOP]/t),this.near,this.far),s=this._get("projectionMatrix");return s&&(0,h.a)(s,n)?s:n}get inverseProjectionMatrix(){return(0,h.i)((0,u.a)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,u.a)()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(e,t,i){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}(this._fov,this.width,this.height)}set fovX(e){this._fov=function(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/t)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(e,t,i){return 2*Math.atan(i*Math.tan(.5*e)/Math.sqrt(t*t+i*i))}(this._fov,this.width,this.height)}set fovY(e){this._fov=function(e,t,i){return 2*Math.atan(Math.sqrt(t*t+i*i)*Math.tan(.5*e)/i)}(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,g.o)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,h.i)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,h.t)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const t=2*e-1;return 2*this.near*this.far/(this.far+this.near-t*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}copyFrom(e){(0,g.c)(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,(0,v.c)(this._viewport,e.viewport),this.notifyChange("_viewport"),(0,v.c)(this._padding,e.padding),this.notifyChange("_padding"),(0,p.j)(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||((0,h.h)(this._viewMatrix,e.viewMatrix),(0,g.c)(this._viewRight,e.viewRight),(0,g.c)(this._viewUp,e.viewUp),(0,g.c)(this._viewForward,e.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||((0,y.JG)(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,h.h)(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,v.c)(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up}clone(){return(new r).copyFrom(this)}equals(e){return(0,g.h)(this.eye,e.eye)&&(0,g.h)(this.center,e.center)&&(0,g.h)(this.up,e.up)&&(0,v.h)(this._viewport,e.viewport)&&(0,v.h)(this._padding,e.padding)&&(0,p.m)(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||(0,v.i)(e.screenPadding,this.screenPadding)>=t||(0,v.i)(this.screenViewport,e.screenViewport)>=t)return!1;(0,g.u)(R,e.eye,e.center),(0,g.u)(O,this.eye,this.center);const i=(0,g.j)(R,O),r=(0,g.F)(R),n=(0,g.F)(O),s=5e-4;return i*i>=(1-1e-10)*r*n&&(0,g.y)(e.eye,this.eye)<Math.max(r,n)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs((0,w.SR)(this.viewForward,(0,g.f)(R,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.s1)();return e[0]=(this.padding[E.LEFT]+this.width/2)/this.pixelRatio,e[1]=(this.padding[E.TOP]+this.height/2)/this.pixelRatio,e}getRenderCenter(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return e[0]=this.padding[E.LEFT]+this.width*t,e[1]=this.padding[E.BOTTOM]+this.height*i,e[2]=.5,e}setGLViewport(e){const t=this.viewport,i=this.padding;e.setViewport(t[0]-i[3],t[1]-i[2],t[2]+i[1]+i[3],t[3]+i[0]+i[2])}applyProjection(e,t){e!==C&&(0,g.c)(C,e),C[3]=1,(0,v.t)(C,C,this.projectionMatrix);const i=Math.abs(C[3]);(0,g.i)(C,C,1/i);const r=this.fullViewport;t[0]=(0,a.t7)(0,r[0]+r[2],.5+.5*C[0]),t[1]=(0,a.t7)(0,r[1]+r[3],.5+.5*C[1]),t[2]=.5*(C[2]+1),t[3]=i}unapplyProjection(e,t){const i=this.fullViewport;C[0]=(e[0]/(i[0]+i[2])*2-1)*e[3],C[1]=(e[1]/(i[1]+i[3])*2-1)*e[3],C[2]=(2*e[2]-1)*e[3],C[3]=e[3],null!=this.inverseProjectionMatrix&&((0,v.t)(C,C,this.inverseProjectionMatrix),t[0]=C[0],t[1]=C[1],t[2]=C[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,P),this.renderToScreen(P,t),t}projectToRenderScreen(e,t){if(C[0]=e[0],C[1]=e[1],C[2]=e[2],C[3]=1,(0,v.t)(C,C,this.viewProjectionMatrix),0===C[3])return null;(0,g.i)(C,C,1/Math.abs(C[3]));const i=this.fullViewport;return"x"in t?(t.x=(0,a.t7)(0,i[0]+i[2],.5+.5*C[0]),t.y=(0,a.t7)(0,i[1]+i[3],.5+.5*C[1])):(t[0]=(0,a.t7)(0,i[0]+i[2],.5+.5*C[0]),t[1]=(0,a.t7)(0,i[1]+i[3],.5+.5*C[1]),t.length>2&&(t[2]=.5*(C[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,P),t)}unprojectFromRenderScreen(e,t){if((0,h.m)(T,this.projectionMatrix,this.viewMatrix),!(0,h.i)(T,T))return null;const i=this.fullViewport;return C[0]=2*(e[0]-i[0])/i[2]-1,C[1]=2*(e[1]-i[1])/i[3]-1,C[2]=2*e[2]-1,C[3]=1,(0,v.t)(C,C,T),0===C[3]?null:(t[0]=C[0]/C[3],t[1]=C[1]/C[3],t[2]=C[2]/C[3],t)}constrainWindowSize(e,t,i,r){const n=e*this.pixelRatio,s=t*this.pixelRatio,o=Math.max(n-i/2,0),a=Math.max(this.fullHeight-s-r/2,0),l=-Math.min(n-i/2,0),c=-Math.min(this.fullHeight-s-r/2,0),d=i-l- -Math.min(this.fullWidth-n-i/2,0),h=r-c- -Math.min(s-r/2,0);return[Math.round(o),Math.round(a),Math.round(d),Math.round(h)]}computeUp(e){e===S.JY.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const i=e[0]*this.pixelRatio,r=this.fullHeight-e[1]*this.pixelRatio;return t[0]=i,t[1]=r,t}renderToScreen(e,t){const i=e[0]/this.pixelRatio,r=(this.fullHeight-e[1])/this.pixelRatio;t[0]=i,t[1]=r}_computeUpGlobal(){(0,g.f)(R,this.center,this.eye);const e=(0,g.l)(this.center);e<1?((0,g.s)(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,g.j)(R,this.center))>.9999*(0,g.l)(R)*e||((0,g.b)(this._up,R,this.center),(0,g.b)(this._up,this._up,R),(0,g.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){(0,g.C)(R,this.eye,this.center),Math.abs(R[2])<=.9999&&((0,g.i)(R,R,R[2]),(0,g.s)(this._up,-R[0],-R[1],1-R[2]),(0,g.n)(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?(0,g.h)(e,t)||((0,g.c)(t,e),this._markViewDirty(),i.length&&this.notifyChange(i)):o.Z.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,y.q_)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,h.u)(this._viewMatrix,this.eye,this.center,this.up),(0,g.s)(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),(0,g.s)(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),(0,g.s)(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,n._)([(0,c.Cb)()],x.prototype,"_center",void 0),(0,n._)([(0,c.Cb)()],x.prototype,"_up",void 0),(0,n._)([(0,c.Cb)()],x.prototype,"_viewport",void 0),(0,n._)([(0,c.Cb)()],x.prototype,"_padding",void 0),(0,n._)([(0,c.Cb)()],x.prototype,"_fov",void 0),(0,n._)([(0,c.Cb)()],x.prototype,"_nearFar",void 0),(0,n._)([(0,c.Cb)()],x.prototype,"_pixelRatio",void 0),(0,n._)([(0,c.Cb)()],x.prototype,"pixelRatio",null),(0,n._)([(0,c.Cb)()],x.prototype,"eye",null),(0,n._)([(0,c.Cb)()],x.prototype,"center",null),(0,n._)([(0,c.Cb)()],x.prototype,"up",null),(0,n._)([(0,c.Cb)({readOnly:!0})],x.prototype,"nearFar",null),(0,n._)([(0,c.Cb)()],x.prototype,"near",null),(0,n._)([(0,c.Cb)()],x.prototype,"far",null),(0,n._)([(0,c.Cb)()],x.prototype,"viewport",null),(0,n._)([(0,c.Cb)({readOnly:!0})],x.prototype,"screenViewport",null),(0,n._)([(0,c.Cb)({readOnly:!0})],x.prototype,"screenPadding",null),(0,n._)([(0,c.Cb)()],x.prototype,"x",null),(0,n._)([(0,c.Cb)()],x.prototype,"y",null),(0,n._)([(0,c.Cb)()],x.prototype,"width",null),(0,n._)([(0,c.Cb)()],x.prototype,"height",null),(0,n._)([(0,c.Cb)()],x.prototype,"fullWidth",null),(0,n._)([(0,c.Cb)()],x.prototype,"fullHeight",null),(0,n._)([(0,c.Cb)({readOnly:!0})],x.prototype,"_aspect",null),(0,n._)([(0,c.Cb)()],x.prototype,"padding",null),(0,n._)([(0,c.Cb)({readOnly:!0})],x.prototype,"projectionMatrix",null),(0,n._)([(0,c.Cb)({readOnly:!0})],x.prototype,"inverseProjectionMatrix",null),(0,n._)([(0,c.Cb)()],x.prototype,"fov",null),(0,n._)([(0,c.Cb)()],x.prototype,"fovX",null),(0,n._)([(0,c.Cb)()],x.prototype,"fovY",null),x=r=(0,n._)([(0,d.j)("esri.views.3d.webgl-engine.lib.Camera")],x);const C=(0,m.c)(),T=(0,u.a)(),R=(0,_.c)(),O=(0,_.c)(),P=(0,l.J$)();var E;!function(e){e[e.TOP=0]="TOP",e[e.RIGHT=1]="RIGHT",e[e.BOTTOM=2]="BOTTOM",e[e.LEFT=3]="LEFT"}(E||(E={}))},70619:(e,t,i)=>{i.d(t,{dV:()=>R,rh:()=>O,PI:()=>T});var r,n=i(11186),s=i(8229),o=(i(71353),i(86372)),a=i(38461),l=i(39406),c=(i(55652),i(40885),i(91526));!function(e){e.length=function(e,t){const i=e[t],r=e[t+1],n=e[t+2];return Math.sqrt(i*i+r*r+n*n)},e.normalize=function(e,t){const i=e[t],r=e[t+1],n=e[t+2],s=1/Math.sqrt(i*i+r*r+n*n);e[t]*=s,e[t+1]*=s,e[t+2]*=s},e.scale=function(e,t,i){e[t]*=i,e[t+1]*=i,e[t+2]*=i},e.add=function(e,t,i,r,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[s]=e[t]+i[r],n[s+1]=e[t+1]+i[r+1],n[s+2]=e[t+2]+i[r+2]},e.subtract=function(e,t,i,r,n){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;(n=n||e)[s]=e[t]-i[r],n[s+1]=e[t+1]-i[r+1],n[s+2]=e[t+2]-i[r+2]}}(r||(r={}));var d=i(79100),h=i(94695),u=i(97731),p=i(4760);const f=new Array(36);for(let P=0;P<6;P++)for(let e=0;e<6;e++)f[6*P+e]=P;const g=new Array(36);for(let P=0;P<6;P++)g[6*P]=0,g[6*P+1]=1,g[6*P+2]=2,g[6*P+3]=2,g[6*P+4]=3,g[6*P+5]=0;const _=(0,s.f)(-.5,0,-.5),v=(0,s.f)(.5,0,-.5),m=(0,s.f)(0,0,.5),y=(0,s.f)(0,.5,0),b=(0,s.c)(),w=(0,s.c)(),S=(0,s.c)(),x=(0,s.c)(),C=(0,s.c)();(0,n.f)(b,_,y),(0,n.f)(w,_,v),(0,n.b)(S,b,w),(0,n.n)(S,S),(0,n.f)(b,v,y),(0,n.f)(w,v,m),(0,n.b)(x,b,w),(0,n.n)(x,x),(0,n.f)(b,m,y),(0,n.f)(w,m,_),(0,n.b)(C,b,w),(0,n.n)(C,C);S[0],S[1],S[2],x[0],x[1],x[2],C[0],C[1],C[2];function T(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{uv:!0};const s=-Math.PI,o=2*Math.PI,d=-Math.PI/2,u=Math.PI,f=Math.max(3,Math.floor(i)),g=Math.max(2,Math.floor(r)),_=(f+1)*(g+1),v=(0,a.xx)(3*_),m=(0,a.xx)(3*_),y=(0,a.xx)(2*_),b=[];let w=0;for(let a=0;a<=g;a++){const e=[],i=a/g,r=d+i*u,n=Math.cos(r);for(let a=0;a<=f;a++){const l=a/f,c=s+l*o,d=Math.cos(c)*n,h=Math.sin(r),u=-Math.sin(c)*n;v[3*w]=d*t,v[3*w+1]=h*t,v[3*w+2]=u*t,m[3*w]=d,m[3*w+1]=h,m[3*w+2]=u,y[2*w]=l,y[2*w+1]=i,e.push(w),++w}b.push(e)}const S=new Array;for(let a=0;a<g;a++)for(let e=0;e<f;e++){const t=b[a][e],i=b[a][e+1],r=b[a+1][e+1],n=b[a+1][e];0===a?(S.push(t),S.push(r),S.push(n)):a===g-1?(S.push(t),S.push(i),S.push(r)):(S.push(t),S.push(i),S.push(r),S.push(r),S.push(n),S.push(t))}const x=[[p.T.POSITION,new c.a(v,S,3,!0)],[p.T.NORMAL,new c.a(m,S,3,!0)]];return n.uv&&x.push([p.T.UV0,new c.a(y,S,2,!0)]),n.offset&&(x[0][0]=p.T.OFFSET,x.push([p.T.POSITION,new c.a(Float64Array.from(n.offset),(0,l.LE)(S.length),3,!0)])),new h.Z(e,x)}function R(e,t,i,r,n,s,o,a){let u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;const f=i?[i[0],i[1],i[2]]:[0,0,0],g=t?[t[0],t[1],t[2]]:[0,0,1];o=o||[0,0];const _=r?[255*r[0],255*r[1],255*r[2],r.length>3?255*r[3]:255]:[255,255,255,255],v=null!=n&&2===n.length?n:[1,1],m=(0,l.LE)(1),y=[[p.T.POSITION,new c.a(f,m,3,!0)],[p.T.NORMAL,new c.a(g,m,3,!0)],[p.T.UV0,new c.a(o,m,o.length)],[p.T.COLOR,new c.a(_,m,4,!0)],[p.T.SIZE,new c.a(v,m,2)]];if(null!=s){const e=[s[0],s[1],s[2],s[3]];y.push([p.T.AUXPOS1,new c.a(e,m,4)])}if(null!=a){const e=[a[0],a[1],a[2],a[3]];y.push([p.T.FEATUREATTRIBUTE,new c.a(e,m,4)])}return new h.Z(e,y,null,d.U.Point,u)}function O(e,t,i,r){(0,u.hu)(t.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),(0,u.hu)(3===t[0].length,"createPolylineGeometry(): malformed vertex"),(0,u.hu)(null==i||i.length===t.length,"createPolylineGeometry: need same number of points and normals"),(0,u.hu)(null==i||3===i[0].length,"createPolylineGeometry(): malformed normal");const n=(0,o.bg)(3*t.length),s=new Array(2*(t.length-1));let f=0,g=0;for(let o=0;o<t.length;o++){for(let e=0;e<3;e++)n[f++]=t[o][e];o>0&&(s[g++]=o-1,s[g++]=o)}const _=[[p.T.POSITION,new c.a(n,s,3,!0)]];if(i){const e=(0,a.xx)(3*i.length);let r=0;for(let n=0;n<t.length;n++)for(let t=0;t<3;t++)e[r++]=i[n][t];_.push([p.T.NORMAL,new c.a(e,s,3,!0)])}return r&&_.push([p.T.COLOR,new c.a(r,(0,l.KF)(r.length/4),4)]),new h.Z(e,_,null,d.U.Line)}(0,s.c)()},88153:(e,t,i)=>{i.d(t,{LP:()=>w,Z8:()=>v});var r=i(14226),n=i(81949),s=i(11186),o=i(71353),a=i(90045),l=i(67077),c=i(40885),d=i(50951),h=i(54463),u=i(55848),p=i(22178),f=i(76783);const g=1e-5;class _{constructor(e){this.options=new h.om,this._results=new m,this.transform=new f.yn,this.tolerance=g,this.verticalOffset=null,this._ray=(0,c.Ue)(),this._rayEnd=(0,o.c)(),this._rayBeginTransformed=(0,o.c)(),this._rayEndTransformed=(0,o.c)(),this.viewingMode=null!==e&&void 0!==e?e:d.JY.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,i){this.resetWithRay((0,c.zk)(e,t,this._ray),i)}resetWithRay(e,t){this.camera=t,e!==this._ray&&(0,c.JG)(e,this._ray),0!==this.options.verticalOffset?this.viewingMode===d.JY.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,s.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;this.point=t,this.filterPredicate=r,this.tolerance=null!==i&&void 0!==i?i:g;const s=(0,f.W9)(this.verticalOffset);if(e&&e.length>0){const t=n?e=>{n(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const i of e){var o;const e=null===(o=i.getSpatialQueryAccelerator)||void 0===o?void 0:o.call(i);null!=e?(null!=s?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):i.objects.forAll((e=>t(e)))}}this.sortResults()}intersectObject(e){const t=e.geometries;if(!t)return;const i=e.effectiveTransformation,r=(0,f.W9)(this.verticalOffset);for(const o of t){if(!o.visible)continue;const{material:t,id:a}=o;this.transform.setAndInvalidateLazyTransforms(i,o.transformation),(0,s.e)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,s.e)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;null!=r&&(r.objectTransform=this.transform),t.intersect(o,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,((t,i,r,s,o,c)=>{if(t>=0){if(null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const d=s?this._results.hud:this._results,p=s?s=>{const l=new u.RA(e,a,r,c);s.set(h.q7.HUD,l,t,i,n.I,o)}:n=>n.set(h.q7.OBJECT,{object:e,geometryId:a,triangleNr:r},t,i,l,o);if((null==d.min.drapedLayerOrder||o>=d.min.drapedLayerOrder)&&(null==d.min.dist||t<d.min.dist)&&p(d.min),this.options.store!==h.eC.MIN&&(null==d.max.drapedLayerOrder||o<d.max.drapedLayerOrder)&&(null==d.max.dist||t>d.max.dist)&&p(d.max),this.options.store===h.eC.ALL)if(s){const e=new b(this._ray);p(e),this._results.hud.all.push(e)}else{const e=new y(this._ray);p(e),this._results.all.push(e)}}}))}}sortResults(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._results.all).sort(((e,t)=>{var i,r,n,s,o,a;return e.dist!==t.dist?(null!==(i=e.dist)&&void 0!==i?i:0)-(null!==(r=t.dist)&&void 0!==r?r:0):e.drapedLayerOrder!==t.drapedLayerOrder?(null!==(n=e.drapedLayerOrder)&&void 0!==n?n:Number.MAX_VALUE)-(null!==(s=t.drapedLayerOrder)&&void 0!==s?s:Number.MAX_VALUE):(null!==(o=t.drapedLayerGraphicOrder)&&void 0!==o?o:Number.MIN_VALUE)-(null!==(a=e.drapedLayerGraphicOrder)&&void 0!==a?a:Number.MIN_VALUE)}))}}function v(e){return new _(e)}class m{constructor(){this.min=new y((0,c.Ue)()),this.max=new y((0,c.Ue)()),this.hud={min:new b((0,c.Ue)()),max:new b((0,c.Ue)()),all:new Array},this.ground=new y((0,c.Ue)()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}class y{get ray(){return this._ray}get distanceInRenderSpace(){return null!=this.dist?((0,s.i)(S,this.ray.direction,this.dist),(0,s.l)(S)):null}getIntersectionPoint(e){return!!(0,p.nn)(this)&&((0,s.i)(S,this.ray.direction,this.dist),(0,s.g)(e,this.ray.origin,S),!0)}getTransformedNormal(e){return(0,s.c)(x,this.normal),x[3]=0,(0,a.t)(x,x,this.transformation),(0,s.c)(e,x),(0,s.n)(e,e)}constructor(e){this.intersector=h.q7.OBJECT,this.normal=(0,o.c)(),this.transformation=(0,n.a)(),this._ray=(0,c.Ue)(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=h.q7.OBJECT,(0,c.JG)(e,this._ray)}set(e,t,i,a,l,c,d){this.intersector=e,this.dist=i,(0,s.c)(this.normal,null!==a&&void 0!==a?a:o.d),(0,r.h)(this.transformation,null!==l&&void 0!==l?l:n.I),this.target=t,this.drapedLayerOrder=c,this.drapedLayerGraphicOrder=d}copy(e){(0,c.JG)(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,(0,s.c)(this.normal,e.normal),(0,r.h)(this.transformation,e.transformation)}}class b extends y{constructor(){super(...arguments),this.intersector=h.q7.HUD}}function w(e){return new y(e)}const S=(0,o.c)(),x=(0,l.c)()},54463:(e,t,i)=>{var r,n;i.d(t,{eC:()=>n,om:()=>s,q7:()=>r}),function(e){e[e.OBJECT=0]="OBJECT",e[e.HUD=1]="HUD",e[e.TERRAIN=2]="TERRAIN",e[e.OVERLAY=3]="OVERLAY",e[e.I3S=4]="I3S",e[e.PCL=5]="PCL",e[e.LOD=6]="LOD",e[e.VOXEL=7]="VOXEL"}(r||(r={}));class s{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=n.ALL}}!function(e){e[e.MIN=0]="MIN",e[e.MINMAX=1]="MINMAX",e[e.ALL=2]="ALL"}(n||(n={}))},55848:(e,t,i)=>{i.d(t,{Dx:()=>a,RA:()=>s});var r=i(71353);class n{constructor(e,t,i){this.object=e,this.geometryId=t,this.triangleNr=i}}class s extends n{constructor(e,t,i,n){super(e,t,i),this.center=null!=n?(0,r.g)(n):null}}class o{constructor(e){this.layerUid=e}}class a extends o{constructor(e,t){super(e),this.graphicUid=t}}},66327:(e,t,i)=>{i.d(t,{T:()=>_});var r=i(14226),n=i(81949),s=i(11186),o=i(71353),a=i(23470),l=i(80064),c=i(68401),d=i(1395),h=i(79100),u=i(47669),p=i(97731),f=i(4760),g=i(32683);class _ extends d.c{get geometries(){return this._geometries}get transformation(){var e;return null!==(e=this._transformation)&&void 0!==e?e:n.I}set transformation(e){var t;this._transformation=(0,r.h)(null!==(t=this._transformation)&&void 0!==t?t:(0,n.a)(),e),this._invalidateBoundingVolume(),this._emit("transformationChanged",this)}get shaderTransformation(){return this._shaderTransformation}set shaderTransformation(e){var t;this._shaderTransformation=e?(0,r.h)(null!==(t=this._shaderTransformation)&&void 0!==t?t:(0,n.a)(),e):null,this._invalidateBoundingVolume(),this._emit("shaderTransformationChanged",this)}get effectiveTransformation(){var e;return null!==(e=this.shaderTransformation)&&void 0!==e?e:this.transformation}constructor(){var e,t;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(),this.type=h.U.Object,this._shaderTransformation=null,this._parentLayer=null,this._visible=!0,this.castShadow=null===(e=i.castShadow)||void 0===e||e,this.usesVerticalDistanceToGround=null!==(t=i.usesVerticalDistanceToGround)&&void 0!==t&&t,this.graphicUid=i.graphicUid,this.layerUid=i.layerUid,i.isElevationSource&&(this.lastValidElevationBB=new v),this._geometries=i.geometries?Array.from(i.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){(0,p.hu)(null==this._parentLayer||null==e,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._emit("geometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const t=this._geometries.splice(e,1)[0];t&&(this._emit("geometryRemoved",{object:this,geometry:t}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttributeUpdated(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._emit("attributesChanged",{object:this,geometry:e,attribute:t,sync:i}),(0,f.j)(t)&&this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const e of this._geometries)e.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new u.O(c.V_.MaskOccludee);for(const t of this._geometries)t.occludees=(0,g.lr)(t.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const t of this._geometries)t.occludees=(0,g.U_)(t.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new u.O(c.V_.Highlight);for(const t of this._geometries)t.highlights=(0,g.lr)(t.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const t of this._geometries)t.highlights=(0,g.U_)(t.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,t){return(0,r.m)(t,this.transformation,e.transformation)}getCombinedShaderTransformation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.a)();return(0,r.m)(t,this.effectiveTransformation,e.transformation)}get boundingVolumeWorldSpace(){return this._bvWorldSpace||(this._bvWorldSpace=this._bvWorldSpace||new m,this._validateBoundingVolume(this._bvWorldSpace,C.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace||(this._bvObjectSpace=this._bvObjectSpace||new m,this._validateBoundingVolume(this._bvObjectSpace,C.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,t){const i=t===C.ObjectSpace;for(const r of this._geometries){const t=r.boundingInfo;t&&y(t,e,i?r.transformation:this.getCombinedShaderTransformation(r))}(0,s.p)(e.bounds,e.min,e.max,.5);for(const r of this._geometries){const t=r.boundingInfo;if(null==t)continue;const n=i?r.transformation:this.getCombinedShaderTransformation(r),o=(0,l.u1)(n);(0,s.e)(x,t.center,n);const a=(0,s.o)(x,e.bounds),c=t.radius*o;e.bounds[3]=Math.max(e.bounds[3],a+c)}}_invalidateBoundingVolume(){var e;const t=null===(e=this._bvWorldSpace)||void 0===e?void 0:e.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&t&&this._parentLayer.notifyObjectBBChanged(this,t)}_emit(e,t){this._parentLayer&&this._parentLayer.events.emit(e,t)}get test(){const e=this;return{hasGeometry:t=>e._geometries.includes(t),getGeometryIndex:t=>e._geometries.indexOf(t)}}}class v{constructor(){this.min=(0,o.f)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=(0,o.f)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}}class m extends v{constructor(){super(...arguments),this.bounds=(0,a.c)()}}function y(e,t,i){const n=e.bbMin,o=e.bbMax;if((0,r.y)(i)){const e=(0,s.s)(b,i[12],i[13],i[14]);(0,s.g)(w,n,e),(0,s.g)(S,o,e);for(let i=0;i<3;++i)t.min[i]=Math.min(t.min[i],w[i]),t.max[i]=Math.max(t.max[i],S[i])}else if((0,s.e)(w,n,i),(0,s.h)(n,o))for(let r=0;r<3;++r)t.min[r]=Math.min(t.min[r],w[r]),t.max[r]=Math.max(t.max[r],w[r]);else{(0,s.e)(S,o,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e],S[e]),t.max[e]=Math.max(t.max[e],w[e],S[e]);for(let e=0;e<3;++e){(0,s.c)(w,n),(0,s.c)(S,o),w[e]=o[e],S[e]=n[e],(0,s.e)(w,w,i),(0,s.e)(S,S,i);for(let e=0;e<3;++e)t.min[e]=Math.min(t.min[e],w[e],S[e]),t.max[e]=Math.max(t.max[e],w[e],S[e])}}}const b=(0,o.c)(),w=(0,o.c)(),S=(0,o.c)(),x=(0,o.c)();var C;!function(e){e[e.WorldSpace=0]="WorldSpace",e[e.ObjectSpace=1]="ObjectSpace"}(C||(C={}))},78485:(e,t,i)=>{var r;i.d(t,{j:()=>r}),function(e){e[e.ASYNC=0]="ASYNC",e[e.SYNC=1]="SYNC"}(r||(r={}))},80658:(e,t,i)=>{i.d(t,{U:()=>n});var r=i(45412);class n extends r.U{}},97882:(e,t,i)=>{i.d(t,{F:()=>u});var r=i(91505),n=i(100),s=i(92026),o=i(27546),a=i(1395),l=i(79100);const c=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","transformationChanged","shaderTransformationChanged","visibilityChanged","occlusionChanged","highlightChanged","geometryAdded","geometryRemoved","attributesChanged"];var d=i(78329),h=i(78485);class u extends a.c{get objects(){return this._objects}constructor(e,t){var i,s,a,d;let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";super(),this.stage=e,this.apiLayerUid=u,this.type=l.U.Layer,this.events=new r.Z,this.visible=!0,this.pickable=!0,this.sliceable=!1,this._objects=new o.Z,this._objectsAdded=new o.Z,this._handles=new n.Z,this.apiLayerUid=u,this.visible=null===(i=null===t||void 0===t?void 0:t.visible)||void 0===i||i,this.pickable=null===(s=null===t||void 0===t?void 0:t.pickable)||void 0===s||s,this.updatePolicy=null!==(a=null===t||void 0===t?void 0:t.updatePolicy)&&void 0!==a?a:h.j.ASYNC,this._disableOctree=null!==(d=null===t||void 0===t?void 0:t.disableOctree)&&void 0!==d&&d,e.add(this);for(const r of c)this._handles.add(this.events.on(r,(t=>e.handleEvent(r,t))))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),null!=this._octree&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const t of e)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),null!=this._octree&&this._objectsAdded.pushArray(e)}removeMany(e){const t=new Array;if(this._objects.removeUnorderedMany(e,e.length,t),0!==t.length){for(const e of t)e.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:t}),null!=this._octree){for(let e=0;e<t.length;)this._objectsAdded.removeUnordered(t[e])?(t[e]=t[t.length-1],t.length-=1):++e;this._octree.remove(t)}}}sync(){this.updatePolicy!==h.j.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.length>50&&!this._disableOctree?(this._octree=new d.Z((e=>e.boundingVolumeWorldSpace.bounds)),this._octree.add(this._objects.data,this._objects.length)):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}invalidateSpatialQueryAccelerator(){this._octree=(0,s.SC)(this._octree),this._objectsAdded.clear()}}},22178:(e,t,i)=>{i.d(t,{nn:()=>n});i(11186);var r=i(71353);i(82218),i(54463);function n(e){return null!=(null===e||void 0===e?void 0:e.dist)}(0,r.c)()},66832:(e,t,i)=>{i.d(t,{E:()=>E});var r=i(93169),n=i(67077),s=i(55158),o=i(37081),a=i(68401),l=i(23620),c=i(78041),d=i(93822),h=i(4760),u=i(12594),p=i(11983),f=i(65964),g=i(82144),_=i(31132),v=i(7566),m=i(27627),y=i(19087),b=i(25920),w=i(45028),S=i(36207);class x extends _.A{initializeProgram(e){return new m.$(e.rctx,x.shader.get().build(this.configuration),v.i)}_createPipeline(e,t){const i=this.configuration,r=e===b.A.NONE,n=e===b.A.FrontFace;return(0,S.sm)({blending:i.output!==o.H.Color&&i.output!==o.H.Alpha||!i.transparent?null:r?c.wu:(0,c.j7)(e),culling:(0,S.zp)(i.cullFace),depthTest:{func:(0,c.Bh)(e)},depthWrite:(r||n)&&i.writeDepth?S.LZ:null,colorWrite:S.BK,stencilWrite:i.hasOccludees?y.s3:null,stencilTest:i.hasOccludees?t?y.eD:y.RY:null,polygonOffset:r||n?i.polygonOffset?C:null:(0,c.je)(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}x.shader=new g.J(w.C,(()=>i.e(3173).then(i.bind(i,23173))));const C={factor:1,units:1};var T=i(27366),R=i(33559),O=i(8883);class P extends O.W{constructor(){super(...arguments),this.output=o.H.Color,this.cullFace=a.Vr.None,this.transparencyPassType=b.A.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}}(0,T._)([(0,R.o)({count:o.H.COUNT})],P.prototype,"output",void 0),(0,T._)([(0,R.o)({count:a.Vr.COUNT})],P.prototype,"cullFace",void 0),(0,T._)([(0,R.o)({count:b.A.COUNT})],P.prototype,"transparencyPassType",void 0),(0,T._)([(0,R.o)()],P.prototype,"hasSlicePlane",void 0),(0,T._)([(0,R.o)()],P.prototype,"hasVertexColors",void 0),(0,T._)([(0,R.o)()],P.prototype,"transparent",void 0),(0,T._)([(0,R.o)()],P.prototype,"polygonOffset",void 0),(0,T._)([(0,R.o)()],P.prototype,"enableOffset",void 0),(0,T._)([(0,R.o)()],P.prototype,"writeDepth",void 0),(0,T._)([(0,R.o)()],P.prototype,"hasOccludees",void 0),(0,T._)([(0,R.o)()],P.prototype,"multipassEnabled",void 0),(0,T._)([(0,R.o)()],P.prototype,"cullAboveGround",void 0),(0,T._)([(0,R.o)()],P.prototype,"objectAndLayerIdColorInstanced",void 0),(0,T._)([(0,R.o)()],P.prototype,"vvColor",void 0),(0,T._)([(0,R.o)({constValue:!1})],P.prototype,"occlusionPass",void 0),(0,T._)([(0,R.o)({constValue:!0})],P.prototype,"hasVvInstancing",void 0),(0,T._)([(0,R.o)({constValue:!1})],P.prototype,"vvSize",void 0),(0,T._)([(0,R.o)({constValue:!1})],P.prototype,"vvOpacity",void 0);class E extends p.c{constructor(e){super(e,new D),this.supportsEdges=!0,this._configuration=new P}getConfiguration(e,t){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=t.transparencyPassType,this._configuration.enableOffset=t.camera.relativeElevation<c.ve,this._configuration.multipassEnabled=t.multipassEnabled,this._configuration.cullAboveGround=t.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}produces(e,t){return!!(t===o.H.Color||t===o.H.Alpha||t===o.H.Highlight||t===o.H.Depth&&this.parameters.writeLinearDepth||t===o.H.ObjectAndLayerIdColor)&&(e===d.r.DRAPED_MATERIAL||(t===o.H.Highlight?e===d.r.OPAQUE_MATERIAL:e===(this._isTransparent?this.parameters.writeDepth?d.r.TRANSPARENT_MATERIAL:d.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:d.r.OPAQUE_MATERIAL)))}createGLMaterial(e){return new A(e)}createBufferWriter(){const e=(0,s.U$)().vec3f(h.T.POSITION);return(0,r.Z)("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(h.T.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(h.T.COLORFEATUREATTRIBUTE):e.vec4u8(h.T.COLOR),new u.G(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class A extends l.Z{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==o.H.Color&&this._output!==o.H.Alpha||this._updateOccludeeState(e),this.ensureTechnique(x,e)}}class D extends f.n{constructor(){super(...arguments),this.color=n.Z,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=a.Vr.None,this.hasOccludees=!1}}},11983:(e,t,i)=>{i.d(t,{c:()=>s});var r=i(56529),n=i(22909);class s extends r.F5{intersect(e,t,i,r,s,o){return(0,n.Bw)(e,i,r,s,void 0,o)}}},33720:(e,t,i)=>{i.d(t,{I9:()=>r,i5:()=>n});var r,n,s=i(27366),o=i(37081),a=i(33559),l=i(25920),c=i(8883);!function(e){e[e.Draped=0]="Draped",e[e.Screen=1]="Screen",e[e.World=2]="World",e[e.COUNT=3]="COUNT"}(r||(r={})),function(e){e[e.Center=0]="Center",e[e.Tip=1]="Tip",e[e.COUNT=2]="COUNT"}(n||(n={}));class d extends c.W{constructor(){super(...arguments),this.output=o.H.Color,this.transparencyPassType=l.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=r.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=n.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1}get draped(){return this.space===r.Draped}}(0,s._)([(0,a.o)({count:o.H.COUNT})],d.prototype,"output",void 0),(0,s._)([(0,a.o)({count:l.A.COUNT})],d.prototype,"transparencyPassType",void 0),(0,s._)([(0,a.o)()],d.prototype,"occluder",void 0),(0,s._)([(0,a.o)()],d.prototype,"hasSlicePlane",void 0),(0,s._)([(0,a.o)()],d.prototype,"writeDepth",void 0),(0,s._)([(0,a.o)({count:r.COUNT})],d.prototype,"space",void 0),(0,s._)([(0,a.o)()],d.prototype,"hideOnShortSegments",void 0),(0,s._)([(0,a.o)()],d.prototype,"hasCap",void 0),(0,s._)([(0,a.o)({count:n.COUNT})],d.prototype,"anchor",void 0),(0,s._)([(0,a.o)()],d.prototype,"hasTip",void 0),(0,s._)([(0,a.o)()],d.prototype,"vvSize",void 0),(0,s._)([(0,a.o)()],d.prototype,"vvColor",void 0),(0,s._)([(0,a.o)()],d.prototype,"vvOpacity",void 0),(0,s._)([(0,a.o)()],d.prototype,"hasOccludees",void 0),(0,s._)([(0,a.o)()],d.prototype,"multipassEnabled",void 0),(0,s._)([(0,a.o)()],d.prototype,"cullAboveGround",void 0),(0,s._)([(0,a.o)({constValue:!1})],d.prototype,"occlusionPass",void 0),(0,s._)([(0,a.o)({constValue:!0})],d.prototype,"hasVvInstancing",void 0),(0,s._)([(0,a.o)({constValue:!0})],d.prototype,"hasSliceTranslatedView",void 0)},737:(e,t,i)=>{i.d(t,{G:()=>c,R:()=>r});var r,n=i(27366),s=i(37081),o=i(33559),a=i(25920),l=i(8883);!function(e){e[e.BUTT=0]="BUTT",e[e.SQUARE=1]="SQUARE",e[e.ROUND=2]="ROUND",e[e.COUNT=3]="COUNT"}(r||(r={}));class c extends l.W{constructor(){super(...arguments),this.output=s.H.Color,this.capType=r.BUTT,this.transparencyPassType=a.A.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.multipassEnabled=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}}(0,n._)([(0,o.o)({count:s.H.COUNT})],c.prototype,"output",void 0),(0,n._)([(0,o.o)({count:r.COUNT})],c.prototype,"capType",void 0),(0,n._)([(0,o.o)({count:a.A.COUNT})],c.prototype,"transparencyPassType",void 0),(0,n._)([(0,o.o)()],c.prototype,"occluder",void 0),(0,n._)([(0,o.o)()],c.prototype,"hasSlicePlane",void 0),(0,n._)([(0,o.o)()],c.prototype,"hasPolygonOffset",void 0),(0,n._)([(0,o.o)()],c.prototype,"writeDepth",void 0),(0,n._)([(0,o.o)()],c.prototype,"draped",void 0),(0,n._)([(0,o.o)()],c.prototype,"stippleEnabled",void 0),(0,n._)([(0,o.o)()],c.prototype,"stippleOffColorEnabled",void 0),(0,n._)([(0,o.o)()],c.prototype,"stipplePreferContinuous",void 0),(0,n._)([(0,o.o)()],c.prototype,"roundJoins",void 0),(0,n._)([(0,o.o)()],c.prototype,"applyMarkerOffset",void 0),(0,n._)([(0,o.o)()],c.prototype,"vvSize",void 0),(0,n._)([(0,o.o)()],c.prototype,"vvColor",void 0),(0,n._)([(0,o.o)()],c.prototype,"vvOpacity",void 0),(0,n._)([(0,o.o)()],c.prototype,"falloffEnabled",void 0),(0,n._)([(0,o.o)()],c.prototype,"innerColorEnabled",void 0),(0,n._)([(0,o.o)()],c.prototype,"hasOccludees",void 0),(0,n._)([(0,o.o)()],c.prototype,"multipassEnabled",void 0),(0,n._)([(0,o.o)()],c.prototype,"cullAboveGround",void 0),(0,n._)([(0,o.o)()],c.prototype,"wireframe",void 0),(0,n._)([(0,o.o)()],c.prototype,"objectAndLayerIdColorInstanced",void 0),(0,n._)([(0,o.o)({constValue:!1})],c.prototype,"occlusionPass",void 0),(0,n._)([(0,o.o)({constValue:!0})],c.prototype,"hasVvInstancing",void 0),(0,n._)([(0,o.o)({constValue:!0})],c.prototype,"hasSliceTranslatedView",void 0)},86509:(e,t,i)=>{i.d(t,{f:()=>l});var r=i(27366),n=i(94172),s=i(49861),o=(i(25243),i(63780),i(93169),i(69912)),a=i(45900);let l=class extends a.m{constructor(e){super(e)}initialize(){this.addHandles((0,n.YP)((()=>this.analysisViewData.visible),(e=>this.visible=e),n.tX))}deactivate(){this.onDeactivate(),this.created||this.analysis.clear()}resetCreated(){this._set("created",!1)}};(0,r._)([(0,s.Cb)({constructOnly:!0})],l.prototype,"analysis",void 0),(0,r._)([(0,s.Cb)()],l.prototype,"analysisViewData",void 0),l=(0,r._)([(0,o.j)("esri.views.interactive.AnalysisToolBase")],l)},44179:(e,t,i)=>{i.d(t,{Hk:()=>g,M8:()=>F,aU:()=>L,jg:()=>M,kt:()=>b,ku:()=>v});var r=i(63780),n=i(88396),s=i(6394),o=i(11186),a=i(71353),l=i(55652),c=i(40885),d=i(23470),h=i(38054),u=i(55793),p=i(94163);class f{intersect(e){return j(this,e)}closestPoints(e){return[this.closestTo(e)]}}class g extends f{constructor(e){super(),this.point=e}equals(e){return this===e||J(e)&&(0,o.h)(this.point,e.point)}closestTo(){return(0,h.d9)(this.point)}}class _ extends f{constructor(e,t,i){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:i}}equals(e){return this===e||X(e)&&this.lineLike.type===e.lineLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){const t=(0,u.ZE)(e,this.lineLike);return(0,h.uo)(t)}}class v extends _{constructor(e,t){super(e,t,p.SP.LINE)}}class m extends _{constructor(e,t){super(e,t,p.SP.RAY)}}class y extends f{constructor(e){super(),this.constraints=e}equals(e){return this===e||Y(e)&&(0,r.fS)(this.constraints,e.constraints,((e,t)=>e.equals(t)))}closestTo(e){let t,i=1/0;for(const r of this.constraints){const n=r.closestTo(e),s=(0,o.a)(e,n);s<i&&(i=s,t=n)}return t?(0,h.d9)(t):e}closestPoints(e){return this.constraints.flatMap((t=>t===this?[]:t.closestPoints(e)))}}class b extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||$(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=(0,u.sc)(e,this.center,this.radius);return(0,h.uo)(t)}}class w extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ee(e)&&(0,o.h)(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=(0,u.sc)(e,this.center,this.radius);return t[2]=this.center[2],(0,h.uo)(t)}asCircle(){return new S((0,h.d9)(this.center),this.radius,(0,h.al)(0,0,1))}}class S extends f{constructor(e,t,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0;super(),this.center=e,this.radius=t,this.normal=i,this.slicePlane=r}equals(e){return this===e||te(e)&&(0,o.h)(this.center,e.center)&&(0,o.h)(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:i}=this;(0,l.nF)(this.getPlane(C),e,x);const r=(0,o.u)(x,x,t),n=(0,o.m)(r);if((0,u.hA)(n,0))return(0,h.d9)(e);const s=i/Math.sqrt(n),c=(0,o.q)((0,a.c)(),t,r,s),{slicePlane:d}=this;if(d&&!(0,u.zf)(d,c)){var p;const t=H(d,this);return null!==(p=null===t||void 0===t?void 0:t.closestTo(e))&&void 0!==p?p:(0,h.d9)(e)}return(0,h.uo)(c)}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();return(0,l.Yq)(this.center,this.normal,e)}}const x=(0,a.c)(),C=(0,l.Ue)();class T extends f{constructor(e){super(),this.z=e}equals(e){return this===e||Q(e)&&this.z===e.z}closestTo(e){return(0,h.uo)((0,a.f)(e[0],e[1],this.z))}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();return(0,o.s)(R,0,0,this.z),(0,l.Yq)(R,a.d,e)}}const R=(0,a.c)();class O extends f{constructor(e,t,i){super(),this.start=e,this.end=t,this.planeLike={start:e,end:t,type:i}}equals(e){return this===e||K(e)&&this.planeLike.type===e.planeLike.type&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)}closestTo(e){return(0,h.uo)((0,u.z9)(e,this.planeLike))}closestEndTo(e){const{start:t,end:i}=this;return Math.sign((0,n.g)((0,n.c)(P,i,t),(0,n.c)(E,e,t)))>0?i:t}getPlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();const t=(0,o.c)(A,this.end);return t[2]+=1,(0,l.zk)(this.start,this.end,t,e)}getSlicePlane(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.Ue)();const{start:t,end:i,type:r}=this.planeLike;if(r===u.Jk.PLANE)return;const n=(0,o.s)(A,t[0],t[1],0),s=(0,o.s)(D,i[0],i[1],0),a=(0,o.f)(D,s,n);return(0,l.Yq)(n,a,e),e}}const P=(0,s.a)(),E=(0,s.a)(),A=(0,a.c)(),D=(0,a.c)();class L extends O{constructor(e,t){super(e,t,u.Jk.HALF_PLANE)}}class M extends O{constructor(e,t){super(e,t,u.Jk.PLANE)}}class I extends f{constructor(e,t){super(),this.sphere=(0,d.k)(e,t)}equals(e){return this===e||ie(e)&&(0,d.l)(this.sphere,e.sphere)}closestTo(e){const t=(0,d.p)(this.sphere,e,(0,a.c)());return(0,h.uo)(t)}get center(){return this.sphere}get radius(){return this.sphere[3]}}class F extends f{constructor(e,t,i){super(),this.start=e,this.end=t,this.getZ=i,this.planeLike={start:e,end:t,type:u.Jk.PLANE}}equals(e){return this===e||re(e)&&(0,o.h)(this.start,e.start)&&(0,o.h)(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){var i;const r=(0,u.z9)(t,e.planeLike);return r[2]=null!==(i=e.getZ(r[0],r[1]))&&void 0!==i?i:ne,(0,h.uo)(r)}(this,e)}addIfOnTheGround(e,t){for(const r of t){var i;const t=null!==(i=this.getZ(r[0],r[1]))&&void 0!==i?i:0;(0,u.hA)(r[2],t)&&(r[2]=t,e.push(r))}}}function j(e,t){if(Y(e)){const i=[];for(const r of e.constraints){const e=r.intersect(t);e&&i.push(e)}return q(i)}if(Y(t))return j(t,e);if(re(e))return Z(e,t);if(re(t))return Z(t,e);if(J(e)){const{point:i}=e,r=t.closestTo(i);return(0,o.G)(r,i)?e:void 0}if(X(e)){if(J(t))return j(t,e);if(X(t))return B((0,u.Au)(e.lineLike,t.lineLike));if(Q(t))return V(e,t);if(K(t))return B((0,u.fK)(t.planeLike,e.lineLike));if($(t))return B((0,u.CJ)(e.lineLike,t.center,t.radius));if(te(t))return B((0,u.UG)(e.lineLike,t));if(ee(t))return function(e,t){let{lineLike:i}=e,{center:r,radius:n}=t;const s=r[2];return B((0,u.CJ)(i,r,n).filter((e=>(0,u.hA)(e[2],s))))}(e,t);if(ie(t))return function(e,t){let{lineLike:i}=e,{sphere:r}=t;return B((0,d.m)(r,i.start,i.end))}(e,t)}else if(Q(e)){if(J(t)||X(t))return j(t,e);if(Q(t))return function(e,t){return(0,u.hA)(e.z,t.z)?e:void 0}(e,t);if(K(t))return function(e,t){let{z:i}=e,{planeLike:r}=t;const[n,s]=r.start,[o,a]=r.end,l=(0,h.al)(n,s,i),c=(0,h.al)(o,a,i);return r.type===u.Jk.PLANE?new v(l,c):new m(l,c)}(e,t);if($(t))return function(e,t){const[i,r]=t.center;return new w((0,h.al)(i,r,e.z),t.radius)}(e,t);if(te(t))return N(e,t);if(ee(t))return function(e,t){return(0,u.hA)(t.center[2],e.z)?t:void 0}(e,t);if(ie(t))return function(e,t){let{center:i,radius:r}=t;const n=Math.abs(i[2]-e.z);if(n>r&&!(0,u.hA)(n,r))return;const s=(0,h.al)(i[0],i[1],e.z),o=Math.sqrt(r**2-n**2);return(0,u.hA)(o,0)?void 0:new w(s,o)}(e,t)}else if(K(e)){if(J(t)||X(t)||Q(t))return j(t,e);if(K(t))return W((0,u.Nn)(e.planeLike,t.planeLike));if($(t))return W((0,u.SD)(e.planeLike,t.center,t.radius));if(te(t))return U(e,t);if(ee(t))return z(e,t);if(ie(t))return G(e,t)}else if($(e)){if(J(t)||X(t)||Q(t)||K(t))return j(t,e);if($(t))return W((0,u.Yf)(e.center,e.radius,t.center,t.radius));if(te(t))return;if(ee(t))return function(e,t){const i=(0,n.k)(e.center,t.center);return(0,u.hA)(i,0)&&(0,u.hA)(e.radius,t.radius)?t:k((0,u.Yf)(e.center,e.radius,t.center,t.radius),t.center[2])}(e,t);if(ie(t))return}else if(te(e)){if(J(t)||X(t)||Q(t)||K(t)||$(t))return j(t,e);if(te(t))return;if(ee(t))return void t.asCircle();if(ie(t))return}else if(ee(e)){if(J(t)||X(t)||Q(t)||K(t)||$(t)||te(t))return j(t,e);if(ee(t))return function(e,t){if(!(0,u.$7)(e.center,t.center))return;const i=(0,n.k)(e.center,t.center);return(0,u.hA)(i,0)&&(0,u.hA)(e.radius,t.radius)?e:k((0,u.Yf)(e.center,e.radius,t.center,t.radius),e.center[2])}(t,e);if(ie(t))return}else if(ie(e)){if(J(t)||X(t)||Q(t)||K(t)||$(t)||ee(t))return j(t,e);if(ie(t))return}}const V=(()=>{const e=(0,l.Ue)();return(t,i)=>{const{start:r,end:n}=t;if((0,u.$7)(r,n)&&(0,u.hA)(r[2],i.z))return t;const s=(0,a.c)();return(0,l.fn)(i.getPlane(e),r,n,s)?new g((0,h.uo)(s)):void 0}})();const H=(()=>{const e=(0,c.Ue)(),t=(0,l.Ue)(),i={start:(0,a.c)(),end:(0,a.c)(),type:p.SP.LINE};return(r,n,s)=>{const{normal:c,center:d,radius:p}=n,f=(0,o.j)(c,(0,l.mJ)(r)),_=(0,u.hA)((0,l.TE)(r,d),0);if((0,u.hA)(f,1))return _?n:void 0;if(n.getPlane(t),_&&(0,u.hA)(f,0)&&(0,l.cp)(r)&&(0,l.cp)(t)){if((0,u.hA)(p,0))return!s||(0,u.zf)(s,d)?new g((0,h.d9)(d)):void 0;const e=(0,a.g)(d);e[2]+=p;const t=(0,a.g)(d);t[2]-=p;const i=[];return s&&!(0,u.zf)(s,e)||i.push(e),s&&!(0,u.zf)(s,t)||i.push(t),B(i)}if(!(0,l.wm)(r,t,e))return;(0,o.c)(i.start,e.origin),(0,o.g)(i.end,e.origin,e.direction);const v=(0,u.UG)(i,n);return B(s?(0,u.rq)(s,v):v)}})();const N=(()=>{const e=(0,l.Ue)();return(t,i)=>H(t.getPlane(e),i)})();const z=(()=>{const e=(0,l.Ue)();return(t,i)=>{let{center:r,radius:n}=i;const s=(0,u.SD)(t.planeLike,r,n),o=r[2];t.getSlicePlane(e);const a=[];for(const[l,c]of s){const t=[l,c,o];(0,u.zf)(e,t)&&a.push(t)}return B(a)}})(),U=(()=>{const e=(0,l.Ue)(),t=(0,l.Ue)();return(i,r)=>H(i.getPlane(e),r,i.getSlicePlane(t))})(),G=(()=>{const e=(0,l.Ue)();return(t,i)=>{let{center:r,radius:n}=i;const s=t.getPlane(e),c=(0,l.jH)(s,r),d=Math.abs(c);if(d>n&&!(0,u.hA)(d,n))return;const p=(0,a.g)((0,l.mJ)(s)),f=(0,o.q)((0,a.c)(),r,p,c),_=Math.sqrt(n**2-c**2);return(0,u.hA)(_,0)?new g((0,h.uo)((0,l.nF)(s,r,(0,a.c)()))):new S((0,h.uo)(f),_,p,t.getSlicePlane())}})();function Z(e,t){const{planeLike:i,getZ:r}=e,n=[];if(J(t))e.addIfOnTheGround(n,(0,u.hm)(i,t.point));else if(X(t))e.addIfOnTheGround(n,(0,u.fK)(i,t.lineLike));else if($(t))for(const[o,l]of(0,u.SD)(i,t.center,t.radius)){const e=r(o,l);null!=e&&n.push((0,a.f)(o,l,e))}else if(K(t)||re(t))for(const[o,l]of(0,u.Nn)(i,t.planeLike)){var s;const e=null!==(s=r(o,l))&&void 0!==s?s:ne;n.push((0,a.f)(o,l,e))}return B(n)}function W(e){return q(e.map((e=>{let[t,i]=e;const r=(0,h.al)(t,i,0),n=(0,h.al)(t,i,1);return new v(r,n)})))}function B(e){return q(e.map((e=>e?new g((0,h.uo)(e)):void 0)))}function k(e,t){return B(e.map((e=>{let[i,r]=e;return[i,r,t]})))}function q(e){var t;if(0!==e.length)return 1===e.length?null!==(t=e[0])&&void 0!==t?t:void 0:new y(e.filter(r.pC))}function Y(e){return e instanceof y}function J(e){return e instanceof g}function X(e){return e instanceof _}function Q(e){return e instanceof T}function K(e){return e instanceof O}function $(e){return e instanceof b}function ee(e){return e instanceof w}function te(e){return e instanceof S}function ie(e){return e instanceof I}function re(e){return e instanceof F}const ne=0},92839:(e,t,i)=>{i.d(t,{u:()=>Ce});var r=i(42537),n=i(70758),s=i(40281),o=i(94172),a=i(27366),l=i(7138),c=i(49861),d=(i(25243),i(63780),i(93169),i(69912));let h=class extends l.Z{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};(0,a._)([(0,c.Cb)({constructOnly:!0})],h.prototype,"layer",void 0),(0,a._)([(0,c.Cb)()],h.prototype,"enabled",void 0),(0,a._)([(0,c.Cb)()],h.prototype,"updating",void 0),(0,a._)([(0,c.Cb)()],h.prototype,"availability",void 0),h=(0,a._)([(0,d.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],h);const u=h;var p=i(76014);let f=class extends l.Z{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new s.Z,this.distance=p.c.distance,this.touchSensitivityMultiplier=p.c.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};(0,a._)([(0,c.Cb)()],f.prototype,"enabled",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"enabledToggled",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"selfEnabled",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"featureEnabled",void 0),(0,a._)([(0,c.Cb)({type:s.Z.ofType(u)})],f.prototype,"featureSources",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"distance",void 0),(0,a._)([(0,c.Cb)()],f.prototype,"touchSensitivityMultiplier",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],f.prototype,"effectiveEnabled",null),(0,a._)([(0,c.Cb)({readOnly:!0})],f.prototype,"effectiveSelfEnabled",null),(0,a._)([(0,c.Cb)({readOnly:!0})],f.prototype,"effectiveFeatureEnabled",null),f=(0,a._)([(0,d.j)("esri.views.interactive.snapping.SnappingOptions")],f);const g=f;var _=i(66978),v=i(68860),m=i(88396),y=i(11186),b=i(71353),w=i(26277),S=i(46634),x=i(74509),C=i(44179),T=i(38054),R=i(32718),O=i(76672),P=i(18661),E=i(87072),A=i(37933),D=i(64674);let L=class extends l.Z{get layerView(){var e;return null===(e=this.view)||void 0===e||null===(e=e.allLayerViews)||void 0===e?void 0:e.find((e=>e.layer===this.layer))}get valid(){return this._valid}get subtypeFilter(){var e,t,i;const{layer:r}=this;if(!(0,A.e9)(r)||null===(e=r.subtypes)||void 0===e||!e.length)return{mode:"not-in-use",filter:null};const n=null!==(t=null===(i=r.fieldsIndex.get(r.subtypeField))||void 0===i?void 0:i.name)&&void 0!==t?t:r.subtypeField,s=r.sublayers.filter((e=>e.visible)).map((e=>e.subtypeCode));return s.length?s.length===r.subtypes.length?{mode:"all-visible",filter:null}:1===s.length?{mode:"in-use",filter:"".concat(n," = ").concat(s.getItemAt(0))}:{mode:"in-use",filter:"".concat(n," IN (").concat(s.join(", "),")")}:{mode:"none-visible",filter:null}}get floorFilter(){const{view:e,layer:t}=this;return e&&t?(0,E.c)({view:e,layer:t}):null}constructor(e){super(e),this.rulesTable=null,this._valid=!1}initialize(){if(!this.snappingSource||!this.layer)return;const{layer:e,snappingSource:t}=this;if("refresh"in e){const i=e;this.addHandles(i.on("refresh",(()=>t.refresh())))}this.loadRules(),this.addHandles([(0,o.YP)((()=>t.updating),(e=>t.layerSource.updating=e),o.tX),(0,o.YP)((()=>t.availability),(e=>t.layerSource.availability=e),o.tX)])}getFetchCandidatesParameters(e,t,i){var r,n;if(!this.valid)return[];const{layer:s,layerView:o,floorFilter:a,rulesTable:l,subtypeFilter:c}=this,d={distance:i,mode:null!==(r=null===(n=this.view)||void 0===n?void 0:n.type)&&void 0!==r?r:"2d",point:e,coordinateHelper:t.coordinateHelper,...this._types,filter:o&&"filter"in o?o.filter:null};if(a&&(d.filter=M(d.filter,a)),"not-in-use"!==c.mode&&"all-visible"!==c.mode){if("none-visible"===c.mode)return[];d.filter?d.filter.where=(0,O._)(d.filter.where,c.mode):d.filter=new P.Z({where:c.filter})}if(l){var h;const e=t.feature,i=null===e||void 0===e?void 0:e.sourceLayer;if(!(e&&(0,A.Te)(s)&&s.layerId&&(0,A.Te)(i)&&"loaded"===l.loadStatus))return[];const r=[],n=s.layerId,o=null===(h=l.getFeatureSQL(i,e))||void 0===h?void 0:h[n];if(!o)return[];const a=o.anyVertex;let c=o.endVertex;return c&&a&&c===a&&(c=""),c&&r.push({...d,returnEdge:!1,vertexMode:"ends",filter:M(d.filter,c)}),a&&r.push({...d,returnEdge:!1,vertexMode:"all",filter:M(d.filter,a)}),r}return[d]}async loadRules(){const{layer:e,view:t}=this;if(e&&t&&(0,D.n0)(null===t||void 0===t?void 0:t.map)&&(0,A.Te)(e)){var i;const n=null===(i=t.map.utilityNetworks)||void 0===i?void 0:i.find((t=>t.isUtilityLayer(e)));if(n)try{var r;this.rulesTable=await n.getRulesTable(),await(null===(r=this.rulesTable)||void 0===r?void 0:r.load()),this._valid=!0}catch(fe){return void R.Z.getLogger("esri.views.interactive.snapping.FeatureSnappingSourceInfo").error("Failed to load rules table for snapping source",e.title)}}else this._valid=!0}get _types(){return{returnEdge:!0,vertexMode:"all"}}remove(){this.destroy()}destroy(){var e;null===(e=this.snappingSource)||void 0===e||e.destroy()}};function M(e,t){return null==e?new P.Z({where:t}):e.where?new P.Z({where:(0,O._)(e.where,t)}):new P.Z({where:t})}(0,a._)([(0,c.Cb)({constructOnly:!0})],L.prototype,"layer",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],L.prototype,"snappingSource",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],L.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],L.prototype,"layerView",null),(0,a._)([(0,c.Cb)()],L.prototype,"rulesTable",void 0),(0,a._)([(0,c.Cb)()],L.prototype,"valid",null),(0,a._)([(0,c.Cb)()],L.prototype,"subtypeFilter",null),(0,a._)([(0,c.Cb)()],L.prototype,"floorFilter",null),(0,a._)([(0,c.Cb)()],L.prototype,"_valid",void 0),L=(0,a._)([(0,d.j)("esri.views.interactive.snapping.FeatureSnappingSourceInfo")],L);var I,F=i(80371),j=i(97760),V=i(95905),H=i(75691),N=i(92605),z=i(53397),U=i(41216);class G extends N.j{constructor(e){let{targetPoint:t,constraint:i,previousVertex:r,otherVertex:n,otherVertexType:s,objectId:o,isDraped:a}=e;super(t,i,a,F.B.SELF),this.previousVertex=r,this.otherVertex=n,this.otherVertexType=s,this.objectId=o}get hints(){const e=this.previousVertex,t=this.otherVertexType===I.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===I.CENTER?this.targetPoint:this.otherVertex;return[new z.w(D.ze.TARGET,t,i,this.isDraped,this.domain),new z.w(D.ze.REFERENCE,e,t,this.isDraped,this.domain),new U.y(this.previousVertex,t,i,this.isDraped,this.domain)]}}!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(I||(I={}));var Z=i(11208);let W=class extends l.Z{get updating(){return this._snappingSources.some((e=>null==e||e.valid&&e.snappingSource.updating))||this._updatingHandles.updating}constructor(e){super(e),this.options=null,this._domain=F.B.FEATURE,this._updatingHandles=new S.R,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){const e=(0,o.TP)((()=>{var e;return null===(e=this.options)||void 0===e?void 0:e.featureSources}),((e,t)=>this._createSourceInfo(e,t)));this._snappingSources=e,this.addHandles((0,r.ed)(e))}destroy(){this._set("options",null),this._updatingHandles.destroy()}async fetchCandidates(e,t,i,r){if(!(t&this._domain&&null!=this.options&&this.options.effectiveFeatureEnabled))return[];const n=[],s=this._computeScreenSizeDistanceParameters(e,i);for(const l of this._snappingSources){var o;if(null==l||!l.valid||!l.snappingSource.layerSource.enabled||null!==(o=l.layerView)&&void 0!==o&&o.suspended)continue;const t=l.getFetchCandidatesParameters(e,i,s);for(const e of t)n.push(l.snappingSource.fetchCandidates(e,r).then((e=>e.filter((e=>!this._candidateIsExcluded(l.snappingSource,e,i.excludeFeature))))))}const a=(await(0,_.OT)(n)).flat();return this._addRightAngleCandidates(a,e,s,i),(0,_.k_)(r),(0,D.lQ)(e,a),a}_addRightAngleCandidates(e,t,i,r){var n,s,o,a;const l=null!=r.vertexHandle?null===(n=r.vertexHandle.rightEdge)||void 0===n||null===(n=n.rightVertex)||void 0===n?void 0:n.pos:null!=r.editGeometryOperations&&"polygon"===r.editGeometryOperations.data.type?null===(s=r.editGeometryOperations.data.components[0])||void 0===s||null===(s=s.getFirstVertex())||void 0===s?void 0:s.pos:null,c=null!=r.vertexHandle?null===(o=r.vertexHandle.leftEdge)||void 0===o||null===(o=o.leftVertex)||void 0===o?void 0:o.pos:null!=r.editGeometryOperations?null===(a=r.editGeometryOperations.data.components[0])||void 0===a||null===(a=a.getLastVertex())||void 0===a?void 0:a.pos:null,{view:d}=this,h=(0,T.j7)(l,d,r),u=(0,T.j7)(c,d,r),p=e.length;for(let f=0;f<p;f++)this._addRightAngleCandidate(e[f],u,t,i,e),this._addRightAngleCandidate(e[f],h,t,i,e)}_addRightAngleCandidate(e,t,i,r,n){if(null==t||!function(e){return(e instanceof V.L||e instanceof j.k)&&!function(e){let{constraint:{start:t,end:i}}=e;const r=(0,y.a)(t,i),n=(0,m.k)(t,i);return r<(0,w.g)()||n/r<Y}(e)}(e))return;const s=e.constraint.closestTo(t),o=(s[0]-i[0])/r.x,a=(s[1]-i[1])/r.y,{start:l,end:c}=e.constraint;if(o*o+a*a<=1){const i=new G({targetPoint:s,otherVertex:t,otherVertexType:I.NEXT,previousVertex:(0,m.k)(s,l)>(0,m.k)(s,c)?l:c,constraint:new C.aU(t,s),objectId:e.objectId,isDraped:e.isDraped});n.push(i)}}_computeScreenSizeDistanceParameters(e,t){let i=null!=this.options?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return null==this.view?{x:i,y:i,z:i,distance:i}:"2d"===this.view.type?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,t)}_computeScreenSizeDistanceParameters3D(e,t,i,r){const{spatialReference:n}=r;i.renderCoordsHelper.toRenderCoords(e,n,k);const s=i.state.camera.computeScreenPixelSizeAt(k),o=s*i.renderCoordsHelper.unitInMeters,a=o/(0,v.c9)(n),l=o/(0,v._R)(n),c=t*a,d=t*l,h=(0,Z.Rs)(e,n,x.jG,i),u=h?B(h,e,a,0,0,i,r):0,p=h?B(h,e,0,a,0,i,r):0,f=h?B(h,e,0,0,l,i,r):0;return{x:0===u?0:c/u,y:0===p?0:c/p,z:0===f?0:d/f,distance:s*t}}_candidateIsExcluded(e,t,i){if(null==i)return!1;const r=this._getCandidateObjectId(t);if(null==r)return!1;const n=e.layerSource.layer;return"graphics"===n.type?i.uid===r:i.sourceLayer===n&&!(!i.attributes||!("objectIdField"in n))&&i.attributes[n.objectIdField]===r}_getCandidateObjectId(e){return e instanceof H.a?e.objectId:null}async _createSourceInfo(e,t){const i=e.layer;i.loaded||(await i.load(),(0,_.k_)(t));const{view:r}=this,n=await this._createFeatureSnappingSourceType(e);return(0,_.k_)(t),new L(null==n?{}:{snappingSource:n,view:r,layer:i})}async _createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}async _createFeatureSnappingSourceSceneLayer(e){const{view:t}=this;return null==t||"3d"!==t.type?null:new((await this._getSourceModule("scene")).SceneLayerSnappingSource)({layerSource:e,view:t})}async _createFeatureSnappingSourceFeatureLayer(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":return new((await this._getSourceModule("featureService")).FeatureServiceSnappingSource)({spatialReference:this.spatialReference,view:this.view,layerSource:e});case"memory":case"csv":case"geojson":case"wfs":return"mesh"===e.layer.geometryType?null:new((await this._getSourceModule("featureCollection")).FeatureCollectionSnappingSource)({layerSource:e,view:this.view})}return null}async _createFeatureSnappingSourceGraphicsLayer(e){return new((await this._getSourceModule("graphics")).GraphicsSnappingSource)({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _createFeatureSnappingSourceMapNotesLayer(e){return new((await this._getSourceModule("notes")).GraphicsSnappingSource)({getGraphicsLayers:()=>{var t,i;return null!==(t=null===(i=e.layer.sublayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}async _getSourceModule(e){const t=this._sourceModules[e];if(null==t.loader){const t=this._loadSourceModule(e),i={module:null,loader:t};this._sourceModules[e]=i;const r=await t,n={module:r,loader:t};return this._sourceModules[e]=n,r}return null==t.module?t.loader:t.module}_loadSourceModule(e){const t=this._updatingHandles;switch(e){case"featureService":return t.addPromise(i.e(4134).then(i.bind(i,84134)));case"featureCollection":return t.addPromise(i.e(2137).then(i.bind(i,26823)));case"graphics":case"notes":return t.addPromise(Promise.all([i.e(3406),i.e(5026),i.e(4054),i.e(6607),i.e(6072),i.e(5957),i.e(4579),i.e(6540)]).then(i.bind(i,33518)));case"scene":return t.addPromise(i.e(4953).then(i.bind(i,34953)))}}get test(){return{snappingSources:this._snappingSources}}};function B(e,t,i,r,n,s,o){let{spatialReference:a}=o;const l=(0,y.c)(q,t);l[0]+=i,l[1]+=r,l[2]+=n;const c=(0,Z.Rs)(l,a,x.jG,s);return c?(0,D.fG)(c,e):1/0}(0,a._)([(0,c.Cb)({constructOnly:!0})],W.prototype,"spatialReference",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],W.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],W.prototype,"options",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],W.prototype,"updating",null),(0,a._)([(0,c.Cb)()],W.prototype,"_snappingSources",void 0),W=(0,a._)([(0,d.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],W);const k=(0,b.c)(),q=(0,b.c)(),Y=1e-4;var J=i(91505),X=i(45925);class Q{constructor(e,t){this.view=e,this.options=t,this.squaredShortLineThreshold=p.c.shortLineThreshold*p.c.shortLineThreshold}snap(e,t){return null!=t.vertexHandle?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}edgeExceedsShortLineThreshold(e,t){return this.exceedsShortLineThreshold((0,T.j7)(e.leftVertex.pos,this.view,t),(0,T.j7)(e.rightVertex.pos,this.view,t),t)}exceedsShortLineThreshold(e,t,i){let{spatialReference:r}=i;return 0===this.squaredShortLineThreshold||(0,D.Bb)((0,Z.Rs)(t,r,x.jG,this.view),(0,Z.Rs)(e,r,x.jG,this.view))>this.squaredShortLineThreshold}isVertical(e,t){return(0,m.k)(e,t)<p.c.verticalLineThreshold}squaredProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}}class K extends N.j{constructor(e){let{lineStart:t,lineEnd:i,targetPoint:r,isDraped:n}=e;super(r,new C.jg(t,i),n,F.B.SELF),this._referenceLineHint=new z.w(D.ze.REFERENCE_EXTENSION,t,i,n,this.domain)}get hints(){return[this._referenceLineHint,new z.w(D.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}var $=i(55793),ee=i(94163);class te extends Q{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,n=[];if(r<1)return n;const{spatialReference:s}=t,o=(0,Z.Rs)(e,s,x.jG,this.view),{view:a}=this,l=i.edges[r-1];let c=l;do{if(this.edgeExceedsShortLineThreshold(c,t)){const i=(0,D._j)(c,a,t);this._processCandidateProposal(i.left,i.right,e,o,t,n)}c=c.leftVertex.leftEdge}while(c&&c!==l);return n}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,n=r.component;if(n.edges.length<2)return i;const{view:s}=this,{spatialReference:o}=t,a=(0,Z.Rs)(e,o,x.jG,s),l=r.leftEdge,c=r.rightEdge;l&&c&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(c,t)&&this._processCandidateProposal((0,T.j7)(l.leftVertex.pos,s,t),(0,T.j7)(c.rightVertex.pos,s,t),e,a,t,i);const d=n.edges[0];let h=d;do{if(h!==r.leftEdge&&h!==r.rightEdge&&this.edgeExceedsShortLineThreshold(h,t)){const r=(0,D._j)(h,s,t);this._processCandidateProposal(r.left,r.right,e,a,t,i)}h=h.rightVertex.rightEdge}while(h&&h!==d);return i}_processCandidateProposal(e,t,i,r,n,s){var o;const{spatialReference:a,pointer:l}=n,c=(0,T.uo)((0,$.ZE)(i,{start:e,end:t,type:ee.SP.LINE}));(0,D.Bb)(r,(0,Z.Rs)(c,a,x.jG,this.view))<this.squaredProximityThreshold(l)&&s.push(new K({lineStart:e,lineEnd:t,targetPoint:c,isDraped:"on-the-ground"===(null===(o=n.elevationInfo)||void 0===o?void 0:o.mode)}))}}var ie=i(6394),re=i(5916);class ne extends N.j{constructor(e){let{referenceLine:t,lineStart:i,targetPoint:r,isDraped:n}=e;const s=(0,b.g)(i),{left:o,right:a}=t;(0,y.f)(s,(0,y.g)(s,s,a),o),super(r,new C.jg(i,(0,T.uo)(s)),n,F.B.SELF),this._referenceLines=[{edge:t,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new z.w(D.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new re.L(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map((e=>new z.w(D.ze.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight)))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((i=>{(0,y.h)(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),(0,y.h)(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),(0,y.h)(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),(0,y.h)(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}class se extends Q{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.edges.length,n=i.vertices.length,s=[];if(r<2)return s;const{view:o}=this,a=(0,Z.Rs)(e,t.spatialReference,x.jG,o),l=(0,T.j7)(i.vertices[n-1].pos,o,t),c=(0,T.j7)(i.vertices[0].pos,o,t),d=i.edges[r-1];let h=d;do{if(this.edgeExceedsShortLineThreshold(h,t)){const i=(0,D._j)(h,o,t);this._checkEdgeForParallelLines(i,l,e,a,t,s),this._checkEdgeForParallelLines(i,c,e,a,t,s)}h=h.leftVertex.leftEdge}while(h&&h!==d);return s}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,n=r.component;if(n.edges.length<3)return i;const{view:s}=this,o=(0,Z.Rs)(e,t.spatialReference,x.jG,s),a=r.leftEdge,l=r.rightEdge,c=n.vertices[0],d=(0,T.j7)(c.pos,s,t),h=n.vertices.length,u=n.vertices[h-1],p=(0,T.j7)(u.pos,s,t),f=n.edges[0];let g=f;do{if(g!==a&&g!==l&&this.edgeExceedsShortLineThreshold(g,t)){const n=(0,D._j)(g,s,t);a&&this._checkEdgeForParallelLines(n,(0,T.j7)(a.leftVertex.pos,s,t),e,o,t,i),l&&this._checkEdgeForParallelLines(n,(0,T.j7)(l.rightVertex.pos,s,t),e,o,t,i),r===c?this._checkEdgeForParallelLines(n,p,e,o,t,i):r===u&&this._checkEdgeForParallelLines(n,d,e,o,t,i)}g=g.rightVertex.rightEdge}while(g&&g!==f);return i}_checkEdgeForParallelLines(e,t,i,r,n,s){const o=e.left,a=e.right;if((0,ee.k0)(oe,t,o,a),(0,m.k)(oe,t)<p.c.parallelLineThreshold)return;(0,ee.k0)(oe,i,o,a,t);const{spatialReference:l,pointer:c}=n,d=(0,T.al)(oe[0],oe[1],i[2]);if((0,D.Bb)(r,(0,Z.Rs)(d,l,x.jG,this.view))<this.squaredProximityThreshold(c)){var h;if(this.isVertical(d,t)||this.isVertical(o,a))return;if(this._parallelToPreviousCandidate(e,s))return;s.push(new ne({referenceLine:e,lineStart:t,targetPoint:d,isDraped:"on-the-ground"===(null===(h=n.elevationInfo)||void 0===h?void 0:h.mode)}))}}_parallelToPreviousCandidate(e,t){const i=e.left,r=e.right;for(const n of t)if((0,ee.k0)(oe,r,n.constraint.start,n.constraint.end,i),(0,m.k)(oe,r)<p.c.parallelLineThreshold)return n.addReferenceLine(e),!0;return!1}}const oe=(0,ie.a)();class ae extends Q{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=i.vertices.length,n=[];if(r<2)return n;const{view:s}=this,o=(0,Z.Rs)(e,t.spatialReference,x.jG,s),a=i.vertices[r-1];if(this.edgeExceedsShortLineThreshold(a.leftEdge,t)){const i=(0,T.j7)(a.pos,s,t),r=(0,T.j7)(a.leftEdge.leftVertex.pos,s,t);this._checkForSnappingCandidate(n,r,i,e,o,t)}const l=i.vertices[0];if(this.edgeExceedsShortLineThreshold(l.rightEdge,t)){const i=(0,T.j7)(l.pos,s,t),r=(0,T.j7)(l.rightEdge.rightVertex.pos,s,t);this._checkForSnappingCandidate(n,r,i,e,o,t)}return n}snapExistingVertex(e,t){const i=[],r=t.vertexHandle;if(r.component.vertices.length<3)return i;const{view:n}=this,s=(0,Z.Rs)(e,t.spatialReference,x.jG,n),o=r.leftEdge,a=r.rightEdge;if(null!==o&&void 0!==o&&o.leftVertex.leftEdge){const r=o.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(r,t)){const o=(0,T.j7)(r.rightVertex.pos,n,t),a=(0,T.j7)(r.leftVertex.pos,n,t);this._checkForSnappingCandidate(i,a,o,e,s,t)}}if(null!==a&&void 0!==a&&a.rightVertex.rightEdge){const r=a.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(r,t)){const o=(0,T.j7)(r.leftVertex.pos,n,t),a=(0,T.j7)(r.rightVertex.pos,n,t);this._checkForSnappingCandidate(i,a,o,e,s,t)}}return i}_checkForSnappingCandidate(e,t,i,r,n,s){const{spatialReference:o,pointer:a}=s;(0,m.c)(le,i,t);const l=(0,y.s)(ce,le[1],-le[0],0),c=(0,m.g)(l,(0,m.c)(le,r,i))/(0,m.v)(l),d=(0,T.uo)((0,m.w)((0,b.g)(r),i,l,c));if((0,D.Bb)(n,(0,Z.Rs)(d,o,x.jG,this.view))<this.squaredProximityThreshold(a)){var h;if(this.isVertical(d,i)||this.isVertical(i,t))return;const r=(0,y.q)((0,b.c)(),i,l,Math.sign(c));e.push(new G({targetPoint:d,constraint:new C.aU(i,(0,T.uo)(r)),previousVertex:t,otherVertex:i,otherVertexType:I.CENTER,isDraped:"on-the-ground"===(null===(h=s.elevationInfo)||void 0===h?void 0:h.mode)}))}}}const le=(0,ie.a)(),ce=(0,b.c)();class de extends N.j{constructor(e){let{targetPoint:t,point1:i,point2:r,isDraped:n}=e;super(t,new C.kt((0,T.uo)((0,y.p)((0,b.c)(),i,r,.5)),.5*(0,m.d)(i,r)),n,F.B.SELF),this._p1=i,this._p2=r}get hints(){return[new z.w(D.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new z.w(D.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new U.y(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}class he extends Q{snapNewVertex(e,t){const i=t.editGeometryOperations.data.components[0],r=[],n=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||n<2)return r;const{view:s}=this,o=i.vertices[0],a=i.vertices[n-1],l=(0,T.j7)(o.pos,s,t),c=(0,T.j7)(a.pos,s,t);return this._processCandidateProposal(l,c,e,t,r),r}snapExistingVertex(e,t){const i=[],r=t.vertexHandle,n=r.component;if(n.edges.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===r.index||r.index===n.vertices.length-1))return i;const{view:s}=this,o=(0,T.j7)(r.leftEdge.leftVertex.pos,s,t),a=(0,T.j7)(r.rightEdge.rightVertex.pos,s,t);return this._processCandidateProposal(o,a,e,t,i),i}_processCandidateProposal(e,t,i,r,n){if(!this.exceedsShortLineThreshold(e,t,r))return;const s=(0,m.l)(ue,e,t,.5),o=.5*(0,m.d)(e,t),a=(0,b.c)();(0,ee.xO)(a,i,s,o),a[2]=i[2];const l=(0,T.uo)(a),{spatialReference:c,pointer:d}=r,h=(0,Z.Rs)(i,c,x.jG,this.view);if((0,D.Bb)(h,(0,Z.Rs)(l,c,x.jG,this.view))<this.squaredProximityThreshold(d)){var u;if(this.isVertical(e,l)||this.isVertical(l,t))return;n.push(new de({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(u=r.elevationInfo)||void 0===u?void 0:u.mode)}))}}}const ue=(0,ie.a)();let pe=class extends l.Z{constructor(e){super(e),this.updating=!1,this._snappers=new s.Z,this._domain=F.B.SELF}initialize(){this._snappers.push(new se(this.view,this.options),new te(this.view,this.options),new ae(this.view,this.options),new he(this.view,this.options))}set options(e){this._set("options",e);for(const t of this._snappers)t.options=e}async fetchCandidates(e,t,i){if(!(t&this._domain&&this.options.effectiveSelfEnabled))return[];const r=[];for(const n of this._snappers.items)for(const t of n.snap(e,i))r.push(t);return(0,D.lQ)(e,r),r}};function fe(e,t){return[new pe({view:e,options:t}),new W({view:e,options:t,spatialReference:e.spatialReference})]}(0,a._)([(0,c.Cb)({readOnly:!0})],pe.prototype,"updating",void 0),(0,a._)([(0,c.Cb)({constructOnly:!0})],pe.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],pe.prototype,"options",null),pe=(0,a._)([(0,d.j)("esri.views.interactive.snapping.SelfSnappingEngine")],pe);var ge=i(55946);function _e(e,t,i){var r;let{z:n,m:s,spatialReference:o,elevationInfo:a}=i;if(null==n&&null==s){const t=(0,ge.T)(e[0],e[1],void 0,o);return null!=s&&(t.m=s,t.hasM=!0),t}if(null==t||"2d"===t.type){const t=(0,ge.T)(e[0],e[1],n,o);return null!=s&&(t.m=s,t.hasM=!0),t}const l=null!==(r=(0,x.zx)(t,e,o,x.jG,a))&&void 0!==r?r:0,c=(0,ge.T)(e[0],e[1],l,o);return null!=s&&(c.m=s,c.hasM=!0),c}var ve=i(90609);class me extends N.j{constructor(e,t,i,r){super(e,new C.Hk(e),r,F.B.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ve.w(this.targetPoint,this.isDraped,this.domain)]}}let ye=class extends(J.Z.EventedMixin(l.Z)){constructor(e){super(e),this.options=new g,this.snappingEnginesFactory=fe,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=be.MAIN}initialize(){this.addHandles([(0,o.YP)((()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:t,touchSensitivityMultiplier:i,distance:r}}),(()=>{this.doneSnapping(),this.emit("changed")}),o.Z_),(0,o.YP)((()=>this.options),(e=>{for(const t of this._engines)t.options=e}),o.Z_),(0,o.YP)((()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory})),(e=>{let{viewReady:t,snappingEnginesFactory:i}=e;return this._recreateEngines(t,i)}),o.tX)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some((e=>e.updating))}_recreateEngines(e,t){if(this._destroyEngines(),!e)return;const{view:i,options:r}=this;this._engines=t(i,r)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}get _squaredSatisfiesConstraintThreshold(){return p.c.satisfiesConstraintScreenThreshold*p.c.satisfiesConstraintScreenThreshold}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const r=this._currentMainCandidate;if(null==r)return t;const n=this._selectUpdateInput(e);if(null==n)return t;const{spatialReference:s}=i,o=(0,X.project)(n,s);if(null==o)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=i,d=[],h=(0,T.SN)(o,a,l),u=r.constraint.closestTo(h);if(!this._arePointsWithinScreenThreshold(h,u,i))return this._resetSnappingState(),t;r.targetPoint=u,d.push(...r.hints);for(const p of this._currentOtherActiveCandidates)p.targetPoint=u,d.push(...p.hints);return null!=c&&this.addHandles(c.draw(d,{spatialReference:s,elevationInfo:Se(i),view:a,selfSnappingZ:i.selfSnappingZ}),we),_e(u,a,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:l})}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput(e){let{point:t,scenePoint:i}=e;switch(this._currentSnappedType){case be.MAIN:return t;case be.SCENE:return i}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=be.MAIN}_removeVisualization(){this.removeHandles(we)}async _snapSinglePoint(e){let{point:t,context:i,signal:r}=e;const{view:n}=this,{elevationInfo:s}=i,o=(0,T.SN)(t,n,s),a=await this._fetchCandidates(o,F.B.ALL,i,r);return this._createSnapResult(o,be.MAIN,a,n,i,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:s},r)}async _snapMultiPoint(e){var t,i;let{point:r,scenePoint:n,context:s,signal:o}=e;const{view:a}=this,{coordinateHelper:l,elevationInfo:c,spatialReference:d}=s;await(0,X.initializeProjection)(n.spatialReference,d);const h=(0,X.project)(n,d),u=(0,T.SN)(h,a,c),p=await this._fetchCandidates(u,F.B.FEATURE,s,o);if(p.length>0){const e=await this._fetchCandidates(u,F.B.SELF,s,o);return this._createSnapResult(u,be.SCENE,[...p,...e],a,s,{z:h.z,m:h.m,spatialReference:h.spatialReference,elevationInfo:c},o)}const f=(0,T.SN)(r,a,c),g=await this._fetchCandidates(f,F.B.SELF,s,o);return this._createSnapResult(f,be.MAIN,g,a,s,{z:l.hasZ()&&r.hasZ?null!==(t=r.z)&&void 0!==t?t:0:void 0,m:l.hasM()&&r.hasM?null!==(i=r.m)&&void 0!==i?i:0:void 0,spatialReference:r.spatialReference,elevationInfo:c},o)}async _fetchCandidates(e,t,i,r){return(await Promise.all(this._engines.map((n=>n.fetchCandidates(e,t,i,r))))).flat()}_createSnapResult(e,t,i,r,n,s,o){return{get valid(){return!(0,_.Hc)(o)},apply:()=>{const{spatialReference:o}=n,{snappedPoint:a,hints:l}=this._processCandidates(e,t,i,n);return this._removeVisualization(),null!=n.visualizer&&this.addHandles(n.visualizer.draw(l,{spatialReference:o,elevationInfo:x.jG,view:r,selfSnappingZ:n.selfSnappingZ}),we),_e(a,r,s)}}}_processCandidates(e,t,i,r){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,D.lQ)(e,i);const n=this._currentMainCandidate;if(null!=n){const s=this._findOldConstraintInNewCandidates(n,i);if(s>=0){if(!(i[s]instanceof me))return this._intersectWithOtherCandidates(s,i,e,t,r);if(this._arePointsWithinScreenThreshold(e,n.targetPoint,r))return this._updateSnappingCandidate(n,t,i,r)}}return this._intersectWithOtherCandidates(0,i,e,t,r)}_findOldConstraintInNewCandidates(e,t){return e instanceof me?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}_intersectWithOtherCandidates(e,t,i,r,n){const{coordinateHelper:s}=n,o=t[e],a=[];for(let l=0;l<t.length;++l){if(l===e)continue;const r=t[l],n=o.constraint.intersect(r.constraint);if(n)for(const e of n.closestPoints(o.targetPoint))a.push([new me(e,o,r,r.isDraped),this._squaredScreenDistance(i,e,s)])}return a.length>0&&(a.sort(((e,t)=>e[1]-t[1])),a[0][1]<this._squaredPointProximityThreshold(n.pointer))?this._updateSnappingCandidate(a[0][0],r,t,n):this._updateSnappingCandidate(o,r,t,n)}_updateSnappingCandidate(e,t,i,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const n=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const o of i){if(e instanceof me){if(o.constraint.equals(e.first.constraint)||o.constraint.equals(e.second.constraint))continue}else if(o.constraint.equals(e.constraint))continue;const t=o.constraint.closestTo(n);this._squaredScreenDistance(t,n,r.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(o.targetPoint=n,this._currentOtherActiveCandidates.push(o),s.push(...o.hints))}return{snappedPoint:n,hints:s}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return(0,D.Bb)(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return(0,Z.Rs)(e,t.spatialReference,x.jG,this.view)}_findOldCandidateIndex(e,t){let i=-1;for(let r=0;r<e.length;++r)if(t.constraint.equals(e[r].constraint)){i=r;break}return i}get test(){return{visualizationsActive:this.hasHandles(we),engines:this._engines}}};var be;(0,a._)([(0,c.Cb)({constructOnly:!0})],ye.prototype,"view",void 0),(0,a._)([(0,c.Cb)()],ye.prototype,"options",void 0),(0,a._)([(0,c.Cb)({readOnly:!0})],ye.prototype,"updating",null),(0,a._)([(0,c.Cb)()],ye.prototype,"snappingEnginesFactory",void 0),(0,a._)([(0,c.Cb)()],ye.prototype,"_engines",void 0),(0,a._)([(0,c.Cb)()],ye.prototype,"_squaredMouseProximityTreshold",null),(0,a._)([(0,c.Cb)()],ye.prototype,"_squaredTouchProximityThreshold",null),(0,a._)([(0,c.Cb)()],ye.prototype,"_squaredSatisfiesConstraintThreshold",null),ye=(0,a._)([(0,d.j)("esri.views.interactive.snapping.SnappingManager")],ye),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(be||(be={}));const we="visualization-handle";function Se(e){let{coordinateHelper:t,elevationInfo:i}=e;return t.hasZ()?x.jG:i}const xe=new Map;function Ce(e){if(!xe.has(e)){const t=function(e,t){var i,r;const n=new g({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(i=null===t||void 0===t?void 0:t.distance)&&void 0!==i?i:p.c.distance,touchSensitivityMultiplier:null!==(r=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==r?r:p.c.touchSensitivityMultiplier});return{...(0,o.YP)((()=>{var t,i;return null!==(t=null===(i=e.map)||void 0===i||null===(i=i.allLayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]}),(e=>{n.featureSources=new s.Z(e.map((e=>new u({layer:e,enabled:!0}))))}),o.nn),options:n}}(e,{distance:10}),i=function(e,t){return new ye({view:e,options:t,snappingEnginesFactory:(t,i)=>[new W({view:e,spatialReference:e.spatialReference,options:i})]})}(e,t.options);xe.set(e,{referenceCount:0,snappingManager:i,remove:()=>{t.remove(),i.destroy()}})}const t=xe.get(e);t.referenceCount++;const i=(0,r.kB)((()=>function(e,t){t.referenceCount--,t.referenceCount>0||(0,n.Y)((()=>{0===t.referenceCount&&(t.remove(),xe.delete(e))}))}(e,t)));return{snappingManager:t.snappingManager,...i}}},97760:(e,t,i)=>{i.d(t,{k:()=>a});var r=i(44179),n=i(64674),s=i(75691),o=i(53397);class a extends s.a{constructor(e){super({...e,isDraped:!0,constraint:new r.M8(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new o.w(n.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},95905:(e,t,i)=>{i.d(t,{L:()=>a});var r=i(44179),n=i(64674),s=i(75691),o=i(53397);class a extends s.a{constructor(e){super({...e,constraint:new r.ku(e.edgeStart,e.edgeEnd)})}get hints(){return[new o.w(n.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}},75691:(e,t,i)=>{i.d(t,{a:()=>s});var r=i(80371),n=i(92605);class s extends n.j{constructor(e){let{targetPoint:t,objectId:i,constraint:n,isDraped:s}=e;super(t,n,s,r.B.FEATURE),this.objectId=i}}},92605:(e,t,i)=>{i.d(t,{j:()=>r});class r{constructor(e,t,i,r){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=r}}},11208:(e,t,i)=>{i.d(t,{RS:()=>l,Rs:()=>c});var r=i(17842),n=(i(88396),i(11186)),s=i(71353),o=i(55946),a=i(74509);function l(e,t,i,r){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:(0,s.c)();const l=(0,n.c)(h,e);return l[2]=(0,a.zx)(r,l,t,i)||0,r.renderCoordsHelper.toRenderCoords(l,t,o),o}function c(e,t,i,n){return"2d"===n.type?(d.x=e[0],d.y=e[1],d.spatialReference=t,n.toScreen(d)):(l(e,t,i,n,h),n.state.camera.projectToScreen(h,u),(0,r.vW)(u[0],u[1]))}const d=(0,o.T)(0,0,0,null),h=(0,s.c)(),u=((0,r.J$)(),(0,r.J$)(),(0,r.s1)())},55793:(e,t,i)=>{i.d(t,{$7:()=>x,Au:()=>b,CJ:()=>y,Jk:()=>O,Nn:()=>f,SD:()=>h,UG:()=>m,Yf:()=>w,ZE:()=>v,fK:()=>u,hA:()=>C,hm:()=>p,rq:()=>T,sc:()=>_,z9:()=>g,zf:()=>R});var r=i(16889),n=i(88396),s=i(6394),o=i(11186),a=i(71353),l=i(55652),c=i(80064),d=i(94163);function h(e,t,i){let{start:r,end:o,type:a}=e;const l=[],c=(0,n.c)(L,o,r),d=(0,n.c)(M,r,t),h=(0,n.v)(c),u=2*(0,n.g)(c,d),p=u*u-4*h*((0,n.v)(d)-i*i);if(0===p){const e=-u/(2*h);(a===O.PLANE||e>=0)&&l.push((0,n.w)((0,s.a)(),r,c,e))}else if(p>0){const e=Math.sqrt(p),t=(-u+e)/(2*h);(a===O.PLANE||t>=0)&&l.push((0,n.w)((0,s.a)(),r,c,t));const i=(-u-e)/(2*h);(a===O.PLANE||i>=0)&&l.push((0,n.w)((0,s.a)(),r,c,i))}return l}function u(e,t){const i=e.start,r=e.end,s=(0,n.c)(L,r,i),l=(0,o.s)(M,-s[1],s[0],0),c=t.start,h=t.end,u=(0,o.u)(I,h,c),p=(0,o.j)(u,l),f=(0,o.s)(F,i[0],i[1],0),g=(0,o.u)(j,f,c),_=(0,o.j)(g,l);if(Math.abs(p)<E)return Math.abs(_),[];const v=(0,o.q)(V,c,u,_/p);if(t.type===d.SP.RAY){const e=(0,o.u)(H,v,c);if((0,o.j)(e,u)<-E)return[]}if(e.type===O.HALF_PLANE){const e=(0,n.b)(H,v,i);if((0,n.g)(e,s)<-E)return[]}return[(0,a.g)(v)]}function p(e,t){return function(e,t){let{start:i,end:r,type:n}=e;const s=(0,o.u)(L,t,i),l=(0,o.u)(M,r,i),c=(0,o.b)(I,l,s);if((0,o.F)(c)/(0,o.F)(l)<E)switch(n){case d.SP.LINE:return[(0,a.g)(t)];case d.SP.RAY:return(0,o.j)(l,s)<-E?[]:[(0,a.g)(t)]}return[]}(S(z,t[2],e),t)}function f(e,t){const i=b(S(z,0,e),S(U,0,t)),r=[];for(const n of i)r.push((0,s.d)(n));return r}function g(e,t){return v(e,S(z,e[2],t))}function _(e,t,i){const r=(0,n.c)(L,e,t),s=i/(0,n.h)(r),o=(0,n.w)((0,a.c)(),t,r,s);return o[2]=e[2],o}function v(e,t){let{start:i,end:r,type:n}=t;const s=(0,o.u)(L,e,i),l=(0,o.u)(M,r,i),c=(0,o.j)(s,l)/(0,o.j)(l,l);return(0,o.q)((0,a.c)(),i,l,n===d.SP.RAY?Math.max(c,0):c)}const m=(()=>{const e=(0,a.c)(),t=(0,a.c)(),i=(0,a.c)();return(r,h)=>{let{start:u,end:p}=r,{center:f,radius:g,normal:_,slicePlane:v}=h;const m=(0,a.c)(),y=(0,l.Yq)(f,_,N);if(C((0,l.TE)(y,u),0)&&C((0,l.TE)(y,p),0)){(0,c._F)(_,e,t);const r=(r,s)=>((0,o.f)(i,s,f),(0,n.s)(r,(0,o.j)(i,e),(0,o.j)(i,t)),r),l=(0,d.UG)({start:r(A,u),end:r(D,p),type:d.SP.LINE},s.Z,g),h=[];for(const[i,n]of l){const r=(0,o.c)((0,a.c)(),f);(0,o.q)(r,r,e,i),(0,o.q)(r,r,t,n),v&&!R(v,r)||h.push(r)}return h}return(0,l.fn)(y,u,p,m)?!C((0,o.o)(m,f),g)||v&&!R(v,m)?[]:[m]:[]}})();function y(e,t,i){let{start:r,end:s,type:l}=e;const c=[],h=(0,o.f)(L,s,r),u=(0,n.c)(M,r,t),p=(0,n.v)(h),f=2*(0,n.g)(h,u),g=f*f-4*p*((0,n.v)(u)-i*i);if(0===g){const e=-f/(2*p);(l===d.SP.LINE||e>=0)&&c.push((0,o.q)((0,a.c)(),r,h,e))}else if(g>0){const e=Math.sqrt(g),t=(-f+e)/(2*p);(l===d.SP.LINE||t>=0)&&c.push((0,o.q)((0,a.c)(),r,h,t));const i=(-f-e)/(2*p);(l===d.SP.LINE||i>=0)&&c.push((0,o.q)((0,a.c)(),r,h,i))}return c}function b(e,t){const i=e.start,n=e.end,s=t.start,l=t.end,c=(0,o.u)(L,n,i),h=(0,o.u)(M,l,s),u=(0,o.u)(I,s,i),p=(0,o.b)(F,c,h),f=(0,o.j)(u,p);if(!(0,r.W8)(f,0,E))return[];const g=(0,o.F)(p);if((0,r.W8)(g,0,E))return[];const _=(0,o.b)(j,u,h),v=(0,o.j)(_,p)/g,m=(0,o.q)(V,i,c,v);if(e.type===d.SP.RAY){const e=(0,o.u)(H,m,i);if((0,o.j)(c,e)<-E)return[]}if(t.type===d.SP.RAY){const e=(0,o.u)(H,m,s);if((0,o.j)(h,e)<-E)return[]}return[(0,a.g)(m)]}function w(e,t,i,r){const[o,a]=e,[l,c]=i,d=l-o,h=c-a,u=d*d+h*h,p=Math.sqrt(u);if(p>t+r)return[];if(p<Math.abs(t-r))return[];if(C(p,0)&&C(t,r))return[];const f=(t*t-r*r+u)/(2*p),g=Math.sqrt(t*t-f*f),_=g*h/p,v=g*d/p,[m,y]=(0,n.l)(A,e,i,f/p);return C(_,v)?[(0,s.f)(m,y)]:[(0,s.f)(m+_,y-v),(0,s.f)(m-_,y+v)]}function S(e,t,i){let{start:r,end:n,type:s}=i;return(0,o.s)(e.start,r[0],r[1],t),(0,o.s)(e.end,n[0],n[1],t),e.type=P[s],e}function x(e,t){return C(e[2],t[2])}function C(e,t){return Math.abs(e-t)<E}function T(e,t){return t.filter((t=>R(e,t)))}function R(e,t){return(0,l.Ac)(e,t)}var O;!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(O||(O={}));const P={[O.PLANE]:d.SP.LINE,[O.HALF_PLANE]:d.SP.RAY},E=1e-6,A=(0,s.a)(),D=(0,s.a)(),L=(0,a.c)(),M=(0,a.c)(),I=(0,a.c)(),F=(0,a.c)(),j=(0,a.c)(),V=(0,a.c)(),H=(0,a.c)(),N=(0,l.Ue)(),z={start:(0,a.c)(),end:(0,a.c)(),type:d.SP.LINE},U={start:(0,a.c)(),end:(0,a.c)(),type:d.SP.LINE}},45412:(e,t,i)=>{i.d(t,{U:()=>c});var r=i(32718),n=i(92026),s=i(18722),o=i(8548),a=i(3384);const l=r.Z.getLogger("esri.views.webgl.VertexArrayObject");let c=class{constructor(e,t,i,r){let n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._context=e,this._locations=t,this._layout=i,this._buffers=r,this._indexBuffer=n,this._glName=null,this._initialized=!1}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce(((e,t)=>e+this._buffers[t].byteLength),null!=this._indexBuffer?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get usedMemory(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*s.ru}dispose(){if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const t in this._buffers){var e;null!==(e=this._buffers[t])&&void 0!==e&&e.dispose(),delete this._buffers[t]}this._indexBuffer=(0,n.M2)(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&l.warn("Leaked WebGL VAO")}disposeVAOOnly(){if(this._glName){var e;(null===(e=this._context)||void 0===e||null===(e=e.capabilities)||void 0===e?void 0:e.vao).deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o._g.VertexArrayObject,this)}this._context=null}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const t=e.createVertexArray();e.bindVertexArray(t),this._bindLayout(),e.bindVertexArray(null),this._glName=t,this._context.instanceCounter.increment(o._g.VertexArrayObject,this)}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:t,_indexBuffer:i}=this;e||l.error("Vertex buffer dictionary is empty!");const r=this._context.gl;for(const n in e){const i=e[n];i||l.error("Vertex buffer is uninitialized!");const r=t[n];r||l.error("Vertex element descriptor is empty!"),(0,a.XP)(this._context,this._locations,i,r)}null!=i&&(this._context.capabilities.vao?r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:t}=this;e||l.error("Vertex buffer dictionary is empty!");for(const i in e){const r=e[i];r||l.error("Vertex buffer is uninitialized!");const n=t[i];(0,a.UF)(this._context,this._locations,r,n)}null!=this._indexBuffer&&this._context.unbindBuffer(this._indexBuffer.bufferType)}}},40085:(e,t,i)=>{i.d(t,{O:()=>u});var r,n=i(27366),s=i(14921),o=i(92026),a=i(66978),l=i(94172),c=i(49861),d=(i(25243),i(63780),i(93169),i(69912)),h=i(32845);!function(e){e[e.PENDING=0]="PENDING",e[e.WAIT_FOR_VIEW_READY=1]="WAIT_FOR_VIEW_READY",e[e.RUNNING=2]="RUNNING"}(r||(r={}));let u=class extends h.V{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.analysisView=null,this._reconnectViewTask=null,this._parentChangeFromReconnect=!1,this._startUserOperation=null;const t=null===e||void 0===e?void 0:e.analysis;null!=t?this.analysis=t:(this._set("analysis",this.constructAnalysis()),this._set("isAnalysisOwner",!0))}normalizeCtorArgs(e){const{analysis:t,...i}=e;return i}initialize(){this.addHandles([(0,l.YP)((()=>{var e;return null===(e=this.analysis)||void 0===e?void 0:e.parent}),(e=>{this._parentChangeFromReconnect||e===this.view||this._set("isAnalysisOwner",!1);const t=!this._parentChangeFromReconnect;this._parentChangeFromReconnect=!1,t&&this._scheduleViewReconnect()}),l.Z_),(0,l.YP)((()=>({view:this.view,ready:null!=this.view&&this.view.ready,supported:this.supported})),((e,t)=>{let{view:i}=e;const r=null===t||void 0===t?void 0:t.view;i!==r&&(this._startUserOperation=(0,o.IM)(this._startUserOperation),this._disconnectFromView(r)),this._scheduleViewReconnect()}),l.tX),(0,l.YP)((()=>this.analysis.isEditable),((e,t)=>{null!=this.analysisView&&(e&&!t&&null==this.tool?this.createTool():e||!t||null==this.tool||this.tool.active||this.removeTool())}))])}destroy(){this._reconnectViewTask=(0,o.IM)(this._reconnectViewTask),this._startUserOperation=(0,o.IM)(this._startUserOperation),null!=this.analysisView&&(this.analysisView.visible=void 0),this._disconnectFromView(this.view),null!=this.analysis&&this.isAnalysisOwner&&(this.analysis.destroy(),this._set("analysis",null))}set analysis(e){e!==this._get("analysis")&&(this._startUserOperation=(0,o.IM)(this._startUserOperation),this._disconnectFromView(this.view),this._setExternalAnalysis(e),this._scheduleViewReconnect())}get ready(){return null!=this.analysisView&&!this.connectingToView}get connectingToView(){return null!=this._reconnectViewTask}get isAnalysisOwner(){return this._get("isAnalysisOwner")}set visible(e){this._set("visible",e),null!=this.analysisView&&(this.analysisView.visible=e)}async start(){this.clear();const e={task:null,abort:null,state:r.PENDING},t=(0,s.vr)((async t=>{e.state=r.WAIT_FOR_VIEW_READY,await(0,l.N1)((()=>this.ready),t),e.state=r.RUNNING,this.createTool({interactive:!0})}));return e.task=t,e.abort=()=>t.abort(),this._startUserOperation=e,t.promise}clear(){this._startUserOperation=(0,o.IM)(this._startUserOperation),this.removeTool(),this.analysis.clear()}onConnectToAnalysisView(e){}onDisconnectFromAnalysisView(){}_scheduleViewReconnect(){this._reconnectViewTask=(0,o.IM)(this._reconnectViewTask);const e=(0,s.vr)((async t=>{try{await this._reconnectView(t)}catch(i){if((0,a.k_)(t),!(0,a.D_)(i))return void this.logger.warn("Failed to use analysis in view model",i);throw i}finally{e===this._reconnectViewTask&&(this._reconnectViewTask=null)}}));this._reconnectViewTask=e}async _reconnectView(e){const{view:t}=this,i=null!=t&&t.ready&&this.supported,r=this.analysis;if(this._startUserOperation=p(this._startUserOperation),this._disconnectFromView(t),i&&null!=t&&null!=r){if(this.isAnalysisOwner){if(null!=r.parent)return void this.logError("expected owned analysis to have null parent when connecting to view");this._parentChangeFromReconnect=!0,t.analyses.add(r)}this.analysisView=await t.whenAnalysisView(r),(0,a.Hc)(e)?this._startUserOperation=p(this._startUserOperation):(this.analysisView.visible=this.visible,this.onConnectToAnalysisView(this.analysisView),this.createTool())}}_disconnectFromView(e){this.removeTool(),null!=e&&this.isAnalysisOwner&&(this._parentChangeFromReconnect=!0,e.analyses.remove(this.analysis),this.analysis.clear()),this.analysisView=null,this.onDisconnectFromAnalysisView()}_setExternalAnalysis(e){null==this.analysisView||this.isAnalysisOwner||(this.analysisView.visible=!0),this.analysisView=null,this._set("isAnalysisOwner",!1),this._set("analysis",e),this._parentChangeFromReconnect=!1}get testInfo(){return{analysisView:this.analysisView}}};function p(e){return null!=e&&e.state>=r.RUNNING?(e.abort(),null):e}(0,n._)([(0,c.Cb)({nonNullable:!0})],u.prototype,"analysis",null),(0,n._)([(0,c.Cb)()],u.prototype,"analysisView",void 0),(0,n._)([(0,c.Cb)()],u.prototype,"ready",null),(0,n._)([(0,c.Cb)()],u.prototype,"connectingToView",null),(0,n._)([(0,c.Cb)({readOnly:!0})],u.prototype,"isAnalysisOwner",null),(0,n._)([(0,c.Cb)({type:Boolean,value:!0})],u.prototype,"visible",null),(0,n._)([(0,c.Cb)()],u.prototype,"_reconnectViewTask",void 0),u=(0,n._)([(0,d.j)("esri.widgets.support.InteractiveAnalysisViewModel")],u)}}]);
//# sourceMappingURL=7910.7112398c.chunk.js.map